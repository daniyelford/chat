{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"uploading-box\"\n};\nconst _hoisted_2 = [\"value\"];\nconst _hoisted_3 = {\n  key: 1,\n  class: \"preview-box\"\n};\nconst _hoisted_4 = {\n  class: \"preview-list\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = [\"src\"];\nconst _hoisted_8 = {\n  key: 2,\n  class: \"file-label\"\n};\nconst _hoisted_9 = {\n  class: \"file-name\"\n};\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport default {\n  __name: 'UploaderManyMedia',\n  props: {\n    url: String,\n    toAction: String\n  },\n  emits: ['done'],\n  setup(__props, {\n    emit: __emit\n  }) {\n    const fileInput = ref(null);\n    const previews = ref([]);\n    const selectedFilesBase64 = ref([]);\n    const progress = ref(0);\n    const uploading = ref(false);\n    const props = __props;\n    const mediaList = ref([]);\n    const emit = __emit;\n    const handleDrop = e => {\n      const files = e.dataTransfer.files;\n      handleFiles({\n        target: {\n          files\n        }\n      });\n    };\n    const handleFiles = async e => {\n      const files = Array.from(e.target.files);\n      if (!files.length) return;\n      previews.value = [];\n      selectedFilesBase64.value = [];\n      uploading.value = true;\n      progress.value = 0;\n      let count = 0;\n      for (const file of files) {\n        await new Promise(resolve => {\n          const reader = new FileReader();\n          reader.onload = () => {\n            const base64 = reader.result;\n            selectedFilesBase64.value.push(base64);\n            previews.value.push({\n              src: base64,\n              name: file.name,\n              isImage: file.type.startsWith('image/'),\n              isVideo: file.type.startsWith('video/')\n            });\n            count++;\n            progress.value = Math.round(count / files.length * 100);\n            resolve();\n          };\n          reader.readAsDataURL(file);\n        });\n      }\n      await uploadFiles();\n      uploading.value = false;\n    };\n    const uploadFiles = async () => {\n      try {\n        const response = await sendApi({\n          control: 'upload',\n          action: 'upload_many_media',\n          data: {\n            url: props.url,\n            data: selectedFilesBase64.value,\n            toAction: props.toAction\n          }\n        });\n        if (response.status === 'success') {\n          const uploaded = response.media || response.data;\n          mediaList.value.push(...uploaded);\n          previews.value.push(...uploaded.map(item => ({\n            src: item.url,\n            name: item.url.split('/').pop(),\n            isImage: item.type === 'image',\n            isVideo: item.type === 'video',\n            id: item.id\n          })));\n          selectedFilesBase64.value = [];\n          emit('done', mediaList.value);\n        } else {\n          alert('آپلود با خطا مواجه شد: ' + response.message);\n        }\n      } catch (err) {\n        alert('خطا در ارسال: ' + err.message);\n      }\n    };\n    const deleteMedia = async (media, index) => {\n      try {\n        const res = await sendApi({\n          control: 'upload',\n          action: 'delete_media_by_id',\n          data: {\n            id: media.id\n          }\n        });\n        if (res.status === 'success') {\n          mediaList.value.splice(index, 1);\n          previews.value.splice(index, 1);\n        } else {\n          alert('حذف فایل با خطا مواجه شد: ' + res.message);\n        }\n      } catch (err) {\n        alert('خطا در حذف: ' + err.message);\n      }\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        class: \"drop-area\",\n        onDragover: _cache[1] || (_cache[1] = _withModifiers(() => {}, [\"prevent\"])),\n        onDragenter: _cache[2] || (_cache[2] = _withModifiers(() => {}, [\"prevent\"])),\n        onDrop: _withModifiers(handleDrop, [\"prevent\"])\n      }, [_cache[5] || (_cache[5] = _createElementVNode(\"p\", null, \"فایل‌ها را بکشید و رها کنید یا کلیک کنید\", -1)), _createElementVNode(\"input\", {\n        type: \"file\",\n        multiple: \"\",\n        ref_key: \"fileInput\",\n        ref: fileInput,\n        class: \"hidden-input\",\n        onChange: handleFiles\n      }, null, 544), _createElementVNode(\"button\", {\n        type: \"button\",\n        class: \"select-button\",\n        onClick: _cache[0] || (_cache[0] = $event => fileInput.value.click())\n      }, \"انتخاب فایل\"), uploading.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"p\", null, \"در حال آماده‌سازی فایل‌ها برای ارسال...\", -1)), _createElementVNode(\"progress\", {\n        value: progress.value,\n        max: \"100\",\n        class: \"progress-bar\"\n      }, null, 8, _hoisted_2)])) : _createCommentVNode(\"\", true), previews.value.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[4] || (_cache[4] = _createElementVNode(\"p\", null, \"پیش‌نمایش فایل‌ها:\", -1)), _createElementVNode(\"div\", _hoisted_4, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(previews.value, (item, i) => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: i,\n          class: \"preview-item\"\n        }, [_createElementVNode(\"button\", {\n          onClick: $event => deleteMedia(item, i),\n          class: \"delete-button\"\n        }, \"×\", 8, _hoisted_5), item.isImage ? (_openBlock(), _createElementBlock(\"img\", {\n          key: 0,\n          src: item.src,\n          class: \"preview-image\"\n        }, null, 8, _hoisted_6)) : item.isVideo ? (_openBlock(), _createElementBlock(\"video\", {\n          key: 1,\n          src: item.src,\n          controls: \"\",\n          class: \"preview-video\"\n        }, null, 8, _hoisted_7)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \"PDF File\")), _createElementVNode(\"span\", _hoisted_9, _toDisplayString(item.name), 1)]);\n      }), 128))])])) : _createCommentVNode(\"\", true)], 32);\n    };\n  }\n};","map":{"version":3,"names":["ref","sendApi","fileInput","previews","selectedFilesBase64","progress","uploading","props","__props","mediaList","emit","__emit","handleDrop","e","files","dataTransfer","handleFiles","target","Array","from","length","value","count","file","Promise","resolve","reader","FileReader","onload","base64","result","push","src","name","isImage","type","startsWith","isVideo","Math","round","readAsDataURL","uploadFiles","response","control","action","data","url","toAction","status","uploaded","media","map","item","split","pop","id","alert","message","err","deleteMedia","index","res","splice"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/tooles/upload/UploaderManyMedia.vue"],"sourcesContent":["<template>\r\n  <div class=\"drop-area\" @dragover.prevent @dragenter.prevent @drop.prevent=\"handleDrop\">\r\n    <p>فایل‌ها را بکشید و رها کنید یا کلیک کنید</p>\r\n    <input type=\"file\" multiple ref=\"fileInput\" class=\"hidden-input\" @change=\"handleFiles\" />\r\n    <button type=\"button\" class=\"select-button\" @click=\"fileInput.click()\">انتخاب فایل</button>\r\n    <div v-if=\"uploading\" class=\"uploading-box\">\r\n      <p>در حال آماده‌سازی فایل‌ها برای ارسال...</p>\r\n      <progress :value=\"progress\" max=\"100\" class=\"progress-bar\"></progress>\r\n    </div>\r\n    <div v-if=\"previews.length > 0\" class=\"preview-box\">\r\n      <p>پیش‌نمایش فایل‌ها:</p>\r\n      <div class=\"preview-list\">\r\n        <div v-for=\"(item, i) in previews\" :key=\"i\" class=\"preview-item\">\r\n          <button @click=\"deleteMedia(item, i)\" class=\"delete-button\">×</button>\r\n          <img v-if=\"item.isImage\" :src=\"item.src\" class=\"preview-image\" />\r\n          <video v-else-if=\"item.isVideo\" :src=\"item.src\" controls class=\"preview-video\" />\r\n          <span v-else class=\"file-label\">PDF File</span>\r\n          <span class=\"file-name\">{{ item.name }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script setup>\r\nimport { ref, defineProps, defineEmits } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\n\r\nconst fileInput = ref(null)\r\nconst previews = ref([])\r\nconst selectedFilesBase64 = ref([])\r\nconst progress = ref(0)\r\nconst uploading = ref(false)\r\n\r\nconst props = defineProps({\r\n  url: String,\r\n  toAction: String,\r\n})\r\nconst mediaList = ref([])\r\nconst emit = defineEmits(['done'])\r\n\r\nconst handleDrop = (e) => {\r\n  const files = e.dataTransfer.files\r\n  handleFiles({ target: { files } })\r\n}\r\n\r\nconst handleFiles = async (e) => {\r\n  const files = Array.from(e.target.files)\r\n  if (!files.length) return\r\n\r\n  previews.value = []\r\n  selectedFilesBase64.value = []\r\n  uploading.value = true\r\n  progress.value = 0\r\n\r\n  let count = 0\r\n\r\n  for (const file of files) {\r\n    await new Promise((resolve) => {\r\n      const reader = new FileReader()\r\n      reader.onload = () => {\r\n        const base64 = reader.result\r\n        selectedFilesBase64.value.push(base64)\r\n        previews.value.push({\r\n          src: base64,\r\n          name: file.name,\r\n          isImage: file.type.startsWith('image/'),\r\n          isVideo: file.type.startsWith('video/'),\r\n        })\r\n        count++\r\n        progress.value = Math.round((count / files.length) * 100)\r\n        resolve()\r\n      }\r\n      reader.readAsDataURL(file)\r\n    })\r\n  }\r\n\r\n  await uploadFiles()\r\n  uploading.value = false\r\n}\r\n\r\nconst uploadFiles = async () => {\r\n  try {\r\n    const response = await sendApi({\r\n      control: 'upload',\r\n      action: 'upload_many_media',\r\n      data: {\r\n        url: props.url,\r\n        data: selectedFilesBase64.value,\r\n        toAction: props.toAction,\r\n      },\r\n    })\r\n    if (response.status === 'success') {\r\n      const uploaded = response.media || response.data\r\n      mediaList.value.push(...uploaded)\r\n      previews.value.push(\r\n        ...uploaded.map((item) => ({\r\n          src: item.url,\r\n          name: item.url.split('/').pop(),\r\n          isImage: item.type === 'image',\r\n          isVideo: item.type === 'video',\r\n          id: item.id,\r\n        }))\r\n      )\r\n      selectedFilesBase64.value = []\r\n      emit('done', mediaList.value)\r\n    } else {\r\n      alert('آپلود با خطا مواجه شد: ' + response.message)\r\n    }\r\n  } catch (err) {\r\n    alert('خطا در ارسال: ' + err.message)\r\n  }\r\n}\r\n\r\n\r\nconst deleteMedia = async (media, index) => {\r\n  try {\r\n    const res = await sendApi({\r\n      control: 'upload',\r\n      action: 'delete_media_by_id',\r\n      data: { id: media.id },\r\n    })\r\n\r\n    if (res.status === 'success') {\r\n      mediaList.value.splice(index, 1)\r\n      previews.value.splice(index, 1)\r\n    } else {\r\n      alert('حذف فایل با خطا مواجه شد: ' + res.message)\r\n    }\r\n  } catch (err) {\r\n    alert('خطا در حذف: ' + err.message)\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n    .drop-area {\r\n        border: 2px dashed #d1d5db;\r\n        padding: 1rem;\r\n        border-radius: 0.5rem;\r\n        text-align: center;\r\n        cursor: pointer;\r\n    }\r\n    .hidden-input {\r\n        display: none;\r\n    }\r\n    .select-button {\r\n        margin-top: 0.5rem;\r\n        padding: 0.4rem 0.8rem;\r\n        cursor: pointer;\r\n    }\r\n    .uploading-box {\r\n        margin-top: 1rem;\r\n    }\r\n    .progress-bar {\r\n        width: 100%;\r\n    }\r\n    .preview-box {\r\n        margin-top: 1rem;\r\n    }\r\n    .preview-list {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 1rem;\r\n        justify-content: center;\r\n    }\r\n    .preview-item {\r\n        display: flex;\r\n        position: relative;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        gap: 0.5rem;\r\n        border: 1px solid #d1d5db;\r\n        border-radius: 0.5rem;\r\n        padding: 0.5rem;\r\n        background-color: #f9fafb;\r\n    }\r\n    .preview-image {\r\n        max-width: 100px;\r\n        max-height: 100px;\r\n        object-fit: contain;\r\n        border: 1px solid #ccc;\r\n    }\r\n    .preview-video {\r\n        max-width: 150px;\r\n        max-height: 100px;\r\n    }\r\n    .file-label {\r\n        font-size: 0.875rem;\r\n        color: #4b5563;\r\n    }\r\n    .file-name {\r\n        font-size: 0.75rem;\r\n        color: #9ca3af;\r\n        max-width: 100px;\r\n        text-align: center;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n    }\r\n    .delete-button {\r\n      position: absolute;\r\n      top: 4px;\r\n      right: 4px;\r\n      background-color: #ef4444;\r\n      color: white;\r\n      border: none;\r\n      border-radius: 9999px;\r\n      width: 20px;\r\n      height: 20px;\r\n      font-size: 12px;\r\n      line-height: 20px;\r\n      text-align: center;\r\n      cursor: pointer;\r\n    }\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}