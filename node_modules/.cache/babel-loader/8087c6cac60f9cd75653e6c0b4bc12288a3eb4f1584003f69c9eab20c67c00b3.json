{"ast":null,"code":"import { createElementVNode as _createElementVNode, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, vModelText as _vModelText, withDirectives as _withDirectives, vModelSelect as _vModelSelect, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  key: 1\n};\nconst _hoisted_3 = {\n  class: \"p-2\"\n};\nconst _hoisted_4 = [\"src\"];\nconst _hoisted_5 = {\n  key: 1,\n  \"data-v-0c463e07\": \"\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  fill: \"#000000\",\n  \"enable-background\": \"new 0 0 24 24\",\n  viewBox: \"0 0 24 24\"\n};\nconst _hoisted_6 = {\n  class: \"p-2\"\n};\nconst _hoisted_7 = {\n  class: \"p-2\"\n};\nconst _hoisted_8 = {\n  class: \"p-2\"\n};\nconst _hoisted_9 = {\n  class: \"p-2\"\n};\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  key: 1\n};\nconst _hoisted_12 = {\n  class: \"p-2\"\n};\nconst _hoisted_13 = [\"onClick\"];\nconst _hoisted_14 = [\"onClick\"];\nconst _hoisted_15 = [\"onClick\"];\nconst _hoisted_16 = {\n  key: 2,\n  class: \"error\"\n};\nconst _hoisted_17 = {\n  key: 3,\n  class: \"mt-6 border p-4 rounded bg-gray-50\"\n};\nconst _hoisted_18 = {\n  class: \"font-bold mb-2\"\n};\nconst _hoisted_19 = [\"value\"];\nconst _hoisted_20 = [\"value\"];\nimport { ref, onMounted } from 'vue';\nimport { useUserStore } from '@/stores/user';\nimport { useInfiniteScroll } from '@/composables/useInfiniteScroll';\nexport default {\n  __name: 'UsersSettingList',\n  setup(__props) {\n    const store = useUserStore();\n    const {\n      users,\n      hasMore,\n      loading,\n      error,\n      fetchUsers,\n      submitUser,\n      disableUser,\n      enableUser,\n      allCategories,\n      allRules\n    } = store;\n    const showForm = ref(false);\n    const editUser = ref(null);\n    const form = ref({\n      name: '',\n      family: '',\n      mobile: '',\n      rule_id: '',\n      category_id: ''\n    });\n    async function onDisableUser(id) {\n      await disableUser(id);\n    }\n    async function onEnableUser(id) {\n      await enableUser(id);\n    }\n    function openForm(user = null) {\n      editUser.value = user;\n      if (user) {\n        form.value = {\n          name: user.name,\n          family: user.family,\n          mobile: user.mobile,\n          rule_id: user.rules?.[0]?.rule_id || '',\n          category_id: user.rules?.[0]?.category_id || ''\n        };\n      } else {\n        form.value = {\n          name: '',\n          family: '',\n          mobile: '',\n          rule_id: '',\n          category_id: ''\n        };\n      }\n      showForm.value = true;\n    }\n    async function submitForm() {\n      await submitUser(form.value, editUser.value ? editUser.value.id : null);\n      showForm.value = false;\n    }\n    const {\n      loadMoreTrigger: UsersLoadTrigger,\n      setupObserver: setupUsersObserver\n    } = useInfiniteScroll(async ({\n      offset\n    }) => {\n      await fetchUsers(10, offset);\n      return {\n        items: users,\n        has_more: hasMore\n      };\n    });\n    onMounted(() => {\n      setupUsersObserver();\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", null, [_createElementVNode(\"button\", {\n        style: {\n          \"float\": \"left\"\n        },\n        onClick: _cache[0] || (_cache[0] = $event => openForm())\n      }, \"افزودن کاربر\"), _cache[14] || (_cache[14] = _createElementVNode(\"h2\", null, \"مدیریت کاربران\", -1)), _unref(loading) ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, _cache[7] || (_cache[7] = [_createElementVNode(\"div\", {\n        class: \"tiny-loader\"\n      }, null, -1)]))) : _unref(users).length > 0 ? (_openBlock(), _createElementBlock(\"table\", _hoisted_2, [_createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(users), u => {\n        return _openBlock(), _createElementBlock(\"tr\", {\n          key: u.id\n        }, [_createElementVNode(\"td\", _hoisted_3, [u.image ? (_openBlock(), _createElementBlock(\"img\", {\n          key: 0,\n          src: u.image,\n          alt: \"avatar\"\n        }, null, 8, _hoisted_4)) : (_openBlock(), _createElementBlock(\"svg\", _hoisted_5, _cache[8] || (_cache[8] = [_createElementVNode(\"g\", {\n          \"data-v-0c463e07\": \"\"\n        }, [_createElementVNode(\"rect\", {\n          \"data-v-0c463e07\": \"\",\n          fill: \"none\",\n          height: \"24\",\n          width: \"24\"\n        })], -1), _createElementVNode(\"g\", {\n          \"data-v-0c463e07\": \"\"\n        }, [_createElementVNode(\"path\", {\n          \"data-v-0c463e07\": \"\",\n          d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"\n        })], -1)])))]), _createElementVNode(\"td\", _hoisted_6, _toDisplayString(u.name), 1), _createElementVNode(\"td\", _hoisted_7, _toDisplayString(u.family), 1), _createElementVNode(\"td\", _hoisted_8, _toDisplayString(u.mobile), 1), _createElementVNode(\"td\", _hoisted_9, [u.rules?.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(u.rules, (rule, index) => {\n          return _openBlock(), _createElementBlock(\"div\", {\n            key: index\n          }, [_createElementVNode(\"span\", null, _toDisplayString(rule.category_name), 1), _createTextVNode(\" - \" + _toDisplayString(rule.name), 1)]);\n        }), 128))])) : (_openBlock(), _createElementBlock(\"span\", _hoisted_11, \"بدون نقش\"))]), _createElementVNode(\"td\", _hoisted_12, [_createElementVNode(\"button\", {\n          onClick: $event => openForm(u)\n        }, \"ویرایش\", 8, _hoisted_13), u.user_status === 'active' ? (_openBlock(), _createElementBlock(\"button\", {\n          key: 0,\n          onClick: $event => onDisableUser(u.id)\n        }, \"غیر فعال\", 8, _hoisted_14)) : (_openBlock(), _createElementBlock(\"button\", {\n          key: 1,\n          onClick: $event => onEnableUser(u.id)\n        }, \"فعال\", 8, _hoisted_15))])]);\n      }), 128)), _createElementVNode(\"div\", {\n        ref_key: \"UsersLoadTrigger\",\n        ref: UsersLoadTrigger,\n        style: {\n          \"height\": \"1px\"\n        }\n      }, null, 512)])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_16, _toDisplayString(_unref(error)), 1)), showForm.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [_createElementVNode(\"h3\", _hoisted_18, _toDisplayString(editUser.value ? 'ویرایش کاربر' : 'افزودن کاربر'), 1), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"])\n      }, [_withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.value.name = $event),\n        placeholder: \"نام\",\n        class: \"border p-2 w-full mb-2\"\n      }, null, 512), [[_vModelText, form.value.name]]), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => form.value.family = $event),\n        placeholder: \"نام خانوادگی\",\n        class: \"border p-2 w-full mb-2\"\n      }, null, 512), [[_vModelText, form.value.family]]), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => form.value.mobile = $event),\n        placeholder: \"موبایل\",\n        class: \"border p-2 w-full mb-2\"\n      }, null, 512), [[_vModelText, form.value.mobile]]), _cache[11] || (_cache[11] = _createElementVNode(\"label\", {\n        class: \"block font-bold mt-2\"\n      }, \"نقش‌ها\", -1)), _withDirectives(_createElementVNode(\"select\", {\n        \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => form.value.rule_id = $event),\n        class: \"border p-2 w-full mb-2\"\n      }, [_cache[9] || (_cache[9] = _createElementVNode(\"option\", {\n        value: \"\"\n      }, \"انتخاب کنید\", -1)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allRules), r => {\n        return _openBlock(), _createElementBlock(\"option\", {\n          key: r.id,\n          value: r.id\n        }, _toDisplayString(r.name), 9, _hoisted_19);\n      }), 128))], 512), [[_vModelSelect, form.value.rule_id]]), _cache[12] || (_cache[12] = _createElementVNode(\"label\", {\n        class: \"block font-bold mt-2\"\n      }, \"دسته‌بندی\", -1)), _withDirectives(_createElementVNode(\"select\", {\n        \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => form.value.category_id = $event),\n        class: \"border p-2 w-full mb-4\"\n      }, [_cache[10] || (_cache[10] = _createElementVNode(\"option\", {\n        value: \"\"\n      }, \"انتخاب کنید\", -1)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allCategories), c => {\n        return _openBlock(), _createElementBlock(\"option\", {\n          key: c.id,\n          value: c.id\n        }, _toDisplayString(c.title), 9, _hoisted_20);\n      }), 128))], 512), [[_vModelSelect, form.value.category_id]]), _cache[13] || (_cache[13] = _createElementVNode(\"button\", {\n        class: \"bg-green-600 text-white px-4 py-2 rounded\",\n        type: \"submit\"\n      }, \" ذخیره \", -1)), _createElementVNode(\"button\", {\n        class: \"ml-2 px-4 py-2 rounded border\",\n        onClick: _cache[6] || (_cache[6] = $event => showForm.value = false),\n        type: \"button\"\n      }, \" انصراف \")], 32)])) : _createCommentVNode(\"\", true)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useUserStore","useInfiniteScroll","store","users","hasMore","loading","error","fetchUsers","submitUser","disableUser","enableUser","allCategories","allRules","showForm","editUser","form","name","family","mobile","rule_id","category_id","onDisableUser","id","onEnableUser","openForm","user","value","rules","submitForm","loadMoreTrigger","UsersLoadTrigger","setupObserver","setupUsersObserver","offset","items","has_more"],"sources":["D:/GitHub/chat/vue3/src/components/tooles/users/UsersSettingList.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <button style=\"float: left;\" @click=\"openForm()\">افزودن کاربر</button>\r\n    <h2>مدیریت کاربران</h2>\r\n    <div v-if=\"loading\">\r\n      <div class=\"tiny-loader\"></div>\r\n    </div>\r\n    <table v-else-if=\"users.length > 0\">\r\n      <tbody>\r\n        <tr v-for=\"u in users\" :key=\"u.id\">\r\n          <td class=\"p-2\">\r\n            <img v-if=\"u.image\" :src=\"u.image\" alt=\"avatar\"/>\r\n            <svg v-else data-v-0c463e07=\"\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#000000\" enable-background=\"new 0 0 24 24\" viewBox=\"0 0 24 24\"><g data-v-0c463e07=\"\"><rect data-v-0c463e07=\"\" fill=\"none\" height=\"24\" width=\"24\"></rect></g><g data-v-0c463e07=\"\"><path data-v-0c463e07=\"\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"></path></g></svg>\r\n          </td>\r\n          <td class=\"p-2\">{{ u.name }}</td>\r\n          <td class=\"p-2\">{{ u.family }}</td>\r\n          <td class=\"p-2\">{{ u.mobile }}</td>\r\n          <td class=\"p-2\">\r\n            <div v-if=\"u.rules?.length\">\r\n              <div v-for=\"(rule,index) in u.rules\" :key=\"index\">\r\n                <span>{{ rule.category_name }}</span> - {{ rule.name }}\r\n              </div>\r\n            </div>\r\n            <span v-else>بدون نقش</span>\r\n          </td>\r\n          <td class=\"p-2\">\r\n            <button @click=\"openForm(u)\">ویرایش</button>\r\n            <button v-if=\"u.user_status === 'active'\" @click=\"onDisableUser(u.id)\">غیر فعال</button>\r\n            <button v-else @click=\"onEnableUser(u.id)\">فعال</button>\r\n          </td>\r\n        </tr>\r\n        <div ref=\"UsersLoadTrigger\" style=\"height: 1px;\"></div>\r\n      </tbody>\r\n    </table>\r\n    <div v-else class=\"error\">{{ error }}</div>\r\n\r\n    <div v-if=\"showForm\" class=\"mt-6 border p-4 rounded bg-gray-50\">\r\n      <h3 class=\"font-bold mb-2\">{{ editUser ? 'ویرایش کاربر' : 'افزودن کاربر' }}</h3>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <input v-model=\"form.name\" placeholder=\"نام\" class=\"border p-2 w-full mb-2\" />\r\n        <input v-model=\"form.family\" placeholder=\"نام خانوادگی\" class=\"border p-2 w-full mb-2\" />\r\n        <input v-model=\"form.mobile\" placeholder=\"موبایل\" class=\"border p-2 w-full mb-2\" />\r\n        <label class=\"block font-bold mt-2\">نقش‌ها</label>\r\n        <select v-model=\"form.rule_id\" class=\"border p-2 w-full mb-2\">\r\n          <option value=\"\">انتخاب کنید</option>\r\n          <option v-for=\"r in allRules\" :key=\"r.id\" :value=\"r.id\">\r\n            {{ r.name }}\r\n          </option>\r\n        </select>\r\n        <label class=\"block font-bold mt-2\">دسته‌بندی</label>\r\n        <select v-model=\"form.category_id\" class=\"border p-2 w-full mb-4\">\r\n          <option value=\"\">انتخاب کنید</option>\r\n          <option v-for=\"c in allCategories\" :key=\"c.id\" :value=\"c.id\">\r\n            {{ c.title }}\r\n          </option>\r\n        </select>\r\n        <button class=\"bg-green-600 text-white px-4 py-2 rounded\" type=\"submit\">\r\n          ذخیره\r\n        </button>\r\n        <button class=\"ml-2 px-4 py-2 rounded border\" @click=\"showForm = false\" type=\"button\">\r\n          انصراف\r\n        </button>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { ref, onMounted } from 'vue'\r\n  import { useUserStore } from '@/stores/user'\r\n  import { useInfiniteScroll } from '@/composables/useInfiniteScroll'\r\n  const store = useUserStore()\r\n  const {\r\n    users,\r\n    hasMore,\r\n    loading,\r\n    error,\r\n    fetchUsers,\r\n    submitUser,\r\n    disableUser,\r\n    enableUser,\r\n    allCategories,\r\n    allRules\r\n  } = store\r\n  const showForm = ref(false)\r\n  const editUser = ref(null)\r\n  const form = ref({\r\n    name: '',\r\n    family: '',\r\n    mobile: '',\r\n    rule_id: '',\r\n    category_id: ''\r\n  })\r\n  async function onDisableUser(id) {\r\n    await disableUser(id)\r\n  }\r\n  async function onEnableUser(id) {\r\n    await enableUser(id)\r\n  }\r\n  function openForm(user = null) {\r\n    editUser.value = user\r\n    if (user) {\r\n      form.value = {\r\n        name: user.name,\r\n        family: user.family,\r\n        mobile: user.mobile,\r\n        rule_id: user.rules?.[0]?.rule_id || '',\r\n        category_id: user.rules?.[0]?.category_id || ''\r\n      }\r\n    } else {\r\n      form.value = {\r\n        name: '',\r\n        family: '',\r\n        mobile: '',\r\n        rule_id: '',\r\n        category_id: ''\r\n      }\r\n    }\r\n    showForm.value = true\r\n  }\r\n  async function submitForm() {\r\n    await submitUser(form.value, editUser.value ? editUser.value.id : null)\r\n    showForm.value = false\r\n  }\r\n  const {\r\n    loadMoreTrigger: UsersLoadTrigger,\r\n    setupObserver:setupUsersObserver,\r\n  } = useInfiniteScroll(async ({offset}) => {\r\n    await fetchUsers(10,offset)\r\n    return {\r\n      items: users,\r\n      has_more: hasMore,\r\n    }\r\n  })\r\n  onMounted(() => {\r\n    setupUsersObserver()\r\n  })\r\n</script>\r\n\r\n<style scoped>\r\n\r\n  table {\r\n    max-height: 300px;\r\n    overflow: auto;\r\n  }\r\n  table td {\r\n    text-align: center;\r\n  }\r\n  .tiny-loader {\r\n    width: 20px;\r\n    height: 20px;\r\n    border: 2px solid #ccc;\r\n    border-top-color: #333;\r\n    border-radius: 50%;\r\n    animation: spin 1s linear infinite;\r\n    margin: 10px auto;\r\n  }\r\n  @keyframes spin {\r\n    to { transform: rotate(360deg); }\r\n  }\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEE,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,iBAAiB,QAAQ,iCAAiC;;;;IACnE,MAAMC,KAAK,GAAGF,YAAY,CAAC,CAAC;IAC5B,MAAM;MACJG,KAAK;MACLC,OAAO;MACPC,OAAO;MACPC,KAAK;MACLC,UAAU;MACVC,UAAU;MACVC,WAAW;MACXC,UAAU;MACVC,aAAa;MACbC;IACF,CAAC,GAAGV,KAAK;IACT,MAAMW,QAAQ,GAAGf,GAAG,CAAC,KAAK,CAAC;IAC3B,MAAMgB,QAAQ,GAAGhB,GAAG,CAAC,IAAI,CAAC;IAC1B,MAAMiB,IAAI,GAAGjB,GAAG,CAAC;MACfkB,IAAI,EAAE,EAAE;MACRC,MAAM,EAAE,EAAE;MACVC,MAAM,EAAE,EAAE;MACVC,OAAO,EAAE,EAAE;MACXC,WAAW,EAAE;IACf,CAAC,CAAC;IACF,eAAeC,aAAaA,CAACC,EAAE,EAAE;MAC/B,MAAMb,WAAW,CAACa,EAAE,CAAC;IACvB;IACA,eAAeC,YAAYA,CAACD,EAAE,EAAE;MAC9B,MAAMZ,UAAU,CAACY,EAAE,CAAC;IACtB;IACA,SAASE,QAAQA,CAACC,IAAI,GAAG,IAAI,EAAE;MAC7BX,QAAQ,CAACY,KAAK,GAAGD,IAAI;MACrB,IAAIA,IAAI,EAAE;QACRV,IAAI,CAACW,KAAK,GAAG;UACXV,IAAI,EAAES,IAAI,CAACT,IAAI;UACfC,MAAM,EAAEQ,IAAI,CAACR,MAAM;UACnBC,MAAM,EAAEO,IAAI,CAACP,MAAM;UACnBC,OAAO,EAAEM,IAAI,CAACE,KAAK,GAAG,CAAC,CAAC,EAAER,OAAO,IAAI,EAAE;UACvCC,WAAW,EAAEK,IAAI,CAACE,KAAK,GAAG,CAAC,CAAC,EAAEP,WAAW,IAAI;QAC/C,CAAC;MACH,CAAC,MAAM;QACLL,IAAI,CAACW,KAAK,GAAG;UACXV,IAAI,EAAE,EAAE;UACRC,MAAM,EAAE,EAAE;UACVC,MAAM,EAAE,EAAE;UACVC,OAAO,EAAE,EAAE;UACXC,WAAW,EAAE;QACf,CAAC;MACH;MACAP,QAAQ,CAACa,KAAK,GAAG,IAAI;IACvB;IACA,eAAeE,UAAUA,CAAA,EAAG;MAC1B,MAAMpB,UAAU,CAACO,IAAI,CAACW,KAAK,EAAEZ,QAAQ,CAACY,KAAK,GAAGZ,QAAQ,CAACY,KAAK,CAACJ,EAAE,GAAG,IAAI,CAAC;MACvET,QAAQ,CAACa,KAAK,GAAG,KAAK;IACxB;IACA,MAAM;MACJG,eAAe,EAAEC,gBAAgB;MACjCC,aAAa,EAACC;IAChB,CAAC,GAAG/B,iBAAiB,CAAC,OAAO;MAACgC;IAAM,CAAC,KAAK;MACxC,MAAM1B,UAAU,CAAC,EAAE,EAAC0B,MAAM,CAAC;MAC3B,OAAO;QACLC,KAAK,EAAE/B,KAAK;QACZgC,QAAQ,EAAE/B;MACZ,CAAC;IACH,CAAC,CAAC;IACFL,SAAS,CAAC,MAAM;MACdiC,kBAAkB,CAAC,CAAC;IACtB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}