{"ast":null,"code":"import { unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createVNode as _createVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, isMemoSame as _isMemoSame, withMemo as _withMemo } from \"vue\";\nconst _hoisted_1 = {\n  class: \"news-wrapper\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"no-news\"\n};\nconst _hoisted_5 = {\n  class: \"news-list\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"media-list\"\n};\nconst _hoisted_7 = {\n  class: \"news-header\"\n};\nconst _hoisted_8 = {\n  key: 0,\n  class: \"category\"\n};\nconst _hoisted_9 = {\n  class: \"news-title\"\n};\nconst _hoisted_10 = {\n  key: 1,\n  class: \"address\"\n};\nconst _hoisted_11 = {\n  class: \"news-status\"\n};\nconst _hoisted_12 = {\n  class: \"actions\"\n};\nconst _hoisted_13 = [\"onClick\"];\nconst _hoisted_14 = [\"onClick\"];\nimport { onMounted, onUnmounted } from 'vue';\nimport { useManageNewsStore } from '@/stores/manageNews';\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue';\nexport default {\n  __name: 'ManageNews',\n  setup(__props) {\n    const store = useManageNewsStore();\n    const getStatus = status => {\n      switch (status) {\n        case 'checking':\n          return 'منتشر شد';\n        case 'seen':\n          return 'درحال پیگیری';\n        default:\n          return 'نامشخص';\n      }\n    };\n    const restoreNews = async id => {\n      const ok = await store.restoreNews(id);\n      if (ok) {\n        alert('خبر با موفقیت پخش مجدد شد');\n      }\n    };\n    const deleteNews = async id => {\n      const ok = await store.deleteNews(id);\n      if (ok) {\n        store.loadNews();\n      }\n    };\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        store.startPolling();\n      } else {\n        store.stopPolling();\n      }\n    };\n    onMounted(() => {\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n      if (document.visibilityState === 'visible') {\n        store.startPolling();\n      }\n    });\n    onUnmounted(() => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      store.stopPolling();\n    });\n    return (_ctx, _cache) => {\n      const _component_RouterLink = _resolveComponent(\"RouterLink\");\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_unref(store).loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"در حال بارگذاری...\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_unref(store).newsList.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \"شما هنوز خبری ثبت نکردید.\")) : _createCommentVNode(\"\", true), _createElementVNode(\"ul\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(store).newsList, (news, __, ___, _cached) => {\n        const _memo = [news.status];\n        if (_cached && _cached.key === news.id && _isMemoSame(_cached, _memo)) return _cached;\n        const _item = (_openBlock(), _createElementBlock(\"li\", {\n          key: news.id,\n          class: \"news-item\"\n        }, [news.media?.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createVNode(MediaSlider, {\n          medias: news.media\n        }, null, 8, [\"medias\"])])) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_7, [news.category?.length ? (_openBlock(), _createElementBlock(\"p\", _hoisted_8, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(news.category, cat => {\n          return _openBlock(), _createElementBlock(\"span\", {\n            key: cat.id,\n            class: \"category-item\"\n          }, _toDisplayString(cat.title), 1);\n        }), 128))])) : _createCommentVNode(\"\", true)]), _createElementVNode(\"h3\", _hoisted_9, _toDisplayString(news.description), 1), news.address ? (_openBlock(), _createElementBlock(\"p\", _hoisted_10, \" موقعیت: \" + _toDisplayString(news.address.city || 'نامشخص') + \" - \" + _toDisplayString(news.address.address || ''), 1)) : _createCommentVNode(\"\", true), _createElementVNode(\"small\", _hoisted_11, \"وضعیت: \" + _toDisplayString(getStatus(news.status)), 1), _createElementVNode(\"div\", _hoisted_12, [news.status === 'seen' && news?.reportList[0]?.id ? (_openBlock(), _createBlock(_component_RouterLink, {\n          key: 0,\n          class: \"c-b\",\n          to: {\n            path: `/show-cartable/${news.reportList[0].id}`\n          }\n        }, {\n          default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\" پیگیری \")])),\n          _: 2,\n          __: [2]\n        }, 1032, [\"to\"])) : _createCommentVNode(\"\", true), news.status === 'seen' && !news.report ? (_openBlock(), _createElementBlock(\"button\", {\n          key: 1,\n          class: \"c-s\",\n          onClick: $event => restoreNews(news.id)\n        }, \" پخش مجدد \", 8, _hoisted_13)) : _createCommentVNode(\"\", true), news.status === 'checking' ? (_openBlock(), _createElementBlock(\"button\", {\n          key: 2,\n          class: \"c-r\",\n          onClick: $event => deleteNews(news.id)\n        }, \" عدم پخش \", 8, _hoisted_14)) : _createCommentVNode(\"\", true)])]));\n        _item.memo = _memo;\n        return _item;\n      }, _cache, 0), 128))])]))]);\n    };\n  }\n};","map":{"version":3,"names":["onMounted","onUnmounted","useManageNewsStore","MediaSlider","store","getStatus","status","restoreNews","id","ok","alert","deleteNews","loadNews","handleVisibilityChange","document","visibilityState","startPolling","stopPolling","addEventListener","removeEventListener"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/ManageNews.vue"],"sourcesContent":["<template>\r\n  <div class=\"news-wrapper\">\r\n    <div v-if=\"store.loading\" class=\"loading\">در حال بارگذاری...</div>\r\n    <div v-else>\r\n      <div v-if=\"store.newsList.length === 0\" class=\"no-news\">شما هنوز خبری ثبت نکردید.</div>\r\n      <ul class=\"news-list\">\r\n        <li\r\n          v-for=\"news in store.newsList\"\r\n          :key=\"news.id\"\r\n          v-memo=\"[news.status]\"\r\n          class=\"news-item\"\r\n        >\r\n          <div class=\"media-list\" v-if=\"news.media?.length\">\r\n            <MediaSlider :medias=\"news.media\" />\r\n          </div>\r\n          <div class=\"news-header\">\r\n            <p v-if=\"news.category?.length\" class=\"category\">\r\n              <span v-for=\"cat in news.category\" :key=\"cat.id\" class=\"category-item\">\r\n                {{ cat.title }}\r\n              </span>\r\n            </p>\r\n          </div>\r\n          <h3 class=\"news-title\">{{ news.description }}</h3>\r\n          <p v-if=\"news.address\" class=\"address\">\r\n            موقعیت: {{ news.address.city || 'نامشخص' }} - {{ news.address.address || '' }}\r\n          </p>\r\n          <small class=\"news-status\">وضعیت: {{ getStatus(news.status) }}</small>\r\n          <div class=\"actions\">\r\n            <RouterLink class=\"c-b\" v-if=\"news.status === 'seen' && news?.reportList[0]?.id\" :to=\"{ path:`/show-cartable/${news.reportList[0].id}`}\">\r\n              پیگیری\r\n            </RouterLink>\r\n            <button class=\"c-s\" v-if=\"news.status === 'seen' && !news.report\" @click=\"restoreNews(news.id)\">\r\n              پخش مجدد\r\n            </button>\r\n            <button class=\"c-r\" v-if=\"news.status === 'checking'\" @click=\"deleteNews(news.id)\">\r\n              عدم پخش\r\n            </button>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\n  import { onMounted, onUnmounted } from 'vue'\r\n  import { useManageNewsStore } from '@/stores/manageNews'\r\n  import MediaSlider from '@/components/tooles/media/MediaSlider.vue'\r\n  const store = useManageNewsStore()\r\n  const getStatus = (status) => {\r\n    switch (status) {\r\n      case 'checking':\r\n        return 'منتشر شد'\r\n      case 'seen':\r\n        return 'درحال پیگیری'\r\n      default:\r\n        return 'نامشخص'\r\n    }\r\n  }\r\n  const restoreNews = async (id) => {\r\n    const ok = await store.restoreNews(id)\r\n    if (ok) {\r\n      alert('خبر با موفقیت پخش مجدد شد')\r\n    }\r\n  }\r\n  const deleteNews = async (id) => {\r\n    const ok = await store.deleteNews(id)\r\n    if (ok) {\r\n      store.loadNews()\r\n    }\r\n  }\r\n  const handleVisibilityChange = () => {\r\n    if (document.visibilityState === 'visible') {\r\n      store.startPolling()\r\n    } else {\r\n      store.stopPolling()\r\n    }\r\n  }\r\n  onMounted(() => {\r\n    document.addEventListener('visibilitychange', handleVisibilityChange)\r\n    if (document.visibilityState === 'visible') {\r\n      store.startPolling()\r\n    }\r\n  })\r\n  onUnmounted(() => {\r\n    document.removeEventListener('visibilitychange', handleVisibilityChange)\r\n    store.stopPolling()\r\n  })\r\n</script>\r\n<style scoped>\r\n  .news-wrapper {\r\n    max-width: 800px;\r\n    margin: 0 auto;\r\n    direction: rtl;\r\n  }\r\n  .title {\r\n    font-size: 24px;\r\n    margin-bottom: 1rem;\r\n  }\r\n  .loading,\r\n  .no-news {\r\n    font-style: italic;\r\n    color: #888;\r\n  }\r\n  .news-list {\r\n    list-style: none;\r\n    padding: 0;\r\n  }\r\n  .news-item {\r\n    border: 1px solid #ddd;\r\n    border-radius: 6px;\r\n    padding: 1rem;\r\n    margin-bottom: 1rem;\r\n  }\r\n  .news-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n  .news-title {\r\n    margin: 0;\r\n    font-size: 18px;\r\n  }\r\n  .news-status {\r\n    font-size: 12px;\r\n    color: #666;\r\n  }\r\n  .category {\r\n    display: flex;\r\n    flex-direction: row;\r\n    flex-wrap: wrap;\r\n    justify-content: flex-start;\r\n    align-items: center;\r\n    gap: 5px;\r\n    margin-top: 0.5rem;\r\n  }\r\n  .category-item {\r\n    background: #eef;\r\n    padding: 2px 6px;\r\n    margin-left: 4px;\r\n    border-radius: 4px;\r\n  }\r\n  .address {\r\n    font-size: 14px;\r\n    color: #444;\r\n  }\r\n  .media-list {\r\n    margin: 0.5rem auto;\r\n  }\r\n  .media-item {\r\n    margin-right: 10px;\r\n    margin-top: 10px;\r\n  }\r\n  .media-img {\r\n    max-width: 120px;\r\n    max-height: 80px;\r\n    border-radius: 4px;\r\n    object-fit: cover;\r\n  }\r\n  .media-link {\r\n    display: inline-block;\r\n    padding: 4px 8px;\r\n    background: #ddd;\r\n    border-radius: 4px;\r\n    font-size: 13px;\r\n    text-decoration: none;\r\n    color: #000;\r\n  }\r\n  .actions {\r\n    margin-top: 1rem;\r\n  }\r\n  .actions button ,.c-b{\r\n    width: 100%;\r\n    display: block;\r\n    padding: 6px 12px;\r\n    border: none;\r\n    background: #4e3a85;\r\n    color: white;\r\n    border-radius: 5px;\r\n    cursor: pointer;\r\n    text-decoration: none;\r\n    margin-top: 10px;\r\n  }\r\n  .c-r {\r\n    background: #ac3427 !important;\r\n  }\r\n  .c-s{\r\n    background: #29921b !important;\r\n  }\r\n  .actions button:hover {\r\n    opacity: 0.9;\r\n  }\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CE,SAASA,SAAS,EAAEC,WAAW,QAAQ,KAAK;AAC5C,SAASC,kBAAkB,QAAQ,qBAAqB;AACxD,OAAOC,WAAW,MAAM,2CAA2C;;;;IACnE,MAAMC,KAAK,GAAGF,kBAAkB,CAAC,CAAC;IAClC,MAAMG,SAAS,GAAIC,MAAM,IAAK;MAC5B,QAAQA,MAAM;QACZ,KAAK,UAAU;UACb,OAAO,UAAU;QACnB,KAAK,MAAM;UACT,OAAO,cAAc;QACvB;UACE,OAAO,QAAQ;MACnB;IACF,CAAC;IACD,MAAMC,WAAW,GAAG,MAAOC,EAAE,IAAK;MAChC,MAAMC,EAAE,GAAG,MAAML,KAAK,CAACG,WAAW,CAACC,EAAE,CAAC;MACtC,IAAIC,EAAE,EAAE;QACNC,KAAK,CAAC,2BAA2B,CAAC;MACpC;IACF,CAAC;IACD,MAAMC,UAAU,GAAG,MAAOH,EAAE,IAAK;MAC/B,MAAMC,EAAE,GAAG,MAAML,KAAK,CAACO,UAAU,CAACH,EAAE,CAAC;MACrC,IAAIC,EAAE,EAAE;QACNL,KAAK,CAACQ,QAAQ,CAAC,CAAC;MAClB;IACF,CAAC;IACD,MAAMC,sBAAsB,GAAGA,CAAA,KAAM;MACnC,IAAIC,QAAQ,CAACC,eAAe,KAAK,SAAS,EAAE;QAC1CX,KAAK,CAACY,YAAY,CAAC,CAAC;MACtB,CAAC,MAAM;QACLZ,KAAK,CAACa,WAAW,CAAC,CAAC;MACrB;IACF,CAAC;IACDjB,SAAS,CAAC,MAAM;MACdc,QAAQ,CAACI,gBAAgB,CAAC,kBAAkB,EAAEL,sBAAsB,CAAC;MACrE,IAAIC,QAAQ,CAACC,eAAe,KAAK,SAAS,EAAE;QAC1CX,KAAK,CAACY,YAAY,CAAC,CAAC;MACtB;IACF,CAAC,CAAC;IACFf,WAAW,CAAC,MAAM;MAChBa,QAAQ,CAACK,mBAAmB,CAAC,kBAAkB,EAAEN,sBAAsB,CAAC;MACxET,KAAK,CAACa,WAAW,CAAC,CAAC;IACrB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}