{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const useWalletStore = defineStore('wallet', () => {\n  const transactions = ref([]);\n  const transactionsLoaded = ref(false);\n  const discountCards = ref([]);\n  const discountCardsLoaded = ref(false);\n  const loading = ref(false);\n  let pollingInterval = null;\n  const fetchTransactions = async () => {\n    const res = await sendApi({\n      control: 'wallet',\n      action: 'get_transactions'\n    });\n    if (res.status === 'success') {\n      const newIds = res.data.map(i => i.id).sort();\n      const oldIds = transactions.value.map(i => i.id).sort();\n      if (JSON.stringify(newIds) !== JSON.stringify(oldIds)) {\n        transactions.value = res.data;\n      }\n      transactionsLoaded.value = true;\n    }\n  };\n  const fetchDiscountCards = async () => {\n    const res = await sendApi({\n      control: 'wallet',\n      action: 'get_discount_cards'\n    });\n    if (res.status === 'success') {\n      const newIds = res.data.map(i => i.id).sort();\n      const oldIds = discountCards.value.map(i => i.id).sort();\n      if (JSON.stringify(newIds) !== JSON.stringify(oldIds)) {\n        discountCards.value = res.data;\n      }\n      discountCardsLoaded.value = true;\n    }\n  };\n  const startPolling = () => {\n    if (pollingInterval) return;\n    pollingInterval = setInterval(() => {\n      if (transactionsLoaded.value) fetchTransactions();\n      if (discountCardsLoaded.value) fetchDiscountCards();\n    }, 10000);\n  };\n  const stopPolling = () => {\n    clearInterval(pollingInterval);\n    pollingInterval = null;\n  };\n  return {\n    transactions,\n    transactionsLoaded,\n    discountCards,\n    discountCardsLoaded,\n    loading,\n    fetchTransactions,\n    fetchDiscountCards,\n    startPolling,\n    stopPolling\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","useWalletStore","transactions","transactionsLoaded","discountCards","discountCardsLoaded","loading","pollingInterval","fetchTransactions","res","control","action","status","newIds","data","map","i","id","sort","oldIds","value","JSON","stringify","fetchDiscountCards","startPolling","setInterval","stopPolling","clearInterval"],"sources":["D:/GitHub/ci3-vue3/vue3/src/stores/walletStore.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\nexport const useWalletStore = defineStore('wallet', () => {\r\n    const transactions = ref([])\r\n    const transactionsLoaded = ref(false)\r\n    const discountCards = ref([])\r\n    const discountCardsLoaded = ref(false)\r\n    const loading = ref(false)\r\n    let pollingInterval = null\r\n    const fetchTransactions = async () => {\r\n        const res = await sendApi({ control: 'wallet', action: 'get_transactions' })\r\n        if (res.status === 'success') {\r\n            const newIds = res.data.map(i => i.id).sort()\r\n            const oldIds = transactions.value.map(i => i.id).sort()\r\n            if (JSON.stringify(newIds) !== JSON.stringify(oldIds)) {\r\n                transactions.value = res.data\r\n            }\r\n            transactionsLoaded.value = true\r\n        }\r\n    }\r\n    const fetchDiscountCards = async () => {\r\n        const res = await sendApi({ control: 'wallet', action: 'get_discount_cards' })\r\n        if (res.status === 'success') {\r\n            const newIds = res.data.map(i => i.id).sort()\r\n            const oldIds = discountCards.value.map(i => i.id).sort()\r\n            if (JSON.stringify(newIds) !== JSON.stringify(oldIds)) {\r\n                discountCards.value = res.data\r\n            }\r\n            discountCardsLoaded.value = true\r\n        }\r\n    }\r\n    const startPolling = () => {\r\n        if (pollingInterval) return\r\n        pollingInterval = setInterval(() => {\r\n            if (transactionsLoaded.value) fetchTransactions()\r\n            if (discountCardsLoaded.value) fetchDiscountCards()\r\n        }, 10000)\r\n    }\r\n    const stopPolling = () => {\r\n        clearInterval(pollingInterval)\r\n        pollingInterval = null\r\n    }\r\n    return {\r\n        transactions,\r\n        transactionsLoaded,\r\n        discountCards,\r\n        discountCardsLoaded,\r\n        loading,\r\n        fetchTransactions,\r\n        fetchDiscountCards,\r\n        startPolling,\r\n        stopPolling,\r\n    }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}