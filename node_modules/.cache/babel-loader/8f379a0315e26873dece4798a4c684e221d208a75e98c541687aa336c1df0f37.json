{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.flat-map.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { createVNode as _createVNode, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"category\"\n};\nconst _hoisted_2 = [\"onClick\"];\nconst _hoisted_3 = {\n  class: \"info\"\n};\nconst _hoisted_4 = [\"onClick\"];\nimport StaticMapWithMarkers from '@/components/tooles/places/StaticMapWithMarkers.vue';\nimport { usePlaceStore } from '@/stores/place';\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue';\nimport { onMounted, computed, ref } from 'vue';\nexport default {\n  __name: 'PlacesList',\n  setup(__props) {\n    const placeStore = usePlaceStore();\n    const mapExpanded = ref(false);\n    const center = computed(() => {\n      const cord = placeStore.userCoordinate;\n      if (cord?.lat && cord?.lon) {\n        return {\n          lat: parseFloat(cord.lat),\n          lon: parseFloat(cord.lon)\n        };\n      }\n      return {\n        lat: 35.6892,\n        lon: 51.3890\n      };\n    });\n    const activePlaceId = ref(null);\n    const mapCenter = ref(center.value);\n    const flyToPlace = (id, lat, lon) => {\n      mapExpanded.value = false;\n      const lt = parseFloat(lat);\n      const ln = parseFloat(lon);\n      if (!isNaN(lt) && !isNaN(ln)) {\n        mapExpanded.value = true;\n        mapCenter.value = {\n          lat: lt,\n          lon: ln\n        };\n        activePlaceId.value = id;\n      } else {\n        console.warn('مختصات نامعتبر برای place:');\n      }\n    };\n    onMounted(() => {\n      placeStore.fetchAllPlaces();\n    });\n    const markers = computed(() => filteredPlaces.value.flatMap(place => (place.addresses || []).map(address => ({\n      lat: parseFloat(address.lat),\n      lon: parseFloat(address.lon),\n      address: address.address || '',\n      title: place.title || '',\n      description: place.description || '',\n      medias: place.medias || [],\n      categories: place.categories || [],\n      placeId: place.id\n    }))));\n    const selectedCategoryId = ref(null);\n    const allCategories = computed(() => {\n      const set = new Map();\n      placeStore.allPlaces.forEach(place => {\n        (place.categories || []).forEach(category => {\n          if (!set.has(Number(category.id))) {\n            set.set(Number(category.id), category);\n          }\n        });\n      });\n      return Array.from(set.values());\n    });\n    const filteredPlaces = computed(() => {\n      if (!selectedCategoryId.value) return placeStore.allPlaces;\n      return placeStore.allPlaces.filter(place => (place.categories || []).some(cat => Number(cat.id) === Number(selectedCategoryId.value)));\n    });\n    const truncateText = (text, max = 50) => {\n      if (!text) return '';\n      return text.length > max ? text.slice(0, max) + '...' : text;\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", {\n        class: _normalizeClass([\"map-in\", {\n          expanded: mapExpanded.value\n        }])\n      }, [_createVNode(StaticMapWithMarkers, {\n        center: mapCenter.value,\n        markers: markers.value,\n        activePlaceId: activePlaceId.value\n      }, null, 8, [\"center\", \"markers\", \"activePlaceId\"])], 2), _createElementVNode(\"button\", {\n        onClick: _cache[0] || (_cache[0] = $event => mapExpanded.value = !mapExpanded.value),\n        class: \"layout-toggle\"\n      }, _toDisplayString(mapExpanded.value ? '1' : '2'), 1), _createElementVNode(\"div\", {\n        class: _normalizeClass([\"containers\", {\n          expanded: mapExpanded.value\n        }])\n      }, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"button\", {\n        onClick: _cache[1] || (_cache[1] = $event => selectedCategoryId.value = null)\n      }, \"همه\"), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(allCategories.value, cat => {\n        return _openBlock(), _createElementBlock(\"button\", {\n          key: cat.id,\n          class: _normalizeClass({\n            active: selectedCategoryId.value === cat.id\n          }),\n          onClick: $event => selectedCategoryId.value = cat.id\n        }, _toDisplayString(cat.title), 11, _hoisted_2);\n      }), 128))]), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(filteredPlaces.value, place => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: place.id,\n          class: \"place-item\"\n        }, [_createElementVNode(\"h4\", null, _toDisplayString(place.title), 1), place.medias?.length > 0 ? (_openBlock(), _createBlock(MediaSlider, {\n          key: 0,\n          medias: place.medias\n        }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(place.categories, category => {\n          return _openBlock(), _createElementBlock(\"small\", {\n            class: \"cat\",\n            key: category.id\n          }, _toDisplayString(category.title), 1);\n        }), 128)), _createElementVNode(\"p\", null, _toDisplayString(truncateText(place.description)), 1), _createElementVNode(\"small\", null, _toDisplayString(truncateText(place.addresses?.[0]?.address) || ''), 1), place.addresses?.[0]?.lat && place.addresses?.[0]?.lon ? (_openBlock(), _createElementBlock(\"a\", {\n          key: 1,\n          onClick: _withModifiers($event => flyToPlace(place.id, place.addresses[0].lat, place.addresses[0].lon), [\"prevent\"])\n        }, \"محل دقیق\", 8, _hoisted_4)) : _createCommentVNode(\"\", true)]);\n      }), 128))])], 2)], 64);\n    };\n  }\n};","map":{"version":3,"names":["StaticMapWithMarkers","usePlaceStore","MediaSlider","onMounted","computed","ref","placeStore","mapExpanded","center","cord","userCoordinate","lat","lon","parseFloat","activePlaceId","mapCenter","value","flyToPlace","id","lt","ln","isNaN","console","warn","fetchAllPlaces","markers","filteredPlaces","flatMap","place","addresses","map","address","title","description","medias","categories","placeId","selectedCategoryId","allCategories","set","Map","allPlaces","forEach","category","has","Number","Array","from","values","filter","some","cat","truncateText","text","max","length","slice"],"sources":["D:/GitHub/chat/vue3/src/components/dashboard/pagesContent/PlacesList.vue"],"sourcesContent":["<template>\r\n  <div class=\"map-in\" :class=\"{ expanded: mapExpanded }\">\r\n    <StaticMapWithMarkers\r\n    :center=\"mapCenter\"\r\n    :markers=\"markers\"\r\n    :activePlaceId=\"activePlaceId\"\r\n    />\r\n  </div>\r\n  <button @click=\"mapExpanded=!mapExpanded\" class=\"layout-toggle\">\r\n    {{ mapExpanded ? '1' : '2' }}\r\n  </button>\r\n  <div class=\"containers\" :class=\"{ expanded: mapExpanded }\">\r\n    <div class=\"category\">\r\n      <button @click=\"selectedCategoryId = null\">همه</button>\r\n      <button\r\n        v-for=\"cat in allCategories\"\r\n        :key=\"cat.id\"\r\n        :class=\"{ active: selectedCategoryId === cat.id }\"\r\n        @click=\"selectedCategoryId = cat.id\">\r\n        {{ cat.title }}\r\n      </button>\r\n    </div>\r\n    <div class=\"info\">\r\n      <div v-for=\"place in filteredPlaces\" :key=\"place.id\" class=\"place-item\">\r\n        <h4>\r\n          {{ place.title }}\r\n        </h4>\r\n        <MediaSlider v-if=\"place.medias?.length>0\" :medias=\"place.medias\"/>\r\n        <small class=\"cat\" v-for=\"category in place.categories\" :key=\"category.id\">\r\n          {{ category.title }}\r\n        </small>\r\n        <p>{{ truncateText(place.description) }}</p>\r\n        <small>\r\n          {{ truncateText(place.addresses?.[0]?.address) || '' }}\r\n        </small>\r\n        <a v-if=\"place.addresses?.[0]?.lat && place.addresses?.[0]?.lon\" @click.prevent=\"flyToPlace(place.id,place.addresses[0].lat,place.addresses[0].lon)\">محل دقیق</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\n  import StaticMapWithMarkers from '@/components/tooles/places/StaticMapWithMarkers.vue'\r\n  import { usePlaceStore } from '@/stores/place'\r\n  import MediaSlider from '@/components/tooles/media/MediaSlider.vue'\r\n  import { onMounted, computed, ref } from 'vue'\r\n  const placeStore = usePlaceStore()\r\n  const mapExpanded = ref(false)\r\n  const center = computed(() => {\r\n    const cord = placeStore.userCoordinate\r\n    if (cord?.lat && cord?.lon) {\r\n      return { lat: parseFloat(cord.lat), lon: parseFloat(cord.lon) }\r\n    }\r\n    return { lat: 35.6892, lon: 51.3890 }\r\n  })\r\n  const activePlaceId = ref(null)\r\n  const mapCenter = ref(center.value)\r\n  const flyToPlace = (id,lat,lon) => {\r\n    mapExpanded.value=false\r\n    const lt = parseFloat(lat)\r\n    const ln = parseFloat(lon)\r\n    if (!isNaN(lt) && !isNaN(ln)) {\r\n      mapExpanded.value = true\r\n      mapCenter.value = { lat: lt, lon: ln }\r\n      activePlaceId.value = id\r\n    } else {\r\n      console.warn('مختصات نامعتبر برای place:')\r\n    }\r\n  }\r\n  onMounted(() => {\r\n    placeStore.fetchAllPlaces()\r\n  })\r\n  const markers = computed(() =>\r\n    filteredPlaces.value.flatMap(place =>\r\n      (place.addresses || []).map(address => ({\r\n        lat: parseFloat(address.lat),\r\n        lon: parseFloat(address.lon),\r\n        address: address.address || '',\r\n        title: place.title || '',\r\n        description: place.description || '',\r\n        medias: place.medias || [],\r\n        categories: place.categories || [],\r\n        placeId: place.id\r\n      }))\r\n    )\r\n  )\r\n  const selectedCategoryId = ref(null)\r\n  const allCategories = computed(() => {\r\n    const set = new Map()\r\n    placeStore.allPlaces.forEach(place => {\r\n      (place.categories || []).forEach(category => {\r\n        if (!set.has(Number(category.id))) {\r\n          set.set(Number(category.id), category)\r\n        }\r\n      })\r\n    })\r\n    return Array.from(set.values())\r\n  })\r\n  const filteredPlaces = computed(() => {\r\n    if (!selectedCategoryId.value) return placeStore.allPlaces\r\n    return placeStore.allPlaces.filter(place =>\r\n      (place.categories || []).some(cat => Number(cat.id) === Number(selectedCategoryId.value))\r\n    )\r\n  })\r\n  const truncateText = (text, max = 50) => {\r\n    if (!text) return ''\r\n    return text.length > max ? text.slice(0, max) + '...' : text\r\n  }\r\n</script>\r\n<style>\r\n  .map-in{\r\n    height: 75%;\r\n    width: 100%;\r\n    transition: height 0.3s ease;\r\n    margin-bottom: 2%;\r\n    opacity: 1;\r\n  }\r\n  .layout-toggle{\r\n    width: 100%;\r\n    margin-bottom: 2%;\r\n    height: 1%;\r\n    border: none;\r\n    background: red;\r\n    outline: none;\r\n  }\r\n  .containers{\r\n    height: 20%;\r\n    opacity: 0.3;\r\n    display: flex;\r\n    gap: 2%;\r\n    flex-direction: row-reverse;\r\n    align-items: stretch;\r\n    justify-content: center;\r\n    flex-wrap: nowrap;\r\n  }\r\n  .map-in.expanded{\r\n    height: 20%;\r\n    opacity: 0.3;\r\n  }\r\n  .containers.expanded{\r\n    height: 75%;\r\n    opacity: 1;\r\n  }\r\n  .category{\r\n    height: 100%;\r\n    float: right;\r\n    width: 29%;\r\n    overflow: auto;\r\n    display: flex;\r\n    flex-direction: column;\r\n    flex-wrap: nowrap;\r\n    align-items: stretch;\r\n    justify-content: flex-start;\r\n    gap: 2px;\r\n  }\r\n  .info{\r\n    height: 100%;\r\n    gap: 10px;\r\n    overflow: auto;\r\n    width: 69%;\r\n    display: flex;\r\n    flex-direction: row-reverse;\r\n    flex-wrap: wrap;\r\n    align-content: flex-start;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n  .category button {\r\n    color: white;\r\n    background: #4a6b75;\r\n    padding: 8px;\r\n    border: none;\r\n    outline: none;\r\n    border-radius: 10px;\r\n    box-shadow: 0 0 5px green;\r\n  }\r\n  .place-item {\r\n    position: sticky;\r\n    top: 0;\r\n    padding: 10px;\r\n    box-sizing: border-box;\r\n    background: #bcebbc;\r\n    border-radius: 10px;\r\n    width: 100%;\r\n    text-align: center;\r\n  }\r\n  h4,p,small{\r\n    margin: 0 0 5px 0;\r\n  }\r\n  .place-item a {\r\n    width: 100%;\r\n    display: inline-block;\r\n    padding: 10px;\r\n    background: yellow;\r\n    border-radius: 10px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n  }\r\n  .cat{\r\n    padding: 3px 5px;\r\n    background: lightgrey;\r\n    border-radius: 5px;\r\n    display: inline-block;\r\n    margin: 5px;\r\n  }\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}