{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { ref, watch, onBeforeUnmount } from 'vue';\nexport function useInfiniteScroll(fetchFn, {\n  limit = 10,\n  total = null,\n  // این میتونه ref یا مقدار ساده باشه\n  immediate = true\n} = {}) {\n  const items = ref([]);\n  const loading = ref(false);\n  const offset = ref(0);\n  const canLoadMore = ref(true);\n  const loadMoreTrigger = ref(null);\n  let observer = null;\n\n  // اگر total یک ref هست (واکنشگرا)، watch کنش کن\n  if (total && typeof total === 'object' && 'value' in total) {\n    watch(total, newVal => {\n      canLoadMore.value = items.value.length < newVal;\n    });\n  }\n  const loadMore = async () => {\n    if (loading.value || !canLoadMore.value) return;\n    loading.value = true;\n    try {\n      const result = await fetchFn({\n        limit,\n        offset: offset.value\n      });\n      const newItems = Array.isArray(result) ? result : [];\n      const filteredNewItems = newItems.filter(item => item != null);\n      if (filteredNewItems.length < limit || total && items.value.length + filteredNewItems.length >= (total.value ?? total)) {\n        canLoadMore.value = false;\n      }\n      items.value.push(...filteredNewItems);\n      offset.value += filteredNewItems.length;\n    } catch (error) {\n      console.error('Error loading more items:', error);\n    } finally {\n      loading.value = false;\n    }\n  };\n  const setupObserver = () => {\n    if (observer) observer.disconnect();\n    observer = new IntersectionObserver(async ([entry]) => {\n      if (entry.isIntersecting && canLoadMore.value && !loading.value) {\n        await loadMore();\n      }\n    }, {\n      root: null,\n      rootMargin: '0px',\n      threshold: 1.0\n    });\n    if (loadMoreTrigger.value) {\n      observer.observe(loadMoreTrigger.value);\n    }\n  };\n  onBeforeUnmount(() => {\n    if (observer) observer.disconnect();\n  });\n  if (immediate) loadMore();\n  return {\n    items,\n    loading,\n    canLoadMore,\n    loadMore,\n    loadMoreTrigger,\n    setupObserver\n  };\n}","map":{"version":3,"names":["ref","watch","onBeforeUnmount","useInfiniteScroll","fetchFn","limit","total","immediate","items","loading","offset","canLoadMore","loadMoreTrigger","observer","newVal","value","length","loadMore","result","newItems","Array","isArray","filteredNewItems","filter","item","push","error","console","setupObserver","disconnect","IntersectionObserver","entry","isIntersecting","root","rootMargin","threshold","observe"],"sources":["D:/GitHub/ci3-vue3/vue3/src/composables/useInfiniteScroll.js"],"sourcesContent":["import { ref, watch , onBeforeUnmount } from 'vue'\r\n\r\nexport function useInfiniteScroll(fetchFn, {\r\n    limit = 10,\r\n    total = null,  // این میتونه ref یا مقدار ساده باشه\r\n    immediate = true,\r\n} = {}) {\r\n    const items = ref([])\r\n    const loading = ref(false)\r\n    const offset = ref(0)\r\n    const canLoadMore = ref(true)\r\n    const loadMoreTrigger = ref(null)\r\n    let observer = null\r\n\r\n    // اگر total یک ref هست (واکنشگرا)، watch کنش کن\r\n    if (total && typeof total === 'object' && 'value' in total) {\r\n        watch(total, (newVal) => {\r\n            canLoadMore.value = items.value.length < newVal\r\n        })\r\n    }\r\n\r\n    const loadMore = async () => {\r\n        if (loading.value || !canLoadMore.value) return\r\n        loading.value = true\r\n\r\n        try {\r\n            const result = await fetchFn({ limit, offset: offset.value })\r\n            const newItems = Array.isArray(result) ? result : []\r\n            const filteredNewItems = newItems.filter(item => item != null)\r\n\r\n            if (filteredNewItems.length < limit || (total && items.value.length + filteredNewItems.length >= (total.value ?? total))) {\r\n                canLoadMore.value = false\r\n            }\r\n\r\n            items.value.push(...filteredNewItems)\r\n            offset.value += filteredNewItems.length\r\n        } catch (error) {\r\n            console.error('Error loading more items:', error)\r\n        } finally {\r\n            loading.value = false\r\n        }\r\n    }\r\n\r\n    const setupObserver = () => {\r\n        if (observer) observer.disconnect()\r\n\r\n        observer = new IntersectionObserver(async ([entry]) => {\r\n            if (entry.isIntersecting && canLoadMore.value && !loading.value) {\r\n                await loadMore()\r\n            }\r\n        }, {\r\n            root: null,\r\n            rootMargin: '0px',\r\n            threshold: 1.0,\r\n        })\r\n\r\n        if (loadMoreTrigger.value) {\r\n            observer.observe(loadMoreTrigger.value)\r\n        }\r\n    }\r\n\r\n    onBeforeUnmount(() => {\r\n        if (observer) observer.disconnect()\r\n    })\r\n\r\n    if (immediate) loadMore()\r\n\r\n    return {\r\n        items,\r\n        loading,\r\n        canLoadMore,\r\n        loadMore,\r\n        loadMoreTrigger,\r\n        setupObserver,\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}