{"ast":null,"code":"import { unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createBlock as _createBlock, createElementVNode as _createElementVNode, createVNode as _createVNode, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = {\n  class: \"inner-posts\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"none-cart-error\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"toast\"\n};\nimport { ref, onMounted } from 'vue';\nimport { useNewsStore } from '@/stores/news';\n// import moment from 'moment-jalaali'\n// import MediaSlider from '@/components/tooles/media/MediaSlider.vue'\nimport CalendarModal from '@/components/tooles/news/CalendarModal.vue';\n// import { usePollingWithCompare } from '@/composables/usePollingWithCompare'\n// import { useInfiniteScroll } from '@/composables/useInfiniteScroll'\nimport AddNewsForm from '@/components/dashboard/pagesContent/AddNewsForm.vue';\n// import router from '@/router'\n\nexport default {\n  __name: 'NewsCards',\n  setup(__props) {\n    // import { ref, onMounted , computed } from 'vue'\n    const newsStore = useNewsStore();\n    const toastMsg = ref('');\n    // const selectedNewsId = ref(null)\n    const showModal = ref(false);\n    // function showToast(msg) {\n    //     toastMsg.value = msg\n    //     setTimeout(() => (toastMsg.value = ''), 3000)\n    // }\n    // const replyToId = ref(0)\n    // function handleReply(newsId) {\n    //   replyToId.value = newsId\n    // }\n    // const fetchNews = async ({ limit, offset }) => {\n    //   const res = await newsStore.fetchNews({ limit, offset, append: true })\n    //   return Array.isArray(res) ? res : []\n    // }\n    // const total = computed(() => newsStore.total)\n    // const {\n    //     items: visibleNews,\n    //     loadMoreTrigger,\n    //     setupObserver,\n    // } = useInfiniteScroll(fetchNews, { limit: 10,total: total, immediate: true })\n    // usePollingWithCompare( \n    //     () => newsStore.fetchLatestNewsRaw(5, 0), {\n    //     intervalMs: 6000,\n    //     isDifferent: (oldData, newData) => {\n    //         const oldIds = (oldData || []).map(i => i.id)\n    //         const newIds = (newData || []).map(i => i.id)\n    //         return JSON.stringify(oldIds) !== JSON.stringify(newIds)\n    //     },\n    //     onChange: async (newCards) => {\n    //         const filtered = newCards.filter(item => !newsStore.cards.some(card => card.id === item.id))\n    //         if (filtered.length) {\n    //             if(filtered.length>10){\n    //               const scrollTop = window.scrollY\n    //               await newsStore.fetchNews({ limit: 10, offset: 0, append: false })\n    //               showToast('خبر جدید رسید!')\n    //               window.scrollTo(0, scrollTop)\n    //             }else{\n    //               newsStore.cards = [...filtered, ...newsStore.cards]\n    //               newsStore.total += filtered.length\n    //               showToast('خبر جدید رسید!')\n    //             }\n    //         }\n    //     }\n    // })\n    // function openCalendarModal(id) {\n    //     selectedNewsId.value = id\n    //     showModal.value = true\n    // }\n    // async function onCalendarSubmit({ date }) {\n    //     const jsDate = date ? moment(date, 'jYYYY/jMM/jDD').toDate() : null\n    //     const success = await newsStore.scheduleNewsRunTime(selectedNewsId.value, jsDate)\n    //     if (success) {\n    //         showModal.value = false\n    //         await newsStore.fetchNews()\n    //         router.push({ path:'/cartable' })\n    //     } else {\n    //         alert('خطا در ثبت تاریخ اجرا')\n    //     }\n    // }\n    onMounted(() => {\n      newsStore.fetchLatestNewsRaw(5, 0);\n      // setTimeout(() => {\n      //   setupObserver()\n      // }, 100)\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [!_unref(newsStore).isLoaded ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" در حال بارگذاری... \")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, \" خبری در محدوده شما وجود ندارد \")), toastMsg.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, _toDisplayString(toastMsg.value), 1)) : _createCommentVNode(\"\", true), showModal.value ? (_openBlock(), _createBlock(CalendarModal, {\n        key: 3,\n        onClose: _cache[0] || (_cache[0] = $event => showModal.value = false),\n        onSubmit: _ctx.onCalendarSubmit\n      }, null, 8, [\"onSubmit\"])) : _createCommentVNode(\"\", true)]), _createVNode(AddNewsForm, {\n        \"reply-to-id\": _ctx.replyToId\n      }, null, 8, [\"reply-to-id\"])], 64);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useNewsStore","CalendarModal","AddNewsForm","newsStore","toastMsg","showModal","fetchLatestNewsRaw"],"sources":["D:/GitHub/chat/vue3/src/components/dashboard/pagesContent/NewsCards.vue"],"sourcesContent":["<template>\r\n  <div class=\"inner-posts\">\r\n    <div class=\"loading\" v-if=\"!newsStore.isLoaded\">\r\n      در حال بارگذاری...\r\n    </div>\r\n    <!-- <div class=\"card-inner\" v-else-if=\"visibleNews.length > 0\">\r\n      <div v-for=\"card in visibleNews\" :key=\"card.id\" class=\"card\">\r\n        <div class=\"user-info\">\r\n          <img v-if=\"card.user?.image\" :src=\"card.user.image\" alt=\"user\" />\r\n          <svg v-else xmlns=\"http://www.w3.org/2000/svg\" fill=\"#000000\" enable-background=\"new 0 0 24 24\" viewBox=\"0 0 24 24\"><g><rect fill=\"none\" height=\"24\" width=\"24\"/></g><g><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"/></g></svg>\r\n          <p v-if=\"card.user?.name || card.user?.family\">\r\n            {{ card.user.name }} {{ card.user.family }}\r\n          </p>\r\n        </div>\r\n        <div class=\"media-inner\">\r\n          <MediaSlider v-if=\"card.medias.length > 0\" :medias=\"card.medias\" />\r\n        </div>\r\n        <div class=\"card-category\" v-if=\"!newsStore.hasRule && card.category.length\">\r\n          <span class=\"category\" v-for=\"category in card.category\" :key=\"category.id\">\r\n            {{ category.title }}\r\n          </span>\r\n        </div>\r\n        <div class=\"description\" v-if=\"card.description\">\r\n          {{ card.description }}\r\n        </div>\r\n        <div class=\"location\" v-if=\"card.location?.city\">\r\n          📍 {{ card.location.city }}\r\n        </div>\r\n        <div class=\"time\">\r\n          {{ moment(card.created_at).format('jYYYY/jMM/jDD') }}\r\n        </div>\r\n        <RouterLink class=\"c-d\" :to=\"{ path: `/show-news/${card.id}` }\">\r\n          مشاهده\r\n        </RouterLink>\r\n        <a\r\n          class=\"choose\"\r\n          v-if=\"newsStore.hasRule\"\r\n          @click=\"handleReply(card.id)\"\r\n        >\r\n          پاسخ\r\n        </a>\r\n        <a\r\n          class=\"choose\"\r\n          v-if=\"newsStore.hasRule\"\r\n          @click=\"openCalendarModal(card.id)\"\r\n        >\r\n          قرار ملاقات\r\n        </a>\r\n      </div>\r\n      <div ref=\"loadMoreTrigger\" class=\"scroll-trigger\"></div>\r\n    </div> -->\r\n    <div v-else class=\"none-cart-error\">\r\n      خبری در محدوده شما وجود ندارد\r\n    </div>\r\n    <div v-if=\"toastMsg\" class=\"toast\">\r\n      {{ toastMsg }}\r\n    </div>\r\n    <CalendarModal\r\n    v-if=\"showModal\"\r\n    @close=\"showModal = false\"\r\n    @submit=\"onCalendarSubmit\"\r\n    />\r\n  </div>\r\n  <AddNewsForm :reply-to-id=\"replyToId\" />\r\n</template>\r\n<script setup>\r\n    // import { ref, onMounted , computed } from 'vue'\r\n    import { ref, onMounted  } from 'vue'\r\n    import { useNewsStore } from '@/stores/news'\r\n    // import moment from 'moment-jalaali'\r\n    // import MediaSlider from '@/components/tooles/media/MediaSlider.vue'\r\n    import CalendarModal from '@/components/tooles/news/CalendarModal.vue'\r\n    // import { usePollingWithCompare } from '@/composables/usePollingWithCompare'\r\n    // import { useInfiniteScroll } from '@/composables/useInfiniteScroll'\r\n    import AddNewsForm from '@/components/dashboard/pagesContent/AddNewsForm.vue'\r\n    // import router from '@/router'\r\n    const newsStore = useNewsStore()\r\n    const toastMsg = ref('')\r\n    // const selectedNewsId = ref(null)\r\n    const showModal = ref(false)\r\n    // function showToast(msg) {\r\n    //     toastMsg.value = msg\r\n    //     setTimeout(() => (toastMsg.value = ''), 3000)\r\n    // }\r\n    // const replyToId = ref(0)\r\n    // function handleReply(newsId) {\r\n    //   replyToId.value = newsId\r\n    // }\r\n    // const fetchNews = async ({ limit, offset }) => {\r\n    //   const res = await newsStore.fetchNews({ limit, offset, append: true })\r\n    //   return Array.isArray(res) ? res : []\r\n    // }\r\n    // const total = computed(() => newsStore.total)\r\n    // const {\r\n    //     items: visibleNews,\r\n    //     loadMoreTrigger,\r\n    //     setupObserver,\r\n    // } = useInfiniteScroll(fetchNews, { limit: 10,total: total, immediate: true })\r\n    // usePollingWithCompare( \r\n    //     () => newsStore.fetchLatestNewsRaw(5, 0), {\r\n    //     intervalMs: 6000,\r\n    //     isDifferent: (oldData, newData) => {\r\n    //         const oldIds = (oldData || []).map(i => i.id)\r\n    //         const newIds = (newData || []).map(i => i.id)\r\n    //         return JSON.stringify(oldIds) !== JSON.stringify(newIds)\r\n    //     },\r\n    //     onChange: async (newCards) => {\r\n    //         const filtered = newCards.filter(item => !newsStore.cards.some(card => card.id === item.id))\r\n    //         if (filtered.length) {\r\n    //             if(filtered.length>10){\r\n    //               const scrollTop = window.scrollY\r\n    //               await newsStore.fetchNews({ limit: 10, offset: 0, append: false })\r\n    //               showToast('خبر جدید رسید!')\r\n    //               window.scrollTo(0, scrollTop)\r\n    //             }else{\r\n    //               newsStore.cards = [...filtered, ...newsStore.cards]\r\n    //               newsStore.total += filtered.length\r\n    //               showToast('خبر جدید رسید!')\r\n    //             }\r\n    //         }\r\n    //     }\r\n    // })\r\n    // function openCalendarModal(id) {\r\n    //     selectedNewsId.value = id\r\n    //     showModal.value = true\r\n    // }\r\n    // async function onCalendarSubmit({ date }) {\r\n    //     const jsDate = date ? moment(date, 'jYYYY/jMM/jDD').toDate() : null\r\n    //     const success = await newsStore.scheduleNewsRunTime(selectedNewsId.value, jsDate)\r\n    //     if (success) {\r\n    //         showModal.value = false\r\n    //         await newsStore.fetchNews()\r\n    //         router.push({ path:'/cartable' })\r\n    //     } else {\r\n    //         alert('خطا در ثبت تاریخ اجرا')\r\n    //     }\r\n    // }\r\n    onMounted(() => {\r\n      newsStore.fetchLatestNewsRaw(5, 0)\r\n      // setTimeout(() => {\r\n      //   setupObserver()\r\n      // }, 100)\r\n    })\r\n</script>\r\n<style scoped>\r\n  .inner-posts{\r\n    position: fixed;\r\n    left: 0%;\r\n    right: 0%;\r\n    top: 65px;\r\n    bottom: 50px;\r\n    width: auto;\r\n    height: auto;\r\n    overflow-y: auto;\r\n  }\r\n    .scroll-trigger {\r\n        height: 1px;\r\n    }\r\n    .toast {\r\n        position: fixed;\r\n        bottom: 50px;\r\n        left: 20px;\r\n        background: #2ecc71;\r\n        color: white;\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);\r\n    }\r\n    .loading,.none-cart-error{\r\n        text-align: center;\r\n        padding: 20px;\r\n        color: white;\r\n        font-size: 20px;\r\n        border-radius: 10px;\r\n        box-shadow: 0 0 10px grey;\r\n        font-weight: bold;\r\n    }\r\n    .loading{\r\n        background: rgb(16, 16, 143);\r\n    }\r\n    .none-cart-error {\r\n        background: rgb(128, 12, 12);\r\n    }\r\n    .media-inner {\r\n        background: white;\r\n        padding: 5px;\r\n    }\r\n    .location {\r\n        margin: 5px;\r\n        gap: 5px;\r\n        display: flex;\r\n        font-size: 11px;\r\n        align-items: center;\r\n    }\r\n    .location svg{\r\n        height: 20px;\r\n        width: 20px;\r\n    }\r\n    .user-info svg,.user-info img{\r\n        width: 50px;\r\n        height: 50px;\r\n        border-radius: 50px;\r\n        display: inline-block;\r\n    }\r\n    .user-info p{\r\n        display: inline-block;\r\n    }\r\n    .user-info{\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        padding: 10px;\r\n    }\r\n    .card-category {\r\n        text-align: center;\r\n        padding: 10px;\r\n        background: floralwhite;\r\n    }\r\n    .card-inner {\r\n        width: 100%;\r\n        direction: rtl;\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: row-reverse;\r\n        flex-wrap: wrap;\r\n        align-content: flex-start;\r\n        justify-content: center;\r\n        align-items: stretch;\r\n    }\r\n    .card {\r\n        background: #f5f5f5;\r\n        width: 49%;\r\n        min-height: 300px;\r\n        margin: 0 0.5% 10px 0.5%;\r\n        border-radius: 10px;\r\n        box-shadow: 0 0 5px grey;\r\n    }\r\n    .media {\r\n        height: 150px;\r\n        width: auto;\r\n        margin: auto;\r\n    }\r\n    .media img,\r\n    .media video {\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .card-header {\r\n        display: flex;\r\n        flex-direction: row-reverse;\r\n        flex-wrap: nowrap;\r\n        justify-content: space-between;\r\n        align-items: stretch;\r\n        padding: 6px;\r\n    }\r\n    .description {\r\n        min-height: 50px;\r\n        padding: 10px;\r\n        width: 95%;\r\n        text-align: center;\r\n        word-wrap: break-word;\r\n    }\r\n    .time {\r\n        font-size: 10px;\r\n        padding-left: 10px;\r\n        text-align: end;\r\n        margin: 5px;\r\n    }\r\n    .choose ,.c-d {\r\n        width: 95%;\r\n        /* height: 30px; */\r\n        background: rgb(7, 71, 11);\r\n        margin: 5px auto;\r\n        text-align: center;\r\n        border-radius: 10px;\r\n        color: white;\r\n        display: block;\r\n        padding: 10px;\r\n        box-sizing: border-box;\r\n    }\r\n    .c-d {\r\n        background: #071847;\r\n        text-decoration: none;\r\n    }\r\n    @media screen and (max-width: 600px) {\r\n        .card {\r\n            width: 99%;\r\n        }\r\n    }\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;AAmEI,SAASA,GAAG,EAAEC,SAAS,QAAS,KAAK;AACrC,SAASC,YAAY,QAAQ,eAAe;AAC5C;AACA;AACA,OAAOC,aAAa,MAAM,4CAA4C;AACtE;AACA;AACA,OAAOC,WAAW,MAAM,qDAAqD;AAC7E;;;;;IATA;IAUA,MAAMC,SAAS,GAAGH,YAAY,CAAC,CAAC;IAChC,MAAMI,QAAQ,GAAGN,GAAG,CAAC,EAAE,CAAC;IACxB;IACA,MAAMO,SAAS,GAAGP,GAAG,CAAC,KAAK,CAAC;IAC5B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAC,SAAS,CAAC,MAAM;MACdI,SAAS,CAACG,kBAAkB,CAAC,CAAC,EAAE,CAAC,CAAC;MAClC;MACA;MACA;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}