{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"discount-cards-section\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"no-data\"\n};\nconst _hoisted_5 = {\n  class: \"cards-list\"\n};\nconst _hoisted_6 = {\n  class: \"card-header\"\n};\nconst _hoisted_7 = {\n  class: \"card-title\"\n};\nconst _hoisted_8 = {\n  class: \"discount\"\n};\nconst _hoisted_9 = {\n  class: \"card-details\"\n};\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  key: 1,\n  class: \"valid\"\n};\nimport { onMounted, onUnmounted, ref, computed } from 'vue';\nimport { useWalletStore } from '@/stores/walletStore';\nconst perPage = 5;\n// onMounted(async () => {\n//   if (!store.discountCardsLoaded) await store.fetchDiscountCards()\n//   store.startPolling()\n// })\n// onUnmounted(() => {\n//   store.stopPolling()\n// })\n\nexport default {\n  __name: 'DiscountCardsSection',\n  setup(__props) {\n    const store = useWalletStore();\n    const currentPage = ref(1);\n    const paginatedCards = computed(() => {\n      return store.discountCards.slice(0, currentPage.value * perPage);\n    });\n    const hasMore = computed(() => {\n      return store.discountCards.length > paginatedCards.value.length;\n    });\n    const loadMore = () => {\n      currentPage.value++;\n    };\n    const startPolling = () => {\n      if (pollingInterval) return;\n      store.fetchDiscountCards();\n      pollingInterval = setInterval(() => {\n        store.fetchData();\n      }, 10000);\n    };\n    const stopPolling = () => {\n      clearInterval(pollingInterval);\n      pollingInterval = null;\n    };\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        startPolling();\n      } else {\n        stopPolling();\n      }\n    };\n    onMounted(() => {\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n      if (document.visibilityState === 'visible') {\n        startPolling();\n      }\n    });\n    onUnmounted(() => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      stopPolling();\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[0] || (_cache[0] = _createElementVNode(\"h2\", {\n        class: \"section-title\"\n      }, \"کارت‌های تخفیف\", -1)), _ctx.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"در حال بارگذاری...\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_ctx.cards.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \" شما هیچ کارت تخفیفی دریافت نکرده‌اید. \")) : _createCommentVNode(\"\", true), _createElementVNode(\"ul\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.cards, card => {\n        return _openBlock(), _createElementBlock(\"li\", {\n          key: card.id,\n          class: \"card-item\"\n        }, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"span\", _hoisted_7, _toDisplayString(card.title), 1), _createElementVNode(\"span\", _hoisted_8, _toDisplayString(card.discount_percent) + \"٪ تخفیف\", 1)]), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"p\", null, \"تاریخ انقضا: \" + _toDisplayString(_ctx.formatDate(card.expire_at)), 1), card.used_at ? (_openBlock(), _createElementBlock(\"p\", _hoisted_10, \"استفاده شده در: \" + _toDisplayString(_ctx.formatDate(card.used_at)), 1)) : (_openBlock(), _createElementBlock(\"p\", _hoisted_11, \"وضعیت: قابل استفاده\"))])]);\n      }), 128))]), hasMore.value ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 1,\n        onClick: loadMore\n      }, \"نمایش بیشتر\")) : _createCommentVNode(\"\", true)]))]);\n    };\n  }\n};","map":{"version":3,"names":["onMounted","onUnmounted","ref","computed","useWalletStore","perPage","store","currentPage","paginatedCards","discountCards","slice","value","hasMore","length","loadMore","startPolling","pollingInterval","fetchDiscountCards","setInterval","fetchData","stopPolling","clearInterval","handleVisibilityChange","document","visibilityState","addEventListener","removeEventListener"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/wallet/DiscountCardsSection.vue"],"sourcesContent":["<template>\r\n  <div class=\"discount-cards-section\">\r\n    <h2 class=\"section-title\">کارت‌های تخفیف</h2>\r\n\r\n    <div v-if=\"loading\" class=\"loading\">در حال بارگذاری...</div>\r\n\r\n    <div v-else>\r\n      <div v-if=\"cards.length === 0\" class=\"no-data\">\r\n        شما هیچ کارت تخفیفی دریافت نکرده‌اید.\r\n      </div>\r\n\r\n      <ul class=\"cards-list\">\r\n        <li v-for=\"card in cards\" :key=\"card.id\" class=\"card-item\">\r\n          <div class=\"card-header\">\r\n            <span class=\"card-title\">{{ card.title }}</span>\r\n            <span class=\"discount\">{{ card.discount_percent }}٪ تخفیف</span>\r\n          </div>\r\n          <div class=\"card-details\">\r\n            <p>تاریخ انقضا: {{ formatDate(card.expire_at) }}</p>\r\n            <p v-if=\"card.used_at\">استفاده شده در: {{ formatDate(card.used_at) }}</p>\r\n            <p v-else class=\"valid\">وضعیت: قابل استفاده</p>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    <button v-if=\"hasMore\" @click=\"loadMore\">نمایش بیشتر</button>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { onMounted, onUnmounted, ref, computed } from 'vue'\r\n  import { useWalletStore } from '@/stores/walletStore'\r\n  const store = useWalletStore()\r\n  const currentPage = ref(1)\r\n  const perPage = 5\r\n  // onMounted(async () => {\r\n  //   if (!store.discountCardsLoaded) await store.fetchDiscountCards()\r\n  //   store.startPolling()\r\n  // })\r\n  // onUnmounted(() => {\r\n  //   store.stopPolling()\r\n  // })\r\n  const paginatedCards = computed(() => {\r\n    return store.discountCards.slice(0, currentPage.value * perPage)\r\n  })\r\n  const hasMore = computed(() => {\r\n    return store.discountCards.length > paginatedCards.value.length\r\n  })\r\n  const loadMore = () => {\r\n    currentPage.value++\r\n  }\r\n  const startPolling = () => {\r\n    if (pollingInterval) return\r\n    store.fetchDiscountCards()\r\n    pollingInterval = setInterval(() => {\r\n      store.fetchData()\r\n    }, 10000)\r\n  }\r\n\r\n  const stopPolling = () => {\r\n    clearInterval(pollingInterval)\r\n    pollingInterval = null\r\n  }\r\n\r\n  const handleVisibilityChange = () => {\r\n    if (document.visibilityState === 'visible') {\r\n      startPolling()\r\n    } else {\r\n      stopPolling()\r\n    }\r\n  }\r\n\r\n  onMounted(() => {\r\n    document.addEventListener('visibilitychange', handleVisibilityChange)\r\n    if (document.visibilityState === 'visible') {\r\n      startPolling()\r\n    }\r\n  })\r\n\r\n  onUnmounted(() => {\r\n    document.removeEventListener('visibilitychange', handleVisibilityChange)\r\n    stopPolling()\r\n  })\r\n</script>\r\n\r\n<style scoped>\r\n.discount-cards-section {\r\n  padding: 1rem;\r\n}\r\n.section-title {\r\n  font-size: 1.2rem;\r\n  font-weight: bold;\r\n  margin-bottom: 1rem;\r\n}\r\n.cards-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1rem;\r\n}\r\n.card-item {\r\n  border: 1px solid #ddd;\r\n  border-radius: 8px;\r\n  padding: 1rem;\r\n}\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 0.5rem;\r\n}\r\n.card-title {\r\n  font-weight: bold;\r\n}\r\n.discount {\r\n  color: #dc2626;\r\n}\r\n.valid {\r\n  color: #16a34a;\r\n  font-weight: bold;\r\n}\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BE,SAASA,SAAS,EAAEC,WAAW,EAAEC,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AAC3D,SAASC,cAAc,QAAQ,sBAAsB;AAGrD,MAAMC,OAAO,GAAG,CAAC;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;;;;;IATA,MAAMC,KAAK,GAAGF,cAAc,CAAC,CAAC;IAC9B,MAAMG,WAAW,GAAGL,GAAG,CAAC,CAAC,CAAC;IAS1B,MAAMM,cAAc,GAAGL,QAAQ,CAAC,MAAM;MACpC,OAAOG,KAAK,CAACG,aAAa,CAACC,KAAK,CAAC,CAAC,EAAEH,WAAW,CAACI,KAAK,GAAGN,OAAO,CAAC;IAClE,CAAC,CAAC;IACF,MAAMO,OAAO,GAAGT,QAAQ,CAAC,MAAM;MAC7B,OAAOG,KAAK,CAACG,aAAa,CAACI,MAAM,GAAGL,cAAc,CAACG,KAAK,CAACE,MAAM;IACjE,CAAC,CAAC;IACF,MAAMC,QAAQ,GAAGA,CAAA,KAAM;MACrBP,WAAW,CAACI,KAAK,EAAE;IACrB,CAAC;IACD,MAAMI,YAAY,GAAGA,CAAA,KAAM;MACzB,IAAIC,eAAe,EAAE;MACrBV,KAAK,CAACW,kBAAkB,CAAC,CAAC;MAC1BD,eAAe,GAAGE,WAAW,CAAC,MAAM;QAClCZ,KAAK,CAACa,SAAS,CAAC,CAAC;MACnB,CAAC,EAAE,KAAK,CAAC;IACX,CAAC;IAED,MAAMC,WAAW,GAAGA,CAAA,KAAM;MACxBC,aAAa,CAACL,eAAe,CAAC;MAC9BA,eAAe,GAAG,IAAI;IACxB,CAAC;IAED,MAAMM,sBAAsB,GAAGA,CAAA,KAAM;MACnC,IAAIC,QAAQ,CAACC,eAAe,KAAK,SAAS,EAAE;QAC1CT,YAAY,CAAC,CAAC;MAChB,CAAC,MAAM;QACLK,WAAW,CAAC,CAAC;MACf;IACF,CAAC;IAEDpB,SAAS,CAAC,MAAM;MACduB,QAAQ,CAACE,gBAAgB,CAAC,kBAAkB,EAAEH,sBAAsB,CAAC;MACrE,IAAIC,QAAQ,CAACC,eAAe,KAAK,SAAS,EAAE;QAC1CT,YAAY,CAAC,CAAC;MAChB;IACF,CAAC,CAAC;IAEFd,WAAW,CAAC,MAAM;MAChBsB,QAAQ,CAACG,mBAAmB,CAAC,kBAAkB,EAAEJ,sBAAsB,CAAC;MACxEF,WAAW,CAAC,CAAC;IACf,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}