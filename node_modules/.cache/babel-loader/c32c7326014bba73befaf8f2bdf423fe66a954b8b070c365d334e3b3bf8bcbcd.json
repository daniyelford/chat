{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, withCtx as _withCtx, createVNode as _createVNode, vModelText as _vModelText, withDirectives as _withDirectives, unref as _unref, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = [\"disabled\"];\nimport { ref, onMounted, computed } from 'vue';\nimport { sendApi } from '@/utils/api';\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue';\nimport Multiselect from 'vue-multiselect';\nimport 'vue-multiselect/dist/vue-multiselect.min.css';\nimport AddressSelector from '@/components/tooles/news/AddressSelector .vue';\nexport default {\n  __name: 'AddNewsForm',\n  setup(__props) {\n    const categories = ref([]);\n    const address = ref('');\n    const rule = ref(false);\n    const isAddressLoading = ref(false);\n    const form = ref({\n      category_id: [],\n      user_address: {\n        type: 'city',\n        value: ''\n      },\n      media_id: [],\n      description: ''\n    });\n    const handleUploadResult = uploadedData => {\n      form.value.media_id = uploadedData.map(item => item.id);\n    };\n    onMounted(async () => {\n      const data = await sendApi({\n        control: 'news',\n        action: 'add_data'\n      });\n      if (data.status === 'success') {\n        rule.value = data.rule;\n        address.value = data.address;\n        if (rule.value) {\n          categories.value = data.category ? [data.category] : [];\n          form.value.category_id = data.category ? [data.category] : [];\n        } else {\n          categories.value = data.category ?? [];\n        }\n      }\n    });\n    const isSubmitDisabled = computed(() => {\n      const isDescriptionEmpty = !form.value.description.trim();\n      const isCategoryInvalid = !rule.value && (!form.value.category_id || form.value.category_id.length === 0);\n      const isLocationSelected = form.value.user_address?.type === 'location';\n      const isAddressInvalid = isLocationSelected && (!form.value.user_address?.value || !form.value.user_address.value.address?.trim());\n      const isStillLoading = isLocationSelected && isAddressLoading.value;\n      return isDescriptionEmpty || isCategoryInvalid || isAddressInvalid || isStillLoading;\n    });\n    const submitForm = async () => {\n      const finalData = {\n        ...form.value,\n        category_id: form.value.category_id.map(c => c.id)\n      };\n      try {\n        const res = await sendApi({\n          control: 'news',\n          action: 'add_news',\n          data: finalData\n        });\n        if (res.status === 'success') {\n          alert('خبر با موفقیت ثبت شد!');\n        } else {\n          alert('خطا در ثبت خبر: ' + res.message);\n        }\n      } catch (err) {\n        alert('خطا در ارسال: ' + err.message);\n      }\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(UploaderManyMedia, {\n        url: 'news_media/',\n        toAction: 'addNews',\n        onDone: handleUploadResult\n      }, {\n        label: _withCtx(() => _cache[4] || (_cache[4] = [_createElementVNode(\"svg\", {\n          fill: \"currentColor\",\n          viewBox: \"0 0 97.6 77.3\",\n          width: \"96\"\n        }, [_createElementVNode(\"title\", null, \"Icon to represent media such as images or videos\"), _createElementVNode(\"path\", {\n          d: \"M16.3 24h.3c2.8-.2 4.9-2.6 4.8-5.4-.2-2.8-2.6-4.9-5.4-4.8s-4.9 2.6-4.8 5.4c.1 2.7 2.4 4.8 5.1 4.8zm-2.4-7.2c.5-.6 1.3-1 2.1-1h.2c1.7 0 3.1 1.4 3.1 3.1 0 1.7-1.4 3.1-3.1 3.1-1.7 0-3.1-1.4-3.1-3.1 0-.8.3-1.5.8-2.1z\",\n          fill: \"currentColor\"\n        }), _createElementVNode(\"path\", {\n          d: \"M84.7 18.4 58 16.9l-.2-3c-.3-5.7-5.2-10.1-11-9.8L12.9 6c-5.7.3-10.1 5.3-9.8 11L5 51v.8c.7 5.2 5.1 9.1 10.3 9.1h.6l21.7-1.2v.6c-.3 5.7 4 10.7 9.8 11l34 2h.6c5.5 0 10.1-4.3 10.4-9.8l2-34c.4-5.8-4-10.7-9.7-11.1zM7.2 10.8C8.7 9.1 10.8 8.1 13 8l34-1.9c4.6-.3 8.6 3.3 8.9 7.9l.2 2.8-5.3-.3c-5.7-.3-10.7 4-11 9.8l-.6 9.5-9.5 10.7c-.2.3-.6.4-1 .5-.4 0-.7-.1-1-.4l-7.8-7c-1.4-1.3-3.5-1.1-4.8.3L7 49 5.2 17c-.2-2.3.6-4.5 2-6.2zm8.7 48c-4.3.2-8.1-2.8-8.8-7.1l9.4-10.5c.2-.3.6-.4 1-.5.4 0 .7.1 1 .4l7.8 7c.7.6 1.6.9 2.5.9.9 0 1.7-.5 2.3-1.1l7.8-8.8-1.1 18.6-21.9 1.1zm76.5-29.5-2 34c-.3 4.6-4.3 8.2-8.9 7.9l-34-2c-4.6-.3-8.2-4.3-7.9-8.9l2-34c.3-4.4 3.9-7.9 8.4-7.9h.5l34 2c4.7.3 8.2 4.3 7.9 8.9z\",\n          fill: \"currentColor\"\n        }), _createElementVNode(\"path\", {\n          d: \"M78.2 41.6 61.3 30.5c-2.1-1.4-4.9-.8-6.2 1.3-.4.7-.7 1.4-.7 2.2l-1.2 20.1c-.1 2.5 1.7 4.6 4.2 4.8h.3c.7 0 1.4-.2 2-.5l18-9c2.2-1.1 3.1-3.8 2-6-.4-.7-.9-1.3-1.5-1.8zm-1.4 6-18 9c-.4.2-.8.3-1.3.3-.4 0-.9-.2-1.2-.4-.7-.5-1.2-1.3-1.1-2.2l1.2-20.1c.1-.9.6-1.7 1.4-2.1.8-.4 1.7-.3 2.5.1L77 43.3c1.2.8 1.5 2.3.7 3.4-.2.4-.5.7-.9.9z\",\n          fill: \"currentColor\"\n        })], -1)])),\n        _: 1\n      }), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"]),\n        class: \"space-y-4 max-w-md mx-auto\"\n      }, [_createElementVNode(\"div\", null, [_cache[5] || (_cache[5] = _createElementVNode(\"label\", null, \"توضیحات:\", -1)), _withDirectives(_createElementVNode(\"textarea\", {\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => form.value.description = $event),\n        rows: \"4\",\n        required: \"\"\n      }, null, 512), [[_vModelText, form.value.description]])]), !rule.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[6] || (_cache[6] = _createElementVNode(\"label\", null, \"دسته‌بندی:\", -1)), _createVNode(_unref(Multiselect), {\n        modelValue: form.value.category_id,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.value.category_id = $event),\n        options: categories.value,\n        multiple: true,\n        \"track-by\": \"id\",\n        label: \"title\",\n        placeholder: \"دسته‌بندی را انتخاب کنید\",\n        selectLabel: \"برای انتخاب این مورد، اینتر بزنید\",\n        selectedLabel: \"انتخاب شده\",\n        deselectLabel: \"برای حذف این مورد، کلیک کنید\",\n        noOptions: \"موردی برای انتخاب وجود ندارد\",\n        noResult: \"نتیجه‌ای با این جستجو پیدا نشد\"\n      }, null, 8, [\"modelValue\", \"options\"])])) : _createCommentVNode(\"\", true), _createVNode(AddressSelector, {\n        loginCity: address.value,\n        \"model-value\": form.value.user_address,\n        onUpdate: _cache[2] || (_cache[2] = val => form.value.user_address = val),\n        onLoading: _cache[3] || (_cache[3] = $event => isAddressLoading.value = $event)\n      }, null, 8, [\"loginCity\", \"model-value\"]), _createElementVNode(\"button\", {\n        type: \"submit\",\n        disabled: isSubmitDisabled.value\n      }, \"ثبت خبر\", 8, _hoisted_2)], 32)], 64);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","sendApi","UploaderManyMedia","Multiselect","AddressSelector","categories","address","rule","isAddressLoading","form","category_id","user_address","type","value","media_id","description","handleUploadResult","uploadedData","map","item","id","data","control","action","status","category","isSubmitDisabled","isDescriptionEmpty","trim","isCategoryInvalid","length","isLocationSelected","isAddressInvalid","isStillLoading","submitForm","finalData","c","res","alert","message","err"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/AddNewsForm.vue"],"sourcesContent":["<template>\r\n  <UploaderManyMedia\r\n  :url=\"'news_media/'\"\r\n  :toAction=\"'addNews'\"\r\n  @done=\"handleUploadResult\">\r\n    <template #label>\r\n      <svg fill=\"currentColor\" viewBox=\"0 0 97.6 77.3\" width=\"96\"><title>Icon to represent media such as images or videos</title><path d=\"M16.3 24h.3c2.8-.2 4.9-2.6 4.8-5.4-.2-2.8-2.6-4.9-5.4-4.8s-4.9 2.6-4.8 5.4c.1 2.7 2.4 4.8 5.1 4.8zm-2.4-7.2c.5-.6 1.3-1 2.1-1h.2c1.7 0 3.1 1.4 3.1 3.1 0 1.7-1.4 3.1-3.1 3.1-1.7 0-3.1-1.4-3.1-3.1 0-.8.3-1.5.8-2.1z\" fill=\"currentColor\"></path><path d=\"M84.7 18.4 58 16.9l-.2-3c-.3-5.7-5.2-10.1-11-9.8L12.9 6c-5.7.3-10.1 5.3-9.8 11L5 51v.8c.7 5.2 5.1 9.1 10.3 9.1h.6l21.7-1.2v.6c-.3 5.7 4 10.7 9.8 11l34 2h.6c5.5 0 10.1-4.3 10.4-9.8l2-34c.4-5.8-4-10.7-9.7-11.1zM7.2 10.8C8.7 9.1 10.8 8.1 13 8l34-1.9c4.6-.3 8.6 3.3 8.9 7.9l.2 2.8-5.3-.3c-5.7-.3-10.7 4-11 9.8l-.6 9.5-9.5 10.7c-.2.3-.6.4-1 .5-.4 0-.7-.1-1-.4l-7.8-7c-1.4-1.3-3.5-1.1-4.8.3L7 49 5.2 17c-.2-2.3.6-4.5 2-6.2zm8.7 48c-4.3.2-8.1-2.8-8.8-7.1l9.4-10.5c.2-.3.6-.4 1-.5.4 0 .7.1 1 .4l7.8 7c.7.6 1.6.9 2.5.9.9 0 1.7-.5 2.3-1.1l7.8-8.8-1.1 18.6-21.9 1.1zm76.5-29.5-2 34c-.3 4.6-4.3 8.2-8.9 7.9l-34-2c-4.6-.3-8.2-4.3-7.9-8.9l2-34c.3-4.4 3.9-7.9 8.4-7.9h.5l34 2c4.7.3 8.2 4.3 7.9 8.9z\" fill=\"currentColor\"></path><path d=\"M78.2 41.6 61.3 30.5c-2.1-1.4-4.9-.8-6.2 1.3-.4.7-.7 1.4-.7 2.2l-1.2 20.1c-.1 2.5 1.7 4.6 4.2 4.8h.3c.7 0 1.4-.2 2-.5l18-9c2.2-1.1 3.1-3.8 2-6-.4-.7-.9-1.3-1.5-1.8zm-1.4 6-18 9c-.4.2-.8.3-1.3.3-.4 0-.9-.2-1.2-.4-.7-.5-1.2-1.3-1.1-2.2l1.2-20.1c.1-.9.6-1.7 1.4-2.1.8-.4 1.7-.3 2.5.1L77 43.3c1.2.8 1.5 2.3.7 3.4-.2.4-.5.7-.9.9z\" fill=\"currentColor\"></path></svg>\r\n    </template>\r\n  </UploaderManyMedia>\r\n  <form @submit.prevent=\"submitForm\" class=\"space-y-4 max-w-md mx-auto\">\r\n    <div>\r\n      <label>توضیحات:</label>\r\n      <textarea v-model=\"form.description\" rows=\"4\" required></textarea>\r\n    </div>\r\n    <div v-if=\"!rule\">\r\n      <label>دسته‌بندی:</label>\r\n      <multiselect\r\n        v-model=\"form.category_id\"\r\n        :options=\"categories\"\r\n        :multiple=\"true\"\r\n        track-by=\"id\"\r\n        label=\"title\"\r\n        placeholder=\"دسته‌بندی را انتخاب کنید\"\r\n        selectLabel=\"برای انتخاب این مورد، اینتر بزنید\"\r\n        selectedLabel=\"انتخاب شده\"\r\n        deselectLabel=\"برای حذف این مورد، کلیک کنید\"\r\n        noOptions=\"موردی برای انتخاب وجود ندارد\"\r\n        noResult=\"نتیجه‌ای با این جستجو پیدا نشد\"\r\n      />\r\n    </div>\r\n    <AddressSelector\r\n      :loginCity=\"address\"\r\n      :model-value=\"form.user_address\"\r\n      @update=\"val => form.user_address = val\"\r\n      @loading=\"isAddressLoading = $event\"\r\n    />\r\n    <button type=\"submit\" :disabled=\"isSubmitDisabled\">ثبت خبر</button>\r\n  </form>\r\n</template>\r\n\r\n<script setup>\r\n    import { ref, onMounted, computed } from 'vue'\r\n    import { sendApi } from '@/utils/api'\r\n    import UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue'\r\n    import Multiselect from 'vue-multiselect'\r\n    import 'vue-multiselect/dist/vue-multiselect.min.css'\r\n    import AddressSelector from '@/components/tooles/news/AddressSelector .vue'\r\n    const categories = ref([])\r\n    const address = ref('')\r\n    const rule = ref(false)\r\n    const isAddressLoading = ref(false)\r\n    const form = ref({\r\n        category_id: [],\r\n        user_address: { type: 'city', value: '' },\r\n        media_id: [],\r\n        description: '',\r\n    })\r\n    const handleUploadResult = (uploadedData) => {\r\n      form.value.media_id = uploadedData.map(item => item.id)\r\n    }\r\n    onMounted(async () => {\r\n        const data = await sendApi({ control: 'news', action: 'add_data' })\r\n        if (data.status === 'success') {\r\n            rule.value = data.rule\r\n            address.value = data.address\r\n            if (rule.value) {\r\n              categories.value = data.category ? [data.category] : []\r\n              form.value.category_id = data.category ? [data.category] : []\r\n            } else {\r\n              categories.value = data.category ?? []\r\n            }\r\n        }\r\n    })\r\n    const isSubmitDisabled = computed(() => {\r\n      const isDescriptionEmpty = !form.value.description.trim()\r\n      const isCategoryInvalid = !rule.value && (!form.value.category_id || form.value.category_id.length === 0)\r\n      const isLocationSelected = form.value.user_address?.type === 'location'\r\n      const isAddressInvalid = isLocationSelected && (!form.value.user_address?.value || !form.value.user_address.value.address?.trim())\r\n      const isStillLoading = isLocationSelected && isAddressLoading.value\r\n      return isDescriptionEmpty || isCategoryInvalid || isAddressInvalid || isStillLoading\r\n    })\r\n    const submitForm = async () => {\r\n        const finalData = {\r\n            ...form.value,\r\n            category_id: form.value.category_id.map(c => c.id),\r\n        }\r\n        try {\r\n            const res = await sendApi({\r\n                control: 'news',\r\n                action: 'add_news',\r\n                data: finalData,\r\n            })\r\n            if (res.status === 'success') {\r\n                alert('خبر با موفقیت ثبت شد!')\r\n            } else {\r\n                alert('خطا در ثبت خبر: ' + res.message)\r\n            }\r\n        } catch (err) {\r\n            alert('خطا در ارسال: ' + err.message)\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n  form input,\r\n  form select,\r\n  form textarea {\r\n      width: 100%;\r\n      padding: 0.5rem;\r\n      margin-top: 0.25rem;\r\n  }\r\n  button {\r\n    padding: 0.5rem 1rem;\r\n    background-color: #10b981;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 0.375rem;\r\n    cursor: pointer;\r\n    margin-top: 0.5rem;\r\n    transition: background-color 0.2s ease, opacity 0.2s ease;\r\n  }\r\n\r\n  button:disabled {\r\n    background-color: #9ca3af;\r\n    cursor: not-allowed;\r\n    opacity: 0.6;\r\n  }\r\n\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}