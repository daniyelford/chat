{"ast":null,"code":"import { createElementVNode as _createElementVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, vModelText as _vModelText, withDirectives as _withDirectives, vModelSelect as _vModelSelect, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-4\"\n};\nconst _hoisted_2 = {\n  class: \"w-full border\"\n};\nconst _hoisted_3 = {\n  class: \"p-2\"\n};\nconst _hoisted_4 = [\"src\"];\nconst _hoisted_5 = {\n  key: 1\n};\nconst _hoisted_6 = {\n  class: \"p-2\"\n};\nconst _hoisted_7 = {\n  class: \"p-2\"\n};\nconst _hoisted_8 = {\n  class: \"p-2\"\n};\nconst _hoisted_9 = {\n  class: \"p-2\"\n};\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  class: \"font-bold\"\n};\nconst _hoisted_12 = {\n  key: 1\n};\nconst _hoisted_13 = {\n  class: \"p-2\"\n};\nconst _hoisted_14 = [\"onClick\"];\nconst _hoisted_15 = [\"onClick\"];\nconst _hoisted_16 = [\"onClick\"];\nconst _hoisted_17 = {\n  key: 0,\n  class: \"mt-4\"\n};\nconst _hoisted_18 = {\n  key: 1,\n  class: \"mt-4\"\n};\nconst _hoisted_19 = {\n  key: 2,\n  class: \"mt-6 border p-4 rounded bg-gray-50\"\n};\nconst _hoisted_20 = {\n  class: \"font-bold mb-2\"\n};\nconst _hoisted_21 = [\"value\"];\nconst _hoisted_22 = [\"value\"];\nimport { ref, onMounted } from 'vue';\nimport { useUserStore } from '@/stores/user';\nexport default {\n  __name: 'UsersSettingList',\n  setup(__props) {\n    const store = useUserStore();\n    const {\n      users,\n      hasMore,\n      loading,\n      fetchUsers,\n      submitUser,\n      disableUser,\n      enableUser,\n      allCategories,\n      allRules\n    } = store;\n    const showForm = ref(false);\n    const editUser = ref(null);\n    const form = ref({\n      name: '',\n      family: '',\n      mobile: '',\n      rule_id: '',\n      category_id: ''\n    });\n    const limit = ref(10);\n    const offset = ref(0);\n\n    // بارگذاری کاربران\n    async function loadUsers() {\n      await fetchUsers({\n        limite: limit.value,\n        offset: offset.value\n      });\n    }\n\n    // بارگذاری بیشتر\n    async function loadMore() {\n      offset.value += limit.value;\n      await loadUsers();\n    }\n\n    // فعال/غیرفعال کردن کاربر\n    async function onDisableUser(id) {\n      await disableUser(id);\n      await loadUsers();\n    }\n    async function onEnableUser(id) {\n      await enableUser(id);\n      await loadUsers();\n    }\n\n    // باز کردن فرم\n    function openForm(user = null) {\n      editUser.value = user;\n      if (user) {\n        form.value = {\n          name: user.name,\n          family: user.family,\n          mobile: user.mobile,\n          rule_id: user.rules?.[0]?.rule_id || '',\n          category_id: user.rules?.[0]?.category_id || ''\n        };\n      } else {\n        form.value = {\n          name: '',\n          family: '',\n          mobile: '',\n          rule_id: '',\n          category_id: ''\n        };\n      }\n      showForm.value = true;\n    }\n\n    // بستن فرم\n    function cancelForm() {\n      showForm.value = false;\n    }\n\n    // ارسال فرم\n    async function submitForm() {\n      await submitUser(form.value, editUser.value ? editUser.value.id : null);\n      offset.value = 0;\n      await loadUsers();\n      showForm.value = false;\n    }\n    onMounted(() => {\n      loadUsers();\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[11] || (_cache[11] = _createElementVNode(\"h2\", {\n        class: \"text-lg font-bold mb-4\"\n      }, \"مدیریت کاربران\", -1)), _createElementVNode(\"button\", {\n        class: \"bg-green-500 text-white px-4 py-2 rounded mb-4\",\n        onClick: _cache[0] || (_cache[0] = $event => openForm())\n      }, \" افزودن کاربر \"), _createElementVNode(\"table\", _hoisted_2, [_createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(users), u => {\n        return _openBlock(), _createElementBlock(\"tr\", {\n          key: u.id,\n          class: \"border-t\"\n        }, [_createElementVNode(\"td\", _hoisted_3, [u.image ? (_openBlock(), _createElementBlock(\"img\", {\n          key: 0,\n          src: u.image,\n          alt: \"avatar\",\n          class: \"w-10 h-10 rounded-full\"\n        }, null, 8, _hoisted_4)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_5, \"—\"))]), _createElementVNode(\"td\", _hoisted_6, _toDisplayString(u.name), 1), _createElementVNode(\"td\", _hoisted_7, _toDisplayString(u.family), 1), _createElementVNode(\"td\", _hoisted_8, _toDisplayString(u.mobile), 1), _createElementVNode(\"td\", _hoisted_9, [u.rules?.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(u.rules, (rule, index) => {\n          return _openBlock(), _createElementBlock(\"div\", {\n            key: index\n          }, [_createElementVNode(\"span\", _hoisted_11, _toDisplayString(rule.category_name), 1), _createTextVNode(\" - \" + _toDisplayString(rule.name), 1)]);\n        }), 128))])) : (_openBlock(), _createElementBlock(\"span\", _hoisted_12, \"بدون نقش\"))]), _createElementVNode(\"td\", _hoisted_13, [_createElementVNode(\"button\", {\n          class: \"bg-blue-500 text-white px-2 py-1 rounded mr-1\",\n          onClick: $event => openForm(u)\n        }, \"ویرایش\", 8, _hoisted_14), u.user_status === 'active' ? (_openBlock(), _createElementBlock(\"button\", {\n          key: 0,\n          class: \"bg-red-500 text-white px-2 py-1 rounded\",\n          onClick: $event => onDisableUser(u.id)\n        }, \" غیر فعال \", 8, _hoisted_15)) : (_openBlock(), _createElementBlock(\"button\", {\n          key: 1,\n          class: \"bg-green-500 text-white px-2 py-1 rounded\",\n          onClick: $event => onEnableUser(u.id)\n        }, \" فعال \", 8, _hoisted_16))])]);\n      }), 128))])]), _unref(hasMore) && !_unref(loading) ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [_createElementVNode(\"button\", {\n        class: \"bg-gray-500 text-white px-4 py-2 rounded\",\n        onClick: loadMore\n      }, \" بارگذاری بیشتر \")])) : _createCommentVNode(\"\", true), _unref(loading) ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, \"در حال بارگذاری...\")) : _createCommentVNode(\"\", true), showForm.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [_createElementVNode(\"h3\", _hoisted_20, _toDisplayString(editUser.value ? 'ویرایش کاربر' : 'افزودن کاربر'), 1), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"])\n      }, [_withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.value.name = $event),\n        placeholder: \"نام\",\n        class: \"border p-2 w-full mb-2\"\n      }, null, 512), [[_vModelText, form.value.name]]), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => form.value.family = $event),\n        placeholder: \"نام خانوادگی\",\n        class: \"border p-2 w-full mb-2\"\n      }, null, 512), [[_vModelText, form.value.family]]), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => form.value.mobile = $event),\n        placeholder: \"موبایل\",\n        class: \"border p-2 w-full mb-2\"\n      }, null, 512), [[_vModelText, form.value.mobile]]), _cache[8] || (_cache[8] = _createElementVNode(\"label\", {\n        class: \"block font-bold mt-2\"\n      }, \"نقش‌ها\", -1)), _withDirectives(_createElementVNode(\"select\", {\n        \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => form.value.rule_id = $event),\n        class: \"border p-2 w-full mb-2\"\n      }, [_cache[6] || (_cache[6] = _createElementVNode(\"option\", {\n        value: \"\"\n      }, \"انتخاب کنید\", -1)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allRules), r => {\n        return _openBlock(), _createElementBlock(\"option\", {\n          key: r.id,\n          value: r.id\n        }, _toDisplayString(r.name), 9, _hoisted_21);\n      }), 128))], 512), [[_vModelSelect, form.value.rule_id]]), _cache[9] || (_cache[9] = _createElementVNode(\"label\", {\n        class: \"block font-bold mt-2\"\n      }, \"دسته‌بندی\", -1)), _withDirectives(_createElementVNode(\"select\", {\n        \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => form.value.category_id = $event),\n        class: \"border p-2 w-full mb-4\"\n      }, [_cache[7] || (_cache[7] = _createElementVNode(\"option\", {\n        value: \"\"\n      }, \"انتخاب کنید\", -1)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allCategories), c => {\n        return _openBlock(), _createElementBlock(\"option\", {\n          key: c.id,\n          value: c.id\n        }, _toDisplayString(c.title), 9, _hoisted_22);\n      }), 128))], 512), [[_vModelSelect, form.value.category_id]]), _cache[10] || (_cache[10] = _createElementVNode(\"button\", {\n        class: \"bg-green-600 text-white px-4 py-2 rounded\",\n        type: \"submit\"\n      }, \" ذخیره \", -1)), _createElementVNode(\"button\", {\n        class: \"ml-2 px-4 py-2 rounded border\",\n        onClick: cancelForm,\n        type: \"button\"\n      }, \" انصراف \")], 32)])) : _createCommentVNode(\"\", true)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useUserStore","store","users","hasMore","loading","fetchUsers","submitUser","disableUser","enableUser","allCategories","allRules","showForm","editUser","form","name","family","mobile","rule_id","category_id","limit","offset","loadUsers","limite","value","loadMore","onDisableUser","id","onEnableUser","openForm","user","rules","cancelForm","submitForm"],"sources":["D:/GitHub/chat/vue3/src/components/tooles/users/UsersSettingList.vue"],"sourcesContent":["<template>\r\n  <div class=\"p-4\">\r\n    <h2 class=\"text-lg font-bold mb-4\">مدیریت کاربران</h2>\r\n\r\n    <!-- دکمه افزودن -->\r\n    <button\r\n      class=\"bg-green-500 text-white px-4 py-2 rounded mb-4\"\r\n      @click=\"openForm()\"\r\n    >\r\n      افزودن کاربر\r\n    </button>\r\n\r\n    <!-- جدول کاربران -->\r\n    <table class=\"w-full border\">\r\n      <tbody>\r\n        <tr v-for=\"u in users\" :key=\"u.id\" class=\"border-t\">\r\n          <td class=\"p-2\">\r\n            <img v-if=\"u.image\" :src=\"u.image\" alt=\"avatar\" class=\"w-10 h-10 rounded-full\" />\r\n            <span v-else>—</span>\r\n          </td>\r\n          <td class=\"p-2\">{{ u.name }}</td>\r\n          <td class=\"p-2\">{{ u.family }}</td>\r\n          <td class=\"p-2\">{{ u.mobile }}</td>\r\n          <td class=\"p-2\">\r\n            <div v-if=\"u.rules?.length\">\r\n              <div v-for=\"(rule,index) in u.rules\" :key=\"index\">\r\n                <span class=\"font-bold\">{{ rule.category_name }}</span> - {{ rule.name }}\r\n              </div>\r\n            </div>\r\n            <span v-else>بدون نقش</span>\r\n          </td>\r\n          <td class=\"p-2\">\r\n            <button class=\"bg-blue-500 text-white px-2 py-1 rounded mr-1\" @click=\"openForm(u)\">ویرایش</button>\r\n            <button\r\n              v-if=\"u.user_status === 'active'\"\r\n              class=\"bg-red-500 text-white px-2 py-1 rounded\"\r\n              @click=\"onDisableUser(u.id)\"\r\n            >\r\n              غیر فعال\r\n            </button>\r\n            <button\r\n              v-else\r\n              class=\"bg-green-500 text-white px-2 py-1 rounded\"\r\n              @click=\"onEnableUser(u.id)\"\r\n            >\r\n              فعال\r\n            </button>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    <!-- بارگذاری بیشتر -->\r\n    <div v-if=\"hasMore && !loading\" class=\"mt-4\">\r\n      <button class=\"bg-gray-500 text-white px-4 py-2 rounded\" @click=\"loadMore\">\r\n        بارگذاری بیشتر\r\n      </button>\r\n    </div>\r\n\r\n    <!-- لودینگ -->\r\n    <div v-if=\"loading\" class=\"mt-4\">در حال بارگذاری...</div>\r\n\r\n    <!-- فرم افزودن/ویرایش -->\r\n    <div v-if=\"showForm\" class=\"mt-6 border p-4 rounded bg-gray-50\">\r\n      <h3 class=\"font-bold mb-2\">{{ editUser ? 'ویرایش کاربر' : 'افزودن کاربر' }}</h3>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <input v-model=\"form.name\" placeholder=\"نام\" class=\"border p-2 w-full mb-2\" />\r\n        <input v-model=\"form.family\" placeholder=\"نام خانوادگی\" class=\"border p-2 w-full mb-2\" />\r\n        <input v-model=\"form.mobile\" placeholder=\"موبایل\" class=\"border p-2 w-full mb-2\" />\r\n\r\n        <!-- انتخاب نقش -->\r\n        <label class=\"block font-bold mt-2\">نقش‌ها</label>\r\n        <select v-model=\"form.rule_id\" class=\"border p-2 w-full mb-2\">\r\n          <option value=\"\">انتخاب کنید</option>\r\n          <option v-for=\"r in allRules\" :key=\"r.id\" :value=\"r.id\">\r\n            {{ r.name }}\r\n          </option>\r\n        </select>\r\n\r\n        <!-- انتخاب دسته‌بندی -->\r\n        <label class=\"block font-bold mt-2\">دسته‌بندی</label>\r\n        <select v-model=\"form.category_id\" class=\"border p-2 w-full mb-4\">\r\n          <option value=\"\">انتخاب کنید</option>\r\n          <option v-for=\"c in allCategories\" :key=\"c.id\" :value=\"c.id\">\r\n            {{ c.title }}\r\n          </option>\r\n        </select>\r\n\r\n        <button class=\"bg-green-600 text-white px-4 py-2 rounded\" type=\"submit\">\r\n          ذخیره\r\n        </button>\r\n        <button class=\"ml-2 px-4 py-2 rounded border\" @click=\"cancelForm\" type=\"button\">\r\n          انصراف\r\n        </button>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useUserStore } from '@/stores/user'\r\n\r\nconst store = useUserStore()\r\n\r\nconst {\r\n  users,\r\n  hasMore,\r\n  loading,\r\n  fetchUsers,\r\n  submitUser,\r\n  disableUser,\r\n  enableUser,\r\n  allCategories,\r\n  allRules\r\n} = store\r\n\r\nconst showForm = ref(false)\r\nconst editUser = ref(null)\r\nconst form = ref({\r\n  name: '',\r\n  family: '',\r\n  mobile: '',\r\n  rule_id: '',\r\n  category_id: ''\r\n})\r\n\r\nconst limit = ref(10)\r\nconst offset = ref(0)\r\n\r\n// بارگذاری کاربران\r\nasync function loadUsers() {\r\n  await fetchUsers({ limite: limit.value, offset: offset.value })\r\n}\r\n\r\n// بارگذاری بیشتر\r\nasync function loadMore() {\r\n  offset.value += limit.value\r\n  await loadUsers()\r\n}\r\n\r\n// فعال/غیرفعال کردن کاربر\r\nasync function onDisableUser(id) {\r\n  await disableUser(id)\r\n  await loadUsers()\r\n}\r\nasync function onEnableUser(id) {\r\n  await enableUser(id)\r\n  await loadUsers()\r\n}\r\n\r\n// باز کردن فرم\r\nfunction openForm(user = null) {\r\n  editUser.value = user\r\n  if (user) {\r\n    form.value = {\r\n      name: user.name,\r\n      family: user.family,\r\n      mobile: user.mobile,\r\n      rule_id: user.rules?.[0]?.rule_id || '',\r\n      category_id: user.rules?.[0]?.category_id || ''\r\n    }\r\n  } else {\r\n    form.value = {\r\n      name: '',\r\n      family: '',\r\n      mobile: '',\r\n      rule_id: '',\r\n      category_id: ''\r\n    }\r\n  }\r\n  showForm.value = true\r\n}\r\n\r\n// بستن فرم\r\nfunction cancelForm() {\r\n  showForm.value = false\r\n}\r\n\r\n// ارسال فرم\r\nasync function submitForm() {\r\n  await submitUser(form.value, editUser.value ? editUser.value.id : null)\r\n  offset.value = 0\r\n  await loadUsers()\r\n  showForm.value = false\r\n}\r\n\r\nonMounted(() => {\r\n  loadUsers()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n\r\n  table {\r\n    max-height: 300px;\r\n    overflow: auto;\r\n  }\r\n  table td {\r\n    text-align: center;\r\n  }\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,YAAY,QAAQ,eAAe;;;;IAE5C,MAAMC,KAAK,GAAGD,YAAY,CAAC,CAAC;IAE5B,MAAM;MACJE,KAAK;MACLC,OAAO;MACPC,OAAO;MACPC,UAAU;MACVC,UAAU;MACVC,WAAW;MACXC,UAAU;MACVC,aAAa;MACbC;IACF,CAAC,GAAGT,KAAK;IAET,MAAMU,QAAQ,GAAGb,GAAG,CAAC,KAAK,CAAC;IAC3B,MAAMc,QAAQ,GAAGd,GAAG,CAAC,IAAI,CAAC;IAC1B,MAAMe,IAAI,GAAGf,GAAG,CAAC;MACfgB,IAAI,EAAE,EAAE;MACRC,MAAM,EAAE,EAAE;MACVC,MAAM,EAAE,EAAE;MACVC,OAAO,EAAE,EAAE;MACXC,WAAW,EAAE;IACf,CAAC,CAAC;IAEF,MAAMC,KAAK,GAAGrB,GAAG,CAAC,EAAE,CAAC;IACrB,MAAMsB,MAAM,GAAGtB,GAAG,CAAC,CAAC,CAAC;;IAErB;IACA,eAAeuB,SAASA,CAAA,EAAG;MACzB,MAAMhB,UAAU,CAAC;QAAEiB,MAAM,EAAEH,KAAK,CAACI,KAAK;QAAEH,MAAM,EAAEA,MAAM,CAACG;MAAM,CAAC,CAAC;IACjE;;IAEA;IACA,eAAeC,QAAQA,CAAA,EAAG;MACxBJ,MAAM,CAACG,KAAK,IAAIJ,KAAK,CAACI,KAAK;MAC3B,MAAMF,SAAS,CAAC,CAAC;IACnB;;IAEA;IACA,eAAeI,aAAaA,CAACC,EAAE,EAAE;MAC/B,MAAMnB,WAAW,CAACmB,EAAE,CAAC;MACrB,MAAML,SAAS,CAAC,CAAC;IACnB;IACA,eAAeM,YAAYA,CAACD,EAAE,EAAE;MAC9B,MAAMlB,UAAU,CAACkB,EAAE,CAAC;MACpB,MAAML,SAAS,CAAC,CAAC;IACnB;;IAEA;IACA,SAASO,QAAQA,CAACC,IAAI,GAAG,IAAI,EAAE;MAC7BjB,QAAQ,CAACW,KAAK,GAAGM,IAAI;MACrB,IAAIA,IAAI,EAAE;QACRhB,IAAI,CAACU,KAAK,GAAG;UACXT,IAAI,EAAEe,IAAI,CAACf,IAAI;UACfC,MAAM,EAAEc,IAAI,CAACd,MAAM;UACnBC,MAAM,EAAEa,IAAI,CAACb,MAAM;UACnBC,OAAO,EAAEY,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC,EAAEb,OAAO,IAAI,EAAE;UACvCC,WAAW,EAAEW,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC,EAAEZ,WAAW,IAAI;QAC/C,CAAC;MACH,CAAC,MAAM;QACLL,IAAI,CAACU,KAAK,GAAG;UACXT,IAAI,EAAE,EAAE;UACRC,MAAM,EAAE,EAAE;UACVC,MAAM,EAAE,EAAE;UACVC,OAAO,EAAE,EAAE;UACXC,WAAW,EAAE;QACf,CAAC;MACH;MACAP,QAAQ,CAACY,KAAK,GAAG,IAAI;IACvB;;IAEA;IACA,SAASQ,UAAUA,CAAA,EAAG;MACpBpB,QAAQ,CAACY,KAAK,GAAG,KAAK;IACxB;;IAEA;IACA,eAAeS,UAAUA,CAAA,EAAG;MAC1B,MAAM1B,UAAU,CAACO,IAAI,CAACU,KAAK,EAAEX,QAAQ,CAACW,KAAK,GAAGX,QAAQ,CAACW,KAAK,CAACG,EAAE,GAAG,IAAI,CAAC;MACvEN,MAAM,CAACG,KAAK,GAAG,CAAC;MAChB,MAAMF,SAAS,CAAC,CAAC;MACjBV,QAAQ,CAACY,KAAK,GAAG,KAAK;IACxB;IAEAxB,SAAS,CAAC,MAAM;MACdsB,SAAS,CAAC,CAAC;IACb,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}