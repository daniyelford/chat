{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createStaticVNode as _createStaticVNode } from \"vue\";\nimport { ref, onMounted } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport default {\n  __name: 'FingerPrintRegister',\n  setup(__props) {\n    const isSupported = ref(false);\n    onMounted(() => {\n      isSupported.value = window.PublicKeyCredential && typeof window.PublicKeyCredential === 'function';\n    });\n    async function registerWithWebAuthn() {\n      try {\n        const res = await sendApi({\n          action: 'register_webauthn_request',\n          control: 'login'\n        });\n        if (!res || !res.publicKey) throw new Error('مشکلی در دریافت challenge ثبت رخ داد.');\n        const options = preformatMakeCredReq(res.publicKey);\n        const credential = await navigator.credentials.create({\n          publicKey: options\n        });\n        const result = await sendApi({\n          action: 'register_webauthn_response',\n          data: credential,\n          control: 'login'\n        });\n        if (result && result.status === 'success') {\n          alert('ثبت اثر انگشت موفقیت‌آمیز بود.');\n        } else {\n          alert('ثبت اثر انگشت ناموفق بود.');\n        }\n      } catch (err) {\n        console.error(err);\n        alert('خطا در ثبت اثر انگشت.');\n      }\n    }\n    function decodeMimeBase64(mimeString) {\n      const match = mimeString.match(/=\\?BINARY\\?B\\?(.*)\\?=/i);\n      if (match && match[1]) {\n        return Uint8Array.from(atob(match[1]), c => c.charCodeAt(0)).buffer;\n      }\n      return Uint8Array.from(atob(mimeString), c => c.charCodeAt(0)).buffer;\n    }\n    function preformatMakeCredReq(options) {\n      const opts = {\n        ...options\n      };\n      opts.challenge = decodeMimeBase64(opts.challenge);\n      if (opts.user && opts.user.id) {\n        opts.user.id = decodeMimeBase64(opts.user.id);\n      }\n      if (opts.excludeCredentials && Array.isArray(opts.excludeCredentials)) {\n        opts.excludeCredentials = opts.excludeCredentials.map(cred => ({\n          ...cred,\n          id: decodeMimeBase64(cred.id)\n        }));\n      }\n      return opts;\n    }\n    return (_ctx, _cache) => {\n      return isSupported.value ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 0,\n        onClick: registerWithWebAuthn\n      }, _cache[0] || (_cache[0] = [_createStaticVNode(\"<svg version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" viewBox=\\\"0,0,256,256\\\" data-v-5ffe22fe><g fill=\\\"none\\\" fill-rule=\\\"nonzero\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" stroke-linecap=\\\"butt\\\" stroke-linejoin=\\\"miter\\\" stroke-miterlimit=\\\"10\\\" stroke-dasharray=\\\"\\\" stroke-dashoffset=\\\"0\\\" font-family=\\\"none\\\" font-weight=\\\"none\\\" font-size=\\\"none\\\" text-anchor=\\\"none\\\" style=\\\"mix-blend-mode:normal;\\\" data-v-5ffe22fe><g transform=\\\"scale(5.33333,5.33333)\\\" data-v-5ffe22fe><path d=\\\"M5,28h38v14h-38z\\\" fill=\\\"#3c9331\\\" data-v-5ffe22fe></path><path d=\\\"M14,40h-7v-7h2v5h5zM41,40h-7v-2h5v-5h2z\\\" fill=\\\"#45de32\\\" data-v-5ffe22fe></path><path d=\\\"M41,13h-2v-5h-5v-2h7zM9,13h-2v-7h7v2h-5z\\\" fill=\\\"#121212\\\" data-v-5ffe22fe></path><path d=\\\"M32.1,32.3c0.2,0.1 0.3,0.1 0.5,0.1c0.5,0 0.9,-0.3 1.2,-0.8c0.3,-0.6 0,-1.4 -0.7,-1.6c-0.3,-0.1 -0.5,-0.2 -0.7,-0.3h-4.6c1.1,0.9 2.5,1.8 4.3,2.6zM32.7,33.1v0c-0.1,0 -0.2,0 -0.3,0c-2.7,0 -5.1,-1.2 -6.9,-3.5h-3.1c2.3,3.8 5.9,6 10,6c0.1,0 0.2,0 0.3,0c0.7,0 1.2,-0.6 1.2,-1.3c0.1,-0.6 -0.5,-1.2 -1.2,-1.2zM27.4,35.6c-2.9,-1.3 -4.4,-2.4 -6.2,-4.9c-0.2,-0.3 -0.4,-0.7 -0.6,-1h-2.8c0.4,0.9 0.9,1.8 1.4,2.5c2,2.8 3.9,4.3 7.2,5.7c0.2,0.1 0.3,0.1 0.5,0.1c0.5,0 0.9,-0.3 1.2,-0.8c0.3,-0.6 0,-1.3 -0.7,-1.6z\\\" fill=\\\"#60ff28\\\" data-v-5ffe22fe></path><path d=\\\"M13.3,22.9c-0.1,0 -0.1,0 0,0c-0.8,-0.1 -1.3,-0.7 -1.3,-1.4c0,-0.3 0.5,-6.4 5.3,-10c3.5,-2.5 7.2,-2.5 9,-2.5h0.3c0.7,0 1.3,0.6 1.3,1.3c0,0.7 -0.6,1.3 -1.3,1.3h-0.3c-1.6,0 -4.6,0 -7.4,2.1c-3.9,2.9 -4.3,8.1 -4.3,8.1c-0.1,0.6 -0.7,1.1 -1.3,1.1zM26.8,23c0,-0.7 -0.5,-1.3 -1.2,-1.3c-0.7,0 -1.3,0.5 -1.3,1.2c0,0.2 0,2.5 2.1,5.1h3.7c-3.2,-2.3 -3.3,-4.8 -3.3,-5z\\\" fill=\\\"#4e3918\\\" data-v-5ffe22fe></path><path d=\\\"M34.3,26.4c-1.7,-0.9 -2.6,-2.7 -3.5,-4.4c-1.2,-2.4 -2.8,-5.6 -7,-3.8c-1.3,0.6 -2.3,1.6 -2.8,3c-0.9,2.3 -0.3,5 0.6,6.7c0,0.1 0.1,0.1 0.1,0.2h2.9c-0.2,-0.4 -0.5,-0.8 -0.7,-1.3c-0.8,-1.6 -1,-3.5 -0.5,-4.8c0.3,-0.8 0.8,-1.3 1.5,-1.6c1.8,-0.8 2.3,-0.2 3.7,2.7c0.8,1.7 1.8,3.6 3.7,5h2.7c0.2,-0.7 -0.1,-1.4 -0.7,-1.7z\\\" fill=\\\"#4e3918\\\" data-v-5ffe22fe></path><path d=\\\"M19.9,28c-0.8,-2 -1.2,-4.4 -0.8,-6.5c0.4,-1.9 1.5,-3.3 3.2,-4.3c1.9,-1.1 3.6,-1.3 5.2,-0.7c2.9,1.1 4.9,4.8 6.1,7.7c0.3,0.6 1,1 1.6,0.7c0.6,-0.3 1,-1 0.7,-1.6c-1.3,-3.4 -3.7,-7.7 -7.5,-9.1c-2.3,-0.8 -4.7,-0.5 -7.2,0.9c-2.3,1.3 -3.9,3.3 -4.5,5.9c-0.5,2.3 -0.2,4.9 0.5,7.1h2.7z\\\" fill=\\\"#4e3918\\\" data-v-5ffe22fe></path><path d=\\\"M5,28h38v2h-38z\\\" fill=\\\"#d7347d\\\" data-v-5ffe22fe></path></g></g></svg>\", 1)]))) : _createCommentVNode(\"\", true);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","sendApi","isSupported","value","window","PublicKeyCredential","registerWithWebAuthn","res","action","control","publicKey","Error","options","preformatMakeCredReq","credential","navigator","credentials","create","result","data","status","alert","err","console","error","decodeMimeBase64","mimeString","match","Uint8Array","from","atob","c","charCodeAt","buffer","opts","challenge","user","id","excludeCredentials","Array","isArray","map","cred"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/tooles/nav/FingerPrintRegister.vue"],"sourcesContent":["<template>\r\n  <button v-if=\"isSupported\" @click=\"registerWithWebAuthn\">\r\n    <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0,0,256,256\"><g fill=\"none\" fill-rule=\"nonzero\" stroke=\"none\" stroke-width=\"1\" stroke-linecap=\"butt\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" stroke-dasharray=\"\" stroke-dashoffset=\"0\" font-family=\"none\" font-weight=\"none\" font-size=\"none\" text-anchor=\"none\" style=\"mix-blend-mode: normal\"><g transform=\"scale(5.33333,5.33333)\"><path d=\"M5,28h38v14h-38z\" fill=\"#3c9331\"></path><path d=\"M14,40h-7v-7h2v5h5zM41,40h-7v-2h5v-5h2z\" fill=\"#45de32\"></path><path d=\"M41,13h-2v-5h-5v-2h7zM9,13h-2v-7h7v2h-5z\" fill=\"#121212\"></path><path d=\"M32.1,32.3c0.2,0.1 0.3,0.1 0.5,0.1c0.5,0 0.9,-0.3 1.2,-0.8c0.3,-0.6 0,-1.4 -0.7,-1.6c-0.3,-0.1 -0.5,-0.2 -0.7,-0.3h-4.6c1.1,0.9 2.5,1.8 4.3,2.6zM32.7,33.1v0c-0.1,0 -0.2,0 -0.3,0c-2.7,0 -5.1,-1.2 -6.9,-3.5h-3.1c2.3,3.8 5.9,6 10,6c0.1,0 0.2,0 0.3,0c0.7,0 1.2,-0.6 1.2,-1.3c0.1,-0.6 -0.5,-1.2 -1.2,-1.2zM27.4,35.6c-2.9,-1.3 -4.4,-2.4 -6.2,-4.9c-0.2,-0.3 -0.4,-0.7 -0.6,-1h-2.8c0.4,0.9 0.9,1.8 1.4,2.5c2,2.8 3.9,4.3 7.2,5.7c0.2,0.1 0.3,0.1 0.5,0.1c0.5,0 0.9,-0.3 1.2,-0.8c0.3,-0.6 0,-1.3 -0.7,-1.6z\" fill=\"#60ff28\"></path><path d=\"M13.3,22.9c-0.1,0 -0.1,0 0,0c-0.8,-0.1 -1.3,-0.7 -1.3,-1.4c0,-0.3 0.5,-6.4 5.3,-10c3.5,-2.5 7.2,-2.5 9,-2.5h0.3c0.7,0 1.3,0.6 1.3,1.3c0,0.7 -0.6,1.3 -1.3,1.3h-0.3c-1.6,0 -4.6,0 -7.4,2.1c-3.9,2.9 -4.3,8.1 -4.3,8.1c-0.1,0.6 -0.7,1.1 -1.3,1.1zM26.8,23c0,-0.7 -0.5,-1.3 -1.2,-1.3c-0.7,0 -1.3,0.5 -1.3,1.2c0,0.2 0,2.5 2.1,5.1h3.7c-3.2,-2.3 -3.3,-4.8 -3.3,-5z\" fill=\"#4e3918\"></path><path d=\"M34.3,26.4c-1.7,-0.9 -2.6,-2.7 -3.5,-4.4c-1.2,-2.4 -2.8,-5.6 -7,-3.8c-1.3,0.6 -2.3,1.6 -2.8,3c-0.9,2.3 -0.3,5 0.6,6.7c0,0.1 0.1,0.1 0.1,0.2h2.9c-0.2,-0.4 -0.5,-0.8 -0.7,-1.3c-0.8,-1.6 -1,-3.5 -0.5,-4.8c0.3,-0.8 0.8,-1.3 1.5,-1.6c1.8,-0.8 2.3,-0.2 3.7,2.7c0.8,1.7 1.8,3.6 3.7,5h2.7c0.2,-0.7 -0.1,-1.4 -0.7,-1.7z\" fill=\"#4e3918\"></path><path d=\"M19.9,28c-0.8,-2 -1.2,-4.4 -0.8,-6.5c0.4,-1.9 1.5,-3.3 3.2,-4.3c1.9,-1.1 3.6,-1.3 5.2,-0.7c2.9,1.1 4.9,4.8 6.1,7.7c0.3,0.6 1,1 1.6,0.7c0.6,-0.3 1,-1 0.7,-1.6c-1.3,-3.4 -3.7,-7.7 -7.5,-9.1c-2.3,-0.8 -4.7,-0.5 -7.2,0.9c-2.3,1.3 -3.9,3.3 -4.5,5.9c-0.5,2.3 -0.2,4.9 0.5,7.1h2.7z\" fill=\"#4e3918\"></path><path d=\"M5,28h38v2h-38z\" fill=\"#d7347d\"></path></g></g></svg>\r\n</button>\r\n</template>\r\n\r\n<script setup>\r\n  import { ref, onMounted } from 'vue'\r\n  import { sendApi } from '@/utils/api'\r\n  const isSupported = ref(false)\r\n  onMounted(() => {\r\n    isSupported.value = window.PublicKeyCredential && typeof window.PublicKeyCredential === 'function'\r\n  })\r\n  async function registerWithWebAuthn() {\r\n    try {\r\n      const res = await sendApi({\r\n        action: 'register_webauthn_request',\r\n        control:'login'\r\n      })\r\n      if (!res || !res.publicKey) throw new Error('مشکلی در دریافت challenge ثبت رخ داد.')\r\n      const options = preformatMakeCredReq(res.publicKey)\r\n      const credential = await navigator.credentials.create({\r\n        publicKey: options\r\n      })\r\n      const result = await sendApi({\r\n        action: 'register_webauthn_response',\r\n        data:credential,\r\n        control:'login'\r\n      })\r\n      if (result && result.status === 'success') {\r\n        alert('ثبت اثر انگشت موفقیت‌آمیز بود.')\r\n      } else {\r\n        alert('ثبت اثر انگشت ناموفق بود.')\r\n      }\r\n    } catch (err) {\r\n      console.error(err)\r\n      alert('خطا در ثبت اثر انگشت.')\r\n    }\r\n  }\r\n  function decodeMimeBase64(mimeString) {\r\n    const match = mimeString.match(/=\\?BINARY\\?B\\?(.*)\\?=/i)\r\n    if (match && match[1]) {\r\n      return Uint8Array.from(atob(match[1]), c => c.charCodeAt(0)).buffer\r\n    }\r\n    return Uint8Array.from(atob(mimeString), c => c.charCodeAt(0)).buffer\r\n  }\r\n  function preformatMakeCredReq(options) {\r\n    const opts = { ...options }\r\n    opts.challenge = decodeMimeBase64(opts.challenge)\r\n    if (opts.user && opts.user.id) {\r\n      opts.user.id = decodeMimeBase64(opts.user.id)\r\n    }\r\n    if (opts.excludeCredentials && Array.isArray(opts.excludeCredentials)) {\r\n      opts.excludeCredentials = opts.excludeCredentials.map(cred => ({\r\n        ...cred,\r\n        id: decodeMimeBase64(cred.id)\r\n      }))\r\n    }\r\n    return opts\r\n  }\r\n</script>\r\n<style scoped>\r\n  button{\r\n    border: none;\r\n    outline: none;\r\n    width: 35px;\r\n    height: 35px;\r\n    cursor: pointer;\r\n    padding: 0;\r\n    background: transparent;\r\n  }\r\n  img{\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n</style>"],"mappings":";;;;AAOE,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,OAAO,QAAQ,aAAa;;;;IACrC,MAAMC,WAAW,GAAGH,GAAG,CAAC,KAAK,CAAC;IAC9BC,SAAS,CAAC,MAAM;MACdE,WAAW,CAACC,KAAK,GAAGC,MAAM,CAACC,mBAAmB,IAAI,OAAOD,MAAM,CAACC,mBAAmB,KAAK,UAAU;IACpG,CAAC,CAAC;IACF,eAAeC,oBAAoBA,CAAA,EAAG;MACpC,IAAI;QACF,MAAMC,GAAG,GAAG,MAAMN,OAAO,CAAC;UACxBO,MAAM,EAAE,2BAA2B;UACnCC,OAAO,EAAC;QACV,CAAC,CAAC;QACF,IAAI,CAACF,GAAG,IAAI,CAACA,GAAG,CAACG,SAAS,EAAE,MAAM,IAAIC,KAAK,CAAC,uCAAuC,CAAC;QACpF,MAAMC,OAAO,GAAGC,oBAAoB,CAACN,GAAG,CAACG,SAAS,CAAC;QACnD,MAAMI,UAAU,GAAG,MAAMC,SAAS,CAACC,WAAW,CAACC,MAAM,CAAC;UACpDP,SAAS,EAAEE;QACb,CAAC,CAAC;QACF,MAAMM,MAAM,GAAG,MAAMjB,OAAO,CAAC;UAC3BO,MAAM,EAAE,4BAA4B;UACpCW,IAAI,EAACL,UAAU;UACfL,OAAO,EAAC;QACV,CAAC,CAAC;QACF,IAAIS,MAAM,IAAIA,MAAM,CAACE,MAAM,KAAK,SAAS,EAAE;UACzCC,KAAK,CAAC,gCAAgC,CAAC;QACzC,CAAC,MAAM;UACLA,KAAK,CAAC,2BAA2B,CAAC;QACpC;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;QAClBD,KAAK,CAAC,uBAAuB,CAAC;MAChC;IACF;IACA,SAASI,gBAAgBA,CAACC,UAAU,EAAE;MACpC,MAAMC,KAAK,GAAGD,UAAU,CAACC,KAAK,CAAC,wBAAwB,CAAC;MACxD,IAAIA,KAAK,IAAIA,KAAK,CAAC,CAAC,CAAC,EAAE;QACrB,OAAOC,UAAU,CAACC,IAAI,CAACC,IAAI,CAACH,KAAK,CAAC,CAAC,CAAC,CAAC,EAAEI,CAAC,IAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,CAACC,MAAM;MACrE;MACA,OAAOL,UAAU,CAACC,IAAI,CAACC,IAAI,CAACJ,UAAU,CAAC,EAAEK,CAAC,IAAIA,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,CAACC,MAAM;IACvE;IACA,SAASpB,oBAAoBA,CAACD,OAAO,EAAE;MACrC,MAAMsB,IAAI,GAAG;QAAE,GAAGtB;MAAQ,CAAC;MAC3BsB,IAAI,CAACC,SAAS,GAAGV,gBAAgB,CAACS,IAAI,CAACC,SAAS,CAAC;MACjD,IAAID,IAAI,CAACE,IAAI,IAAIF,IAAI,CAACE,IAAI,CAACC,EAAE,EAAE;QAC7BH,IAAI,CAACE,IAAI,CAACC,EAAE,GAAGZ,gBAAgB,CAACS,IAAI,CAACE,IAAI,CAACC,EAAE,CAAC;MAC/C;MACA,IAAIH,IAAI,CAACI,kBAAkB,IAAIC,KAAK,CAACC,OAAO,CAACN,IAAI,CAACI,kBAAkB,CAAC,EAAE;QACrEJ,IAAI,CAACI,kBAAkB,GAAGJ,IAAI,CAACI,kBAAkB,CAACG,GAAG,CAACC,IAAI,KAAK;UAC7D,GAAGA,IAAI;UACPL,EAAE,EAAEZ,gBAAgB,CAACiB,IAAI,CAACL,EAAE;QAC9B,CAAC,CAAC,CAAC;MACL;MACA,OAAOH,IAAI;IACb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}