{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const useCartableStore = defineStore('cartable', () => {\n  const allItems = ref([]);\n  const rule = ref(true);\n  const loading = ref(true);\n  let pollingInterval = null;\n  const simplifyNews = items => items.map(item => ({\n    id: item.id,\n    status: item.status,\n    updated_at: item.updated_at\n  }));\n  const fetchCartables = async () => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'get_cartables'\n      });\n      if (res.status === 'success') {\n        const newData = res.data || [];\n        const isSame = JSON.stringify(simplifyNews(allItems.value)) === JSON.stringify(simplifyNews(newData));\n        if (!isSame) {\n          allItems.value = newData;\n        }\n        rule.value = !!res.rule;\n      } else {\n        alert('خطا در دریافت اطلاعات: ' + res.message);\n      }\n    } catch (e) {\n      alert('خطا در ارتباط با سرور: ' + e.message);\n    }\n    loading.value = false;\n  };\n  const startPolling = () => {\n    if (pollingInterval) return;\n    fetchCartables();\n    pollingInterval = setInterval(fetchCartables, 10000);\n  };\n  const stopPolling = () => {\n    if (pollingInterval) {\n      clearInterval(pollingInterval);\n      pollingInterval = null;\n    }\n  };\n  const getCartableById = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'get_cartable_by_id',\n        data: {\n          id\n        }\n      });\n      if (res.status === 'success') {\n        return res.data;\n      } else {\n        alert('خطا در دریافت جزئیات: ' + res.message);\n        return null;\n      }\n    } catch (e) {\n      alert('خطا در ارتباط با سرور: ' + e.message);\n      return null;\n    }\n  };\n  return {\n    allItems,\n    loading,\n    rule,\n    fetchCartables,\n    startPolling,\n    stopPolling,\n    getCartableById\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","useCartableStore","allItems","rule","loading","pollingInterval","simplifyNews","items","map","item","id","status","updated_at","fetchCartables","res","control","action","newData","data","isSame","JSON","stringify","value","alert","message","e","startPolling","setInterval","stopPolling","clearInterval","getCartableById"],"sources":["D:/GitHub/ci3-vue3/vue3/src/stores/cartable.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\n\r\nexport const useCartableStore = defineStore('cartable', () => {\r\n  const allItems = ref([])\r\n  const rule = ref(true)\r\n  const loading = ref(true)\r\n  let pollingInterval = null\r\n\r\n  const simplifyNews = (items) =>\r\n    items.map(item => ({\r\n      id: item.id,\r\n      status: item.status,\r\n      updated_at: item.updated_at\r\n    }))\r\n\r\n  const fetchCartables = async () => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'get_cartables' })\r\n      if (res.status === 'success') {\r\n        const newData = res.data || []\r\n        const isSame = JSON.stringify(simplifyNews(allItems.value)) === JSON.stringify(simplifyNews(newData))\r\n\r\n        if (!isSame) {\r\n          allItems.value = newData\r\n        }\r\n\r\n        rule.value = !!res.rule\r\n      } else {\r\n        alert('خطا در دریافت اطلاعات: ' + res.message)\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارتباط با سرور: ' + e.message)\r\n    }\r\n\r\n    loading.value = false\r\n  }\r\n\r\n  const startPolling = () => {\r\n    if (pollingInterval) return\r\n    fetchCartables()\r\n    pollingInterval = setInterval(fetchCartables, 10000)\r\n  }\r\n\r\n  const stopPolling = () => {\r\n    if (pollingInterval) {\r\n      clearInterval(pollingInterval)\r\n      pollingInterval = null\r\n    }\r\n  }\r\n\r\n  const getCartableById = async (id) => {\r\n    try {\r\n      const res = await sendApi({\r\n        control: 'news',\r\n        action: 'get_cartable_by_id',\r\n        data: { id }\r\n      })\r\n      if (res.status === 'success') {\r\n        return res.data\r\n      } else {\r\n        alert('خطا در دریافت جزئیات: ' + res.message)\r\n        return null\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارتباط با سرور: ' + e.message)\r\n      return null\r\n    }\r\n  }\r\n\r\n  return {\r\n    allItems,\r\n    loading,\r\n    rule,\r\n    fetchCartables,\r\n    startPolling,\r\n    stopPolling,\r\n    getCartableById\r\n  }\r\n})\r\n"],"mappings":";;AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,GAAG,QAAQ,KAAK;AACzB,SAASC,OAAO,QAAQ,aAAa;AAErC,OAAO,MAAMC,gBAAgB,GAAGH,WAAW,CAAC,UAAU,EAAE,MAAM;EAC5D,MAAMI,QAAQ,GAAGH,GAAG,CAAC,EAAE,CAAC;EACxB,MAAMI,IAAI,GAAGJ,GAAG,CAAC,IAAI,CAAC;EACtB,MAAMK,OAAO,GAAGL,GAAG,CAAC,IAAI,CAAC;EACzB,IAAIM,eAAe,GAAG,IAAI;EAE1B,MAAMC,YAAY,GAAIC,KAAK,IACzBA,KAAK,CAACC,GAAG,CAACC,IAAI,KAAK;IACjBC,EAAE,EAAED,IAAI,CAACC,EAAE;IACXC,MAAM,EAAEF,IAAI,CAACE,MAAM;IACnBC,UAAU,EAAEH,IAAI,CAACG;EACnB,CAAC,CAAC,CAAC;EAEL,MAAMC,cAAc,GAAG,MAAAA,CAAA,KAAY;IACjC,IAAI;MACF,MAAMC,GAAG,GAAG,MAAMd,OAAO,CAAC;QAAEe,OAAO,EAAE,MAAM;QAAEC,MAAM,EAAE;MAAgB,CAAC,CAAC;MACvE,IAAIF,GAAG,CAACH,MAAM,KAAK,SAAS,EAAE;QAC5B,MAAMM,OAAO,GAAGH,GAAG,CAACI,IAAI,IAAI,EAAE;QAC9B,MAAMC,MAAM,GAAGC,IAAI,CAACC,SAAS,CAACf,YAAY,CAACJ,QAAQ,CAACoB,KAAK,CAAC,CAAC,KAAKF,IAAI,CAACC,SAAS,CAACf,YAAY,CAACW,OAAO,CAAC,CAAC;QAErG,IAAI,CAACE,MAAM,EAAE;UACXjB,QAAQ,CAACoB,KAAK,GAAGL,OAAO;QAC1B;QAEAd,IAAI,CAACmB,KAAK,GAAG,CAAC,CAACR,GAAG,CAACX,IAAI;MACzB,CAAC,MAAM;QACLoB,KAAK,CAAC,yBAAyB,GAAGT,GAAG,CAACU,OAAO,CAAC;MAChD;IACF,CAAC,CAAC,OAAOC,CAAC,EAAE;MACVF,KAAK,CAAC,yBAAyB,GAAGE,CAAC,CAACD,OAAO,CAAC;IAC9C;IAEApB,OAAO,CAACkB,KAAK,GAAG,KAAK;EACvB,CAAC;EAED,MAAMI,YAAY,GAAGA,CAAA,KAAM;IACzB,IAAIrB,eAAe,EAAE;IACrBQ,cAAc,CAAC,CAAC;IAChBR,eAAe,GAAGsB,WAAW,CAACd,cAAc,EAAE,KAAK,CAAC;EACtD,CAAC;EAED,MAAMe,WAAW,GAAGA,CAAA,KAAM;IACxB,IAAIvB,eAAe,EAAE;MACnBwB,aAAa,CAACxB,eAAe,CAAC;MAC9BA,eAAe,GAAG,IAAI;IACxB;EACF,CAAC;EAED,MAAMyB,eAAe,GAAG,MAAOpB,EAAE,IAAK;IACpC,IAAI;MACF,MAAMI,GAAG,GAAG,MAAMd,OAAO,CAAC;QACxBe,OAAO,EAAE,MAAM;QACfC,MAAM,EAAE,oBAAoB;QAC5BE,IAAI,EAAE;UAAER;QAAG;MACb,CAAC,CAAC;MACF,IAAII,GAAG,CAACH,MAAM,KAAK,SAAS,EAAE;QAC5B,OAAOG,GAAG,CAACI,IAAI;MACjB,CAAC,MAAM;QACLK,KAAK,CAAC,wBAAwB,GAAGT,GAAG,CAACU,OAAO,CAAC;QAC7C,OAAO,IAAI;MACb;IACF,CAAC,CAAC,OAAOC,CAAC,EAAE;MACVF,KAAK,CAAC,yBAAyB,GAAGE,CAAC,CAACD,OAAO,CAAC;MAC5C,OAAO,IAAI;IACb;EACF,CAAC;EAED,OAAO;IACLtB,QAAQ;IACRE,OAAO;IACPD,IAAI;IACJU,cAAc;IACda,YAAY;IACZE,WAAW;IACXE;EACF,CAAC;AACH,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}