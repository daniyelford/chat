{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const useManageNewsStore = defineStore('manageNews', () => {\n  const newsList = ref([]);\n  const loading = ref(true);\n  let pollingInterval = null;\n  const simplifyNews = newsArray => newsArray.map(item => ({\n    id: item.id,\n    description: item.description,\n    status: item.status,\n    show_status: item.show_status,\n    report: !!item.report,\n    mediaCount: Array.isArray(item.media) ? item.media.length : 0,\n    categoryCount: Array.isArray(item.category) ? item.category.length : 0,\n    address: (item.city ?? '') + (item.address ?? '')\n  }));\n  const loadNews = async () => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'user_news'\n      });\n      if (res.status === 'success') {\n        const newList = res.data || [];\n        const isSame = JSON.stringify(simplifyNews(newsList.value)) === JSON.stringify(simplifyNews(newList));\n        if (!isSame) {\n          newsList.value = newList;\n        }\n        loading.value = false;\n      } else {\n        alert('خطا در بارگذاری اخبار: ' + res.message);\n      }\n    } catch (error) {\n      alert('خطا در ارتباط با سرور: ' + error.message);\n    }\n  };\n  const restoreNews = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'restore_news',\n        data: {\n          id: id\n        }\n      });\n      if (res.status === 'success') {\n        return true;\n      } else {\n        alert('خطا در پخش مجدد خبر: ' + res.message);\n        return false;\n      }\n    } catch (error) {\n      alert('خطا در ارتباط با سرور: ' + error.message);\n      return false;\n    }\n  };\n  const deleteNews = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'delete_news',\n        data: {\n          id: id\n        }\n      });\n      if (res.status === 'success') {\n        return true;\n      } else {\n        alert('خطا در حذف خبر: ' + res.message);\n        return false;\n      }\n    } catch (error) {\n      alert('خطا در ارتباط با سرور: ' + error.message);\n      return false;\n    }\n  };\n  const toggleShowStatus = id => {\n    const news = newsList.value.find(item => item.id === id);\n    if (news) {\n      news.show_status = news.show_status === 'do' ? 'dont' : 'do';\n    }\n  };\n  const startPolling = () => {\n    if (pollingInterval) return;\n    loadNews();\n    pollingInterval = setInterval(() => {\n      loadNews();\n    }, 10000);\n  };\n  const stopPolling = () => {\n    if (pollingInterval) {\n      clearInterval(pollingInterval);\n      pollingInterval = null;\n    }\n  };\n  return {\n    newsList,\n    loading,\n    loadNews,\n    deleteNews,\n    restoreNews,\n    startPolling,\n    stopPolling,\n    toggleShowStatus\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","useManageNewsStore","newsList","loading","pollingInterval","simplifyNews","newsArray","map","item","id","description","status","show_status","report","mediaCount","Array","isArray","media","length","categoryCount","category","address","city","loadNews","res","control","action","newList","data","isSame","JSON","stringify","value","alert","message","error","restoreNews","deleteNews","toggleShowStatus","news","find","startPolling","setInterval","stopPolling","clearInterval"],"sources":["D:/GitHub/chat/vue3/src/stores/manageNews.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\nexport const useManageNewsStore = defineStore('manageNews', () => {\r\n  const newsList = ref([])\r\n  const loading = ref(true)\r\n  let pollingInterval = null\r\n  const simplifyNews = (newsArray) =>\r\n    newsArray.map(item => ({\r\n      id: item.id,\r\n      description: item.description,\r\n      status: item.status,\r\n      show_status : item.show_status,\r\n      report: !!item.report,\r\n      mediaCount: Array.isArray(item.media) ? item.media.length : 0,\r\n      categoryCount: Array.isArray(item.category) ? item.category.length : 0,\r\n      address: (item.city ?? '') + (item.address ?? '')\r\n    }))\r\n\r\n  const loadNews = async () => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'user_news' })\r\n      if (res.status === 'success') {\r\n        const newList = res.data || []\r\n        const isSame =\r\n          JSON.stringify(simplifyNews(newsList.value)) ===\r\n          JSON.stringify(simplifyNews(newList))\r\n\r\n        if (!isSame) {\r\n          newsList.value = newList\r\n        }\r\n\r\n        loading.value = false\r\n      } else {\r\n        alert('خطا در بارگذاری اخبار: ' + res.message)\r\n      }\r\n    } catch (error) {\r\n      alert('خطا در ارتباط با سرور: ' + error.message)\r\n    }\r\n  }\r\n  const restoreNews = async (id) => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'restore_news', data: { id: id } })\r\n      if (res.status === 'success') {\r\n        return true\r\n      } else {\r\n        alert('خطا در پخش مجدد خبر: ' + res.message) \r\n        return false\r\n      }\r\n    } catch (error) {\r\n      alert('خطا در ارتباط با سرور: ' + error.message)\r\n      return false\r\n    }\r\n  }\r\n  const deleteNews = async (id) => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'delete_news', data: { id: id } })\r\n      if (res.status === 'success') {\r\n        return true\r\n      } else {\r\n        alert('خطا در حذف خبر: ' + res.message)\r\n        return false\r\n      }\r\n    } catch (error) {\r\n      alert('خطا در ارتباط با سرور: ' + error.message)\r\n      return false\r\n    }\r\n  }\r\n  const toggleShowStatus = (id) => {\r\n    const news = newsList.value.find(item => item.id === id)\r\n    if (news) {\r\n      news.show_status = news.show_status === 'do' ? 'dont' : 'do'\r\n    }\r\n  }\r\n  const startPolling = () => {\r\n    if (pollingInterval) return\r\n    loadNews()\r\n    pollingInterval = setInterval(() => {\r\n      loadNews()\r\n    }, 10000)\r\n  }\r\n  const stopPolling = () => {\r\n    if (pollingInterval) {\r\n      clearInterval(pollingInterval)\r\n      pollingInterval = null\r\n    }\r\n  }\r\n  return {\r\n    newsList,\r\n    loading,\r\n    loadNews,\r\n    deleteNews,\r\n    restoreNews,\r\n    startPolling,\r\n    stopPolling,\r\n    toggleShowStatus,\r\n  }\r\n})\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}