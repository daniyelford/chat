{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, vModelText as _vModelText, withDirectives as _withDirectives, unref as _unref, withCtx as _withCtx, withModifiers as _withModifiers, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"reply-preview\"\n};\nconst _hoisted_2 = {\n  class: \"reply-box\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"selectInner\"\n};\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = [\"disabled\"];\nimport { ref, onMounted, computed, watch } from 'vue';\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue';\nimport Multiselect from 'vue-multiselect';\nimport 'vue-multiselect/dist/vue-multiselect.min.css';\nimport AddressSelector from '@/components/tooles/news/AddressSelector .vue';\nimport BaseModal from '@/components/tooles/modal/BaseModal.vue';\nimport { useNewsStore } from '@/stores/news';\nimport { sendApi } from '@/utils/api';\nexport default {\n  __name: 'AddNewsForm',\n  props: {\n    replyToId: {\n      type: Number,\n      default: 0\n    }\n  },\n  setup(__props) {\n    const replyCard = ref(null);\n    const newsStore = useNewsStore();\n    const props = __props;\n    const categories = ref([]);\n    const address = ref('');\n    const rule = ref(false);\n    const userCoordinate = ref(null);\n    const isAddressLoading = ref(false);\n    const showModal = ref(false);\n    const form = ref({\n      user_address: {\n        type: 'location',\n        value: ''\n      },\n      media_id: [],\n      description: '',\n      category_id: []\n    });\n    const handleUploadResult = uploadedData => {\n      form.value.media_id = uploadedData.map(item => item.id);\n    };\n    function clearReply() {\n      replyCard.value = null;\n      emit('clearReplyId');\n    }\n    onMounted(async () => {\n      const data = await sendApi({\n        control: 'news',\n        action: 'add_data'\n      });\n      if (data.status === 'success') {\n        address.value = data.address;\n        rule.value = data.rule;\n        userCoordinate.value = {\n          lat: data.coordinate.lat,\n          lon: data.coordinate.lon\n        };\n        if (rule.value) {\n          categories.value = data.category ? [data.category] : [];\n          form.value.category_id = data.category ? [data.category] : [];\n        } else {\n          categories.value = data.category ?? [];\n        }\n      }\n    });\n    const isSubmitDisabled = computed(() => {\n      const isDescriptionEmpty = !form.value.description.trim();\n      const isCategoryInvalid = !rule.value && (!form.value.category_id || form.value.category_id.length === 0);\n      const isLocationSelected = form.value.user_address?.type === 'location';\n      const isAddressInvalid = isLocationSelected && (!form.value.user_address?.value || !form.value.user_address.value.address?.trim());\n      const isStillLoading = isLocationSelected && isAddressLoading.value;\n      return isDescriptionEmpty || isCategoryInvalid || isAddressInvalid || isStillLoading;\n    });\n    const isSaveDisabled = computed(() => {\n      return !form.value.description.trim();\n    });\n    const submitForm = async () => {\n      const finalData = {\n        ...form.value,\n        reply_to_id: props.replyToId\n      };\n      try {\n        const res = await newsStore.addNews(finalData);\n        if (res.status === 'success') {\n          showModal.value = false;\n          // router.push({ path: '/manage-news' })\n        } else {\n          alert('خطا در ثبت خبر: ' + res.message);\n        }\n      } catch (err) {\n        alert('خطا در ارسال: ' + err.message);\n      }\n    };\n    watch(() => props.replyToId, newId => {\n      if (newId > 0) {\n        replyCard.value = newsStore.cards.find(c => c.id === newId) || null;\n      } else {\n        replyCard.value = null;\n      }\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(_Fragment, null, [replyCard.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"p\", null, [_cache[6] || (_cache[6] = _createElementVNode(\"strong\", null, \"پاسخ به:\", -1)), _createTextVNode(\" \" + _toDisplayString(replyCard.value.user.name) + \" \" + _toDisplayString(replyCard.value.user.family), 1)]), _createElementVNode(\"p\", null, _toDisplayString(replyCard.value.description), 1), _createElementVNode(\"small\", null, _toDisplayString(replyCard.value.location?.city) + \" - \" + _toDisplayString(replyCard.value.created_at), 1), _createElementVNode(\"button\", {\n        class: \"close-btn\",\n        onClick: clearReply\n      }, \"×\")])])) : _createCommentVNode(\"\", true), _createVNode(UploaderManyMedia, {\n        url: 'news_media/',\n        toAction: 'addNews',\n        onDone: handleUploadResult\n      }), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"])\n      }, [_withDirectives(_createElementVNode(\"textarea\", {\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => form.value.description = $event),\n        rows: \"4\",\n        required: \"\"\n      }, null, 512), [[_vModelText, form.value.description]]), _createVNode(BaseModal, {\n        show: showModal.value,\n        onClose: _cache[4] || (_cache[4] = $event => showModal.value = false)\n      }, {\n        default: _withCtx(() => [!rule.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createVNode(_unref(Multiselect), {\n          modelValue: form.value.category_id,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.value.category_id = $event),\n          options: categories.value,\n          multiple: true,\n          \"track-by\": \"id\",\n          label: \"title\",\n          placeholder: \"گیرنده را انتخاب کنید\",\n          selectLabel: \"برای انتخاب این مورد کلیک کنید\",\n          selectedLabel: \"انتخاب شده\",\n          deselectLabel: \"برای حذف این مورد، کلیک کنید\",\n          noOptions: \"موردی برای انتخاب وجود ندارد\",\n          noResult: \"نتیجه‌ای با این جستجو پیدا نشد\"\n        }, null, 8, [\"modelValue\", \"options\"])])) : _createCommentVNode(\"\", true), _createVNode(AddressSelector, {\n          loginCity: address.value,\n          userCoordinate: userCoordinate.value,\n          \"model-value\": form.value.user_address,\n          onUpdate: _cache[2] || (_cache[2] = val => form.value.user_address = val),\n          onLoading: _cache[3] || (_cache[3] = $event => isAddressLoading.value = $event)\n        }, null, 8, [\"loginCity\", \"userCoordinate\", \"model-value\"]), _createElementVNode(\"button\", {\n          type: \"submit\",\n          disabled: isSubmitDisabled.value\n        }, \"ثبت خبر\", 8, _hoisted_4)]),\n        _: 1\n      }, 8, [\"show\"])], 32), _createElementVNode(\"button\", {\n        disabled: isSaveDisabled.value,\n        onClick: _cache[5] || (_cache[5] = $event => showModal.value = true)\n      }, \"افزودن خبر\", 8, _hoisted_5)], 64);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","watch","UploaderManyMedia","Multiselect","AddressSelector","BaseModal","useNewsStore","sendApi","replyCard","newsStore","props","__props","categories","address","rule","userCoordinate","isAddressLoading","showModal","form","user_address","type","value","media_id","description","category_id","handleUploadResult","uploadedData","map","item","id","clearReply","emit","data","control","action","status","lat","coordinate","lon","category","isSubmitDisabled","isDescriptionEmpty","trim","isCategoryInvalid","length","isLocationSelected","isAddressInvalid","isStillLoading","isSaveDisabled","submitForm","finalData","reply_to_id","replyToId","res","addNews","alert","message","err","newId","cards","find","c"],"sources":["D:/GitHub/chat/vue3/src/components/dashboard/pagesContent/AddNewsForm.vue"],"sourcesContent":["<template>\r\n  <div v-if=\"replyCard\" class=\"reply-preview\">\r\n    <div class=\"reply-box\">\r\n      <p><strong>پاسخ به:</strong> {{ replyCard.user.name }} {{ replyCard.user.family }}</p>\r\n      <p>{{ replyCard.description }}</p>\r\n      <small>{{ replyCard.location?.city }} - {{ replyCard.created_at }}</small>\r\n      <button class=\"close-btn\" @click=\"clearReply\">×</button>\r\n    </div>\r\n  </div>\r\n  <UploaderManyMedia\r\n  :url=\"'news_media/'\"\r\n  :toAction=\"'addNews'\"\r\n  @done=\"handleUploadResult\" />\r\n  <form @submit.prevent=\"submitForm\">\r\n    <textarea v-model=\"form.description\" rows=\"4\" required></textarea>\r\n    <BaseModal :show=\"showModal\" @close=\"showModal = false\">\r\n      <div v-if=\"!rule\" class=\"selectInner\">\r\n        <multiselect\r\n          v-model=\"form.category_id\"\r\n          :options=\"categories\"\r\n          :multiple=\"true\"\r\n          track-by=\"id\"\r\n          label=\"title\"\r\n          placeholder=\"گیرنده را انتخاب کنید\"\r\n          selectLabel=\"برای انتخاب این مورد کلیک کنید\"\r\n          selectedLabel=\"انتخاب شده\"\r\n          deselectLabel=\"برای حذف این مورد، کلیک کنید\"\r\n          noOptions=\"موردی برای انتخاب وجود ندارد\"\r\n          noResult=\"نتیجه‌ای با این جستجو پیدا نشد\"\r\n        />\r\n      </div>\r\n      <AddressSelector\r\n        :loginCity=\"address\"\r\n        :userCoordinate=\"userCoordinate\"\r\n        :model-value=\"form.user_address\"\r\n        @update=\"val => form.user_address = val\"\r\n        @loading=\"isAddressLoading = $event\"\r\n      />\r\n      <button type=\"submit\" :disabled=\"isSubmitDisabled\">ثبت خبر</button>\r\n    </BaseModal>\r\n  </form>\r\n  <button :disabled=\"isSaveDisabled\" @click=\"showModal = true\">افزودن خبر</button>\r\n</template>\r\n<script setup>\r\n  import { ref , onMounted , computed , defineProps , watch } from 'vue'\r\n  import UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue'\r\n  import Multiselect from 'vue-multiselect'\r\n  import 'vue-multiselect/dist/vue-multiselect.min.css'\r\n  import AddressSelector from '@/components/tooles/news/AddressSelector .vue'\r\n  import BaseModal from '@/components/tooles/modal/BaseModal.vue'\r\n  import { useNewsStore } from '@/stores/news'\r\n  import { sendApi } from '@/utils/api'\r\n  const replyCard = ref(null)\r\n  const newsStore = useNewsStore()\r\n  const props = defineProps({\r\n    replyToId: {\r\n      type: Number,\r\n      default: 0,\r\n    }\r\n  })\r\n  const categories = ref([])\r\n  const address = ref('')\r\n  const rule = ref(false)\r\n  const userCoordinate=ref(null)\r\n  const isAddressLoading = ref(false)\r\n  const showModal = ref(false)\r\n  const form = ref({\r\n    user_address: { type: 'location', value: '' },\r\n    media_id: [],\r\n    description: '',\r\n    category_id: [],\r\n  })\r\n  const handleUploadResult = (uploadedData) => {\r\n    form.value.media_id = uploadedData.map(item => item.id)\r\n  }\r\n  function clearReply() {\r\n    replyCard.value = null\r\n    emit('clearReplyId')\r\n  }\r\n  onMounted(async () => {\r\n    const data = await sendApi({ control: 'news', action: 'add_data' })\r\n    if (data.status === 'success') {\r\n      address.value = data.address\r\n      rule.value = data.rule\r\n      userCoordinate.value={\r\n        lat: data.coordinate.lat,\r\n        lon: data.coordinate.lon\r\n      }\r\n      if (rule.value) {\r\n        categories.value = data.category ? [data.category] : []\r\n        form.value.category_id = data.category ? [data.category] : []\r\n      } else {\r\n        categories.value = data.category ?? []\r\n      }\r\n    }        \r\n  })\r\n  const isSubmitDisabled = computed(() => {\r\n    const isDescriptionEmpty = !form.value.description.trim()\r\n    const isCategoryInvalid = !rule.value && (!form.value.category_id || form.value.category_id.length === 0)\r\n    const isLocationSelected = form.value.user_address?.type === 'location'\r\n    const isAddressInvalid = isLocationSelected && (!form.value.user_address?.value || !form.value.user_address.value.address?.trim())\r\n    const isStillLoading = isLocationSelected && isAddressLoading.value\r\n    return isDescriptionEmpty || isCategoryInvalid || isAddressInvalid || isStillLoading\r\n  })\r\n  const isSaveDisabled = computed(()=>{\r\n    return !form.value.description.trim()\r\n  })\r\n  const submitForm = async () => {\r\n    const finalData = {\r\n      ...form.value,\r\n      reply_to_id: props.replyToId,\r\n    }\r\n    try {\r\n      const res = await newsStore.addNews(finalData)\r\n      if (res.status === 'success') {\r\n        showModal.value = false\r\n        // router.push({ path: '/manage-news' })\r\n      } else {\r\n        alert('خطا در ثبت خبر: ' + res.message)\r\n      }\r\n    } catch (err) {\r\n      alert('خطا در ارسال: ' + err.message)\r\n    }\r\n  }\r\n  watch(() => props.replyToId, (newId) => {\r\n    if (newId > 0) {\r\n      replyCard.value = newsStore.cards.find(c => c.id === newId) || null\r\n    } else {\r\n      replyCard.value = null\r\n    }\r\n  })\r\n</script>\r\n<style scoped>\r\n  .reply-box {\r\n    background-color: #fff3cd;\r\n    padding: 10px;\r\n    margin: 10px 0;\r\n    border-left: 4px solid #ffc107;\r\n    position: relative;\r\n    border-radius: 6px;\r\n  }\r\n  .reply-box .close-btn {\r\n    position: absolute;\r\n    top: 5px;\r\n    left: 10px;\r\n    background: transparent;\r\n    border: none;\r\n    font-size: 18px;\r\n    cursor: pointer;\r\n  }\r\n  .selectInner{\r\n    margin-top: 30px;\r\n    margin-bottom: 15px;\r\n  }\r\n  form {\r\n    direction: rtl;\r\n  }\r\n  textarea {\r\n    border-radius: 5px;\r\n    width: auto;\r\n    padding: .5rem;\r\n    box-sizing: border-box;\r\n    height: 45px;\r\n    position: fixed;\r\n    bottom: 0;\r\n    z-index: 9999;\r\n    left: 45px;\r\n    right: 45px;\r\n  }\r\n  label{\r\n    margin-bottom: 0.5rem;\r\n    display: block;\r\n  }\r\n  button {\r\n    padding: .5rem;\r\n    background-color: #10b981;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 0.375rem;\r\n    cursor: pointer;\r\n    position: fixed;\r\n    transition: background-color .2s ease, opacity .2s ease;\r\n    bottom: 0;\r\n    right: 0;\r\n    width: 45px;\r\n    height: 45px;\r\n    transition: background-color 0.2s ease, opacity 0.2s ease;\r\n  }\r\n  button:disabled {\r\n    background-color: #9ca3af;\r\n    cursor: not-allowed;\r\n    opacity: 0.6;\r\n  }\r\n  form button{\r\n    width: 100%;\r\n    position: unset;\r\n    height: unset;\r\n    padding: 10px;\r\n    margin-top: 10px;\r\n  }\r\n</style>\r\n<style>\r\n  .multiselect__option {\r\n    text-align: start;\r\n  }\r\n  .multiselect__placeholder {\r\n    float: right;\r\n  }\r\n  .multiselect__option:after {\r\n    left: 0;\r\n    right: unset !important;\r\n  }\r\n</style>"],"mappings":";;;;;;;;;;;;;;;;;AA4CE,SAASA,GAAG,EAAGC,SAAS,EAAGC,QAAsB,EAAGC,KAAK,QAAQ,KAAK;AACtE,OAAOC,iBAAiB,MAAM,kDAAkD;AAChF,OAAOC,WAAW,MAAM,iBAAiB;AACzC,OAAO,8CAA8C;AACrD,OAAOC,eAAe,MAAM,+CAA+C;AAC3E,OAAOC,SAAS,MAAM,yCAAyC;AAC/D,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,OAAO,QAAQ,aAAa;;;;;;;;;;IACrC,MAAMC,SAAS,GAAGV,GAAG,CAAC,IAAI,CAAC;IAC3B,MAAMW,SAAS,GAAGH,YAAY,CAAC,CAAC;IAChC,MAAMI,KAAK,GAAGC,OAKZ;IACF,MAAMC,UAAU,GAAGd,GAAG,CAAC,EAAE,CAAC;IAC1B,MAAMe,OAAO,GAAGf,GAAG,CAAC,EAAE,CAAC;IACvB,MAAMgB,IAAI,GAAGhB,GAAG,CAAC,KAAK,CAAC;IACvB,MAAMiB,cAAc,GAACjB,GAAG,CAAC,IAAI,CAAC;IAC9B,MAAMkB,gBAAgB,GAAGlB,GAAG,CAAC,KAAK,CAAC;IACnC,MAAMmB,SAAS,GAAGnB,GAAG,CAAC,KAAK,CAAC;IAC5B,MAAMoB,IAAI,GAAGpB,GAAG,CAAC;MACfqB,YAAY,EAAE;QAAEC,IAAI,EAAE,UAAU;QAAEC,KAAK,EAAE;MAAG,CAAC;MAC7CC,QAAQ,EAAE,EAAE;MACZC,WAAW,EAAE,EAAE;MACfC,WAAW,EAAE;IACf,CAAC,CAAC;IACF,MAAMC,kBAAkB,GAAIC,YAAY,IAAK;MAC3CR,IAAI,CAACG,KAAK,CAACC,QAAQ,GAAGI,YAAY,CAACC,GAAG,CAACC,IAAI,IAAIA,IAAI,CAACC,EAAE,CAAC;IACzD,CAAC;IACD,SAASC,UAAUA,CAAA,EAAG;MACpBtB,SAAS,CAACa,KAAK,GAAG,IAAI;MACtBU,IAAI,CAAC,cAAc,CAAC;IACtB;IACAhC,SAAS,CAAC,YAAY;MACpB,MAAMiC,IAAI,GAAG,MAAMzB,OAAO,CAAC;QAAE0B,OAAO,EAAE,MAAM;QAAEC,MAAM,EAAE;MAAW,CAAC,CAAC;MACnE,IAAIF,IAAI,CAACG,MAAM,KAAK,SAAS,EAAE;QAC7BtB,OAAO,CAACQ,KAAK,GAAGW,IAAI,CAACnB,OAAO;QAC5BC,IAAI,CAACO,KAAK,GAAGW,IAAI,CAAClB,IAAI;QACtBC,cAAc,CAACM,KAAK,GAAC;UACnBe,GAAG,EAAEJ,IAAI,CAACK,UAAU,CAACD,GAAG;UACxBE,GAAG,EAAEN,IAAI,CAACK,UAAU,CAACC;QACvB,CAAC;QACD,IAAIxB,IAAI,CAACO,KAAK,EAAE;UACdT,UAAU,CAACS,KAAK,GAAGW,IAAI,CAACO,QAAQ,GAAG,CAACP,IAAI,CAACO,QAAQ,CAAC,GAAG,EAAE;UACvDrB,IAAI,CAACG,KAAK,CAACG,WAAW,GAAGQ,IAAI,CAACO,QAAQ,GAAG,CAACP,IAAI,CAACO,QAAQ,CAAC,GAAG,EAAE;QAC/D,CAAC,MAAM;UACL3B,UAAU,CAACS,KAAK,GAAGW,IAAI,CAACO,QAAQ,IAAI,EAAE;QACxC;MACF;IACF,CAAC,CAAC;IACF,MAAMC,gBAAgB,GAAGxC,QAAQ,CAAC,MAAM;MACtC,MAAMyC,kBAAkB,GAAG,CAACvB,IAAI,CAACG,KAAK,CAACE,WAAW,CAACmB,IAAI,CAAC,CAAC;MACzD,MAAMC,iBAAiB,GAAG,CAAC7B,IAAI,CAACO,KAAK,KAAK,CAACH,IAAI,CAACG,KAAK,CAACG,WAAW,IAAIN,IAAI,CAACG,KAAK,CAACG,WAAW,CAACoB,MAAM,KAAK,CAAC,CAAC;MACzG,MAAMC,kBAAkB,GAAG3B,IAAI,CAACG,KAAK,CAACF,YAAY,EAAEC,IAAI,KAAK,UAAU;MACvE,MAAM0B,gBAAgB,GAAGD,kBAAkB,KAAK,CAAC3B,IAAI,CAACG,KAAK,CAACF,YAAY,EAAEE,KAAK,IAAI,CAACH,IAAI,CAACG,KAAK,CAACF,YAAY,CAACE,KAAK,CAACR,OAAO,EAAE6B,IAAI,CAAC,CAAC,CAAC;MAClI,MAAMK,cAAc,GAAGF,kBAAkB,IAAI7B,gBAAgB,CAACK,KAAK;MACnE,OAAOoB,kBAAkB,IAAIE,iBAAiB,IAAIG,gBAAgB,IAAIC,cAAc;IACtF,CAAC,CAAC;IACF,MAAMC,cAAc,GAAGhD,QAAQ,CAAC,MAAI;MAClC,OAAO,CAACkB,IAAI,CAACG,KAAK,CAACE,WAAW,CAACmB,IAAI,CAAC,CAAC;IACvC,CAAC,CAAC;IACF,MAAMO,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC7B,MAAMC,SAAS,GAAG;QAChB,GAAGhC,IAAI,CAACG,KAAK;QACb8B,WAAW,EAAEzC,KAAK,CAAC0C;MACrB,CAAC;MACD,IAAI;QACF,MAAMC,GAAG,GAAG,MAAM5C,SAAS,CAAC6C,OAAO,CAACJ,SAAS,CAAC;QAC9C,IAAIG,GAAG,CAAClB,MAAM,KAAK,SAAS,EAAE;UAC5BlB,SAAS,CAACI,KAAK,GAAG,KAAK;UACvB;QACF,CAAC,MAAM;UACLkC,KAAK,CAAC,kBAAkB,GAAGF,GAAG,CAACG,OAAO,CAAC;QACzC;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZF,KAAK,CAAC,gBAAgB,GAAGE,GAAG,CAACD,OAAO,CAAC;MACvC;IACF,CAAC;IACDvD,KAAK,CAAC,MAAMS,KAAK,CAAC0C,SAAS,EAAGM,KAAK,IAAK;MACtC,IAAIA,KAAK,GAAG,CAAC,EAAE;QACblD,SAAS,CAACa,KAAK,GAAGZ,SAAS,CAACkD,KAAK,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAChC,EAAE,KAAK6B,KAAK,CAAC,IAAI,IAAI;MACrE,CAAC,MAAM;QACLlD,SAAS,CAACa,KAAK,GAAG,IAAI;MACxB;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}