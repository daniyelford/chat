{"ast":null,"code":"import { createElementVNode as _createElementVNode, normalizeStyle as _normalizeStyle, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"upload-box\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"progress-bar\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"preview\"\n};\nconst _hoisted_4 = [\"src\"];\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport default {\n  __name: 'UploadSingleImage',\n  props: {\n    toAction: String,\n    url: String\n  },\n  emits: ['uploaded'],\n  setup(__props, {\n    emit: __emit\n  }) {\n    const emit = __emit;\n    const selectedFileBase64 = ref('');\n    const imageUrl = ref('');\n    const imageId = ref('');\n    const readProgress = ref(0);\n    const reading = ref(false);\n    const props = __props;\n    function toBase64WithProgress(file) {\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reading.value = true;\n        readProgress.value = 0;\n        reader.onprogress = event => {\n          if (event.lengthComputable) {\n            readProgress.value = event.loaded / event.total * 100;\n          }\n        };\n        reader.onload = () => {\n          reading.value = false;\n          resolve(reader.result);\n        };\n        reader.onerror = error => {\n          reading.value = false;\n          reject(error);\n        };\n        reader.readAsDataURL(file);\n      });\n    }\n    const onFileChange = async e => {\n      const file = e.target.files[0];\n      if (!file) return;\n      try {\n        selectedFileBase64.value = await toBase64WithProgress(file);\n        await upload();\n      } catch (error) {\n        console.error('خطا در خواندن فایل:', error);\n        alert('خطا در خواندن فایل انتخاب شده.');\n      }\n    };\n    const upload = async () => {\n      if (!selectedFileBase64.value) {\n        alert('لطفاً یک فایل انتخاب کنید.');\n        return;\n      }\n      try {\n        const response = await sendApi({\n          action: 'upload_single_image',\n          data: {\n            url: props.url,\n            data: selectedFileBase64.value,\n            toAction: props.toAction\n          },\n          control: 'upload'\n        });\n        if (response.status === 'success' && response.url) {\n          imageUrl.value = response.url;\n          imageId.value = response.id;\n          emit('uploaded', response.id);\n        } else {\n          alert(response.message || 'آپلود موفق نبود');\n        }\n      } catch (err) {\n        console.error('خطا در ارسال به سرور:', err);\n        alert('مشکلی در آپلود پیش آمد');\n      }\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"input\", {\n        type: \"file\",\n        onChange: onFileChange\n      }, null, 32), _cache[0] || (_cache[0] = _createElementVNode(\"p\", null, \"عکس خود را بارگذاری کنید\", -1)), reading.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"div\", {\n        class: \"progress\",\n        style: _normalizeStyle({\n          width: readProgress.value + '%'\n        })\n      }, null, 4), _createElementVNode(\"p\", null, _toDisplayString(readProgress.value.toFixed(0)) + \"%\", 1)])) : _createCommentVNode(\"\", true), imageUrl.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"img\", {\n        src: imageUrl.value,\n        alt: \"uploaded\"\n      }, null, 8, _hoisted_4)])) : _createCommentVNode(\"\", true)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","sendApi","emit","__emit","selectedFileBase64","imageUrl","imageId","readProgress","reading","props","__props","toBase64WithProgress","file","Promise","resolve","reject","reader","FileReader","value","onprogress","event","lengthComputable","loaded","total","onload","result","onerror","error","readAsDataURL","onFileChange","e","target","files","upload","console","alert","response","action","data","url","toAction","control","status","id","message","err"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/tooles/upload/UploadSingleImage.vue"],"sourcesContent":["<template>\r\n  <div class=\"upload-box\">\r\n    <input type=\"file\" @change=\"onFileChange\" />\r\n    <p>عکس خود را بارگذاری کنید</p>\r\n    <div v-if=\"reading\" class=\"progress-bar\">\r\n      <div class=\"progress\" :style=\"{ width: readProgress + '%' }\"></div>\r\n      <p>{{ readProgress.toFixed(0) }}%</p>\r\n    </div>\r\n    <div v-if=\"imageUrl\" class=\"preview\">\r\n      <img :src=\"imageUrl\" alt=\"uploaded\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { ref,defineProps,defineEmits } from 'vue';\r\n  import { sendApi } from '@/utils/api';\r\n  const emit = defineEmits(['uploaded']);\r\n  const selectedFileBase64 = ref('');\r\n  const imageUrl = ref('');\r\n  const imageId = ref('');\r\n  const readProgress = ref(0);\r\n  const reading = ref(false);\r\n  const props = defineProps({\r\n    toAction: String,\r\n    url: String\r\n  })\r\n  function toBase64WithProgress(file) {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reading.value = true;\r\n      readProgress.value = 0;\r\n      reader.onprogress = (event) => {\r\n        if (event.lengthComputable) {\r\n          readProgress.value = (event.loaded / event.total) * 100;\r\n        }\r\n      };\r\n      reader.onload = () => {\r\n        reading.value = false;\r\n        resolve(reader.result);\r\n      };\r\n      reader.onerror = error => {\r\n        reading.value = false;\r\n        reject(error);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    });\r\n  }\r\n  const onFileChange = async (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n    try {\r\n      selectedFileBase64.value = await toBase64WithProgress(file);\r\n      await upload();\r\n    } catch (error) {\r\n      console.error('خطا در خواندن فایل:', error);\r\n      alert('خطا در خواندن فایل انتخاب شده.');\r\n    }\r\n  };\r\n  const upload = async () => {\r\n    if (!selectedFileBase64.value) {\r\n      alert('لطفاً یک فایل انتخاب کنید.');\r\n      return;\r\n    }\r\n    try {\r\n      const response = await sendApi(\r\n        {\r\n          action: 'upload_single_image',\r\n          data:{\r\n            url: props.url,\r\n            data: selectedFileBase64.value,\r\n            toAction:props.toAction,\r\n          }, \r\n          control:'upload'\r\n        }\r\n      );\r\n      if (response.status === 'success' && response.url) {\r\n        imageUrl.value = response.url;\r\n        imageId.value = response.id;\r\n        emit('uploaded', response.id);\r\n      } else {\r\n        alert(response.message || 'آپلود موفق نبود');\r\n      }\r\n    } catch (err) {\r\n      console.error('خطا در ارسال به سرور:', err);\r\n      alert('مشکلی در آپلود پیش آمد');\r\n    }\r\n  };\r\n</script>\r\n\r\n<style scoped>\r\n  .upload-box {\r\n    width: 100%;\r\n    height: 100%;\r\n    box-sizing: border-box;\r\n    overflow: hidden;\r\n  }\r\n  input[type=\"file\"] {\r\n      width: 100%;\r\n      top: -25px;\r\n      box-sizing: border-box;\r\n      height: calc(100% + 25px);\r\n      z-index: 999;\r\n      color: transparent;\r\n      position: relative;\r\n      background: transparent;\r\n  }\r\n  p{\r\n      position: relative;\r\n      top: -220px;\r\n      text-align: center;\r\n      color: white;\r\n      font-size: 20px;\r\n  }\r\n  .preview {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: relative;\r\n      top: -388px;\r\n      padding: 20px;\r\n      box-sizing: border-box;\r\n  }\r\n  img{\r\n      width: 100%;\r\n      height: 100%;\r\n      border-radius: 150px;\r\n  }\r\n  .progress-bar {\r\n      width: 96%;\r\n      background: #eee;\r\n      border: 1px solid #ccc;\r\n      top: -220px;\r\n      height: 22px;\r\n      position: relative;\r\n      border-radius: 6px;\r\n      overflow: hidden;\r\n      margin: 0 2%;\r\n  }\r\n  .progress {\r\n    background: #4caf50;\r\n    height: 100%;\r\n    width: 0%;\r\n    transition: width 0.2s ease;\r\n  }\r\n  .progress-bar p {\r\n    position: absolute;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    margin: 0;\r\n    font-size: 12px;\r\n    color: #000;\r\n    top: 2px;\r\n  }\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}