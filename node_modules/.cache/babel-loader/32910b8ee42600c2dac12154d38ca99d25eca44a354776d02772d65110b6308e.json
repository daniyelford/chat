{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, unref as _unref, createVNode as _createVNode, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"add-place-container\"\n};\nconst _hoisted_2 = [\"disabled\"];\nimport { ref, computed, onMounted } from 'vue';\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue';\nimport AddressSelector from '@/components/tooles/news/AddressSelector .vue';\nimport Multiselect from 'vue-multiselect';\nimport { sendApi } from '@/utils/api';\nimport { usePlaceStore } from '@/stores/place';\nexport default {\n  __name: 'AddPlaceForm',\n  props: {\n    editPlace: Object\n  },\n  emits: ['done'],\n  setup(__props, {\n    emit: __emit\n  }) {\n    const uploaderRef = ref(null);\n    const address = ref('');\n    const userCoordinate = ref(null);\n    const isAddressLoading = ref(false);\n    const placeStore = usePlaceStore();\n    const emit = __emit;\n    const initialMedias = ref([]);\n    const categories = ref([]);\n    const props = __props;\n    const form = ref({\n      title: '',\n      description: '',\n      category_id: [],\n      media_id: [],\n      user_address: {\n        type: 'location',\n        value: ''\n      }\n    });\n    const resetForm = () => {\n      form.value = {\n        title: '',\n        description: '',\n        media_id: [],\n        user_address: {\n          type: 'location',\n          value: ''\n        },\n        category_id: []\n      };\n      initialMedias.value = [];\n      uploaderRef.value?.reset();\n    };\n    const handleUploadResult = uploaded => {\n      form.value.media_id = uploaded.map(i => i.id);\n    };\n    const isSubmitDisabled = computed(() => {\n      const f = form.value;\n      return !f.title || !f.user_address?.value?.lat || isAddressLoading.value || uploaderRef.value?.uploading;\n    });\n    const submitPlace = async () => {\n      const data = {\n        ...form.value,\n        edit: props.editPlace?.id || null\n      };\n      const res = await sendApi({\n        control: 'place',\n        action: props.editPlace ? 'edit_place' : 'add_place',\n        data\n      });\n      if (res.status === 'success') {\n        await placeStore.fetchAllPlaces();\n        emit('done');\n        resetForm();\n      } else {\n        alert(res.message || 'خطا در ثبت مکان');\n      }\n    };\n    onMounted(async () => {\n      if (props.editPlace) {\n        const p = props.editPlace;\n        form.value.title = p.title || '';\n        form.value.description = p.description || '';\n        form.value.media_id = p.medias?.map(m => m.id) || [];\n        initialMedias.value = p.medias || [];\n        form.value.category_id = p.categories?.map(c => c.id) || [];\n        form.value.user_address = {\n          type: 'location',\n          value: {\n            address: p.addresses?.[0]?.address || '',\n            lat: p.addresses?.[0]?.lat,\n            lon: p.addresses?.[0]?.lon,\n            city: p.addresses?.[0]?.city || '',\n            address_id: p.addresses?.[0]?.id || ''\n          }\n        };\n      }\n      const res = await sendApi({\n        control: 'place',\n        action: 'get_categories'\n      });\n      if (res.status === 'success') {\n        categories.value = res.data;\n      }\n      address.value = placeStore.userCity || '';\n      userCoordinate.value = placeStore.userCoordinate;\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"h2\", null, _toDisplayString(props.editPlace ? 'ویرایش مکان' : 'افزودن مکان جدید'), 1), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitPlace, [\"prevent\"])\n      }, [_withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => form.value.title = $event),\n        placeholder: \"عنوان مکان\",\n        required: \"\"\n      }, null, 512), [[_vModelText, form.value.title]]), _withDirectives(_createElementVNode(\"textarea\", {\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.value.description = $event),\n        placeholder: \"توضیحات\"\n      }, null, 512), [[_vModelText, form.value.description]]), _createVNode(_unref(Multiselect), {\n        modelValue: form.value.category_id,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => form.value.category_id = $event),\n        options: categories.value,\n        multiple: true,\n        \"track-by\": \"id\",\n        label: \"title\",\n        placeholder: \"انتخاب دسته‌بندی‌ها\",\n        selectLabel: \"برای انتخاب کلیک کنید\",\n        deselectLabel: \"برای حذف کلیک کنید\"\n      }, null, 8, [\"modelValue\", \"options\"]), _createVNode(UploaderManyMedia, {\n        url: 'place_media/',\n        toAction: 'addPlace',\n        modelValue: form.value.media_id,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => form.value.media_id = $event),\n        \"initial-medias\": initialMedias.value,\n        ref_key: \"uploaderRef\",\n        ref: uploaderRef,\n        onDone: handleUploadResult\n      }, null, 8, [\"modelValue\", \"initial-medias\"]), _createVNode(AddressSelector, {\n        loginCity: address.value,\n        userCoordinate: userCoordinate.value,\n        \"model-value\": form.value.user_address,\n        onUpdate: _cache[4] || (_cache[4] = val => form.value.user_address = val),\n        onLoading: _cache[5] || (_cache[5] = $event => isAddressLoading.value = $event)\n      }, null, 8, [\"loginCity\", \"userCoordinate\", \"model-value\"]), _createElementVNode(\"button\", {\n        type: \"submit\",\n        disabled: isSubmitDisabled.value\n      }, _toDisplayString(props.editPlace ? 'ذخیره تغییرات' : 'ثبت مکان'), 9, _hoisted_2)], 32)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","UploaderManyMedia","AddressSelector","Multiselect","sendApi","usePlaceStore","uploaderRef","address","userCoordinate","isAddressLoading","placeStore","emit","__emit","initialMedias","categories","props","__props","form","title","description","category_id","media_id","user_address","type","value","resetForm","reset","handleUploadResult","uploaded","map","i","id","isSubmitDisabled","f","lat","uploading","submitPlace","data","edit","editPlace","res","control","action","status","fetchAllPlaces","alert","message","p","medias","m","c","addresses","lon","city","address_id","userCity"],"sources":["D:/GitHub/chat/vue3/src/components/dashboard/pagesContent/AddPlaceForm.vue"],"sourcesContent":["<template>\r\n    <div class=\"add-place-container\">\r\n        <h2>{{ props.editPlace ? 'ویرایش مکان' : 'افزودن مکان جدید' }}</h2>\r\n        <form @submit.prevent=\"submitPlace\">\r\n            <input v-model=\"form.title\" placeholder=\"عنوان مکان\" required />\r\n            <textarea v-model=\"form.description\" placeholder=\"توضیحات\" />\r\n            <Multiselect\r\n                v-model=\"form.category_id\"\r\n                :options=\"categories\"\r\n                :multiple=\"true\"\r\n                track-by=\"id\"\r\n                label=\"title\"\r\n                placeholder=\"انتخاب دسته‌بندی‌ها\"\r\n                selectLabel=\"برای انتخاب کلیک کنید\"\r\n                deselectLabel=\"برای حذف کلیک کنید\"\r\n            />\r\n            <UploaderManyMedia\r\n                :url=\"'place_media/'\"\r\n                :toAction=\"'addPlace'\"\r\n                v-model=\"form.media_id\"\r\n                :initial-medias=\"initialMedias\"\r\n                ref=\"uploaderRef\"\r\n                @done=\"handleUploadResult\"\r\n            />\r\n            <AddressSelector\r\n                :loginCity=\"address\"\r\n                :userCoordinate=\"userCoordinate\"\r\n                :model-value=\"form.user_address\"\r\n                @update=\"val => form.user_address = val\"\r\n                @loading=\"isAddressLoading = $event\"\r\n            />\r\n            <button type=\"submit\" :disabled=\"isSubmitDisabled\">\r\n                {{ props.editPlace ? 'ذخیره تغییرات' : 'ثبت مکان' }}\r\n            </button>\r\n        </form>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import { ref, computed, onMounted, defineProps, defineEmits } from 'vue'\r\n    import UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue'\r\n    import AddressSelector from '@/components/tooles/news/AddressSelector .vue'\r\n    import Multiselect from 'vue-multiselect'\r\n    import { sendApi } from '@/utils/api'\r\n    import { usePlaceStore } from '@/stores/place'\r\n    const uploaderRef = ref(null)\r\n    const address = ref('')\r\n    const userCoordinate = ref(null)\r\n    const isAddressLoading = ref(false)\r\n    const placeStore = usePlaceStore()\r\n    const emit = defineEmits(['done'])\r\n    const initialMedias = ref([])\r\n    const categories = ref([])\r\n    const props = defineProps({\r\n        editPlace: Object\r\n    })\r\n    const form = ref({\r\n        title: '',\r\n        description: '',\r\n        category_id: [],\r\n        media_id: [],\r\n        user_address: { type: 'location', value: '' }\r\n    })\r\n    const resetForm = () => {\r\n        form.value = {\r\n            title: '',\r\n            description: '',\r\n            media_id: [],\r\n            user_address: { type: 'location', value: '' },\r\n            category_id: []\r\n        }\r\n        initialMedias.value = []\r\n        uploaderRef.value?.reset()\r\n    }\r\n\r\n    const handleUploadResult = (uploaded) => {\r\n        form.value.media_id = uploaded.map(i => i.id)\r\n    }\r\n    const isSubmitDisabled = computed(() => {\r\n        const f = form.value\r\n        return !f.title || !f.user_address?.value?.lat || isAddressLoading.value || uploaderRef.value?.uploading\r\n    })\r\n    const submitPlace = async () => {\r\n        const data = {\r\n            ...form.value,\r\n            edit: props.editPlace?.id || null\r\n        }\r\n        const res = await sendApi({\r\n            control: 'place',\r\n            action: props.editPlace ? 'edit_place' : 'add_place',\r\n            data\r\n        })\r\n        if (res.status === 'success') {\r\n            await placeStore.fetchAllPlaces()\r\n            emit('done')\r\n            resetForm()\r\n        } else {\r\n            alert(res.message || 'خطا در ثبت مکان')\r\n        }\r\n    }\r\n    onMounted( async () => {\r\n        if (props.editPlace) {\r\n            const p = props.editPlace\r\n            form.value.title = p.title || ''\r\n            form.value.description = p.description || ''\r\n            form.value.media_id = p.medias?.map(m => m.id) || []\r\n            initialMedias.value = p.medias || []\r\n            form.value.category_id = p.categories?.map(c => c.id) || []\r\n            form.value.user_address = {\r\n                type: 'location',\r\n                value: {\r\n                    address: p.addresses?.[0]?.address || '',\r\n                    lat: p.addresses?.[0]?.lat,\r\n                    lon: p.addresses?.[0]?.lon,\r\n                    city: p.addresses?.[0]?.city || '',\r\n                    address_id: p.addresses?.[0]?.id || ''\r\n                }\r\n            }\r\n        }\r\n        const res = await sendApi({ control: 'place', action: 'get_categories' })\r\n        if (res.status === 'success') {\r\n            categories.value = res.data\r\n        }\r\n        address.value = placeStore.userCity || ''\r\n        userCoordinate.value = placeStore.userCoordinate\r\n    })\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}