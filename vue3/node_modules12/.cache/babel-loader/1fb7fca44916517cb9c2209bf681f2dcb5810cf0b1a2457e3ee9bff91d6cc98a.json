{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createBlock as _createBlock, unref as _unref } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"card-inner\"\n};\nconst _hoisted_3 = {\n  class: \"card-header\"\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"location\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"type\"\n};\nconst _hoisted_6 = {\n  class: \"card-category\"\n};\nconst _hoisted_7 = {\n  key: 1,\n  class: \"description\"\n};\nconst _hoisted_8 = {\n  class: \"time\"\n};\nconst _hoisted_9 = [\"onClick\"];\nconst _hoisted_10 = {\n  key: 2,\n  class: \"none-cart-error\"\n};\nimport { ref, onMounted } from 'vue';\nimport moment from 'moment-jalaali';\nimport { sendApi } from '@/utils/api';\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue';\nimport CalendarModal from '@/components/tooles/news/CalendarModal.vue';\n// import { useNotification } from '@kyvg/vue3-notification';\n// const notif=useNotification() \n// const showNotification = () => {\n//     notif.notify({\n//         title: 'خبر جدید',\n//         text: 'اخبار روز محدوده ی خود را با ما دنبال کنید',\n//         type: 'info'\n//     });\n// };\n// showNotification();\n// const props = defineProps({\n//     filters: Object,\n// })\n\nexport default {\n  __name: 'NewsCards',\n  setup(__props) {\n    const showModal = ref(false);\n    const selectedNewsId = ref(null);\n    const isLoaded = ref(false);\n    const hasRule = ref(false);\n    const cards = ref([]);\n    onMounted(async () => {\n      const news = await sendApi({\n        action: 'get_news',\n        control: 'news'\n      });\n      if (news.status === \"success\") {\n        if (news.data.length > 0) {\n          cards.value = news.data.map(cat => ({\n            id: cat.id,\n            location: cat.location,\n            category: cat.category ?? 'کلی',\n            description: cat.description,\n            created_at: cat.created_at,\n            type: cat.type,\n            medias: cat.media.map(media => ({\n              type: media.type,\n              url: media.url\n            }))\n          }));\n        }\n        isLoaded.value = true;\n        if (news.rule) hasRule.value = true;\n      } else {\n        console.warn('دریافت دسته‌بندی‌ها ناموفق بود:', news);\n      }\n    });\n    function openCalendarModal(id) {\n      selectedNewsId.value = id;\n      showModal.value = true;\n    }\n    async function onCalendarSubmit({\n      type,\n      date\n    }) {\n      const jsDate = date ? moment(date, 'jYYYY/jMM/jDD').toDate() : null;\n      const response = await sendApi({\n        action: 'add_news_to_list',\n        control: 'news',\n        data: {\n          news_id: selectedNewsId.value,\n          type: type,\n          run_time: jsDate ?? null\n        }\n      });\n      if (response.status === 'success') {\n        showModal.value = false;\n        console.log('ثبت با موفقیت انجام شد');\n      } else {\n        alert('خطا در ثبت تاریخ اجرا');\n      }\n    }\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(_Fragment, null, [!isLoaded.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \" در حال بارگذاری... \")) : cards.value.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(cards.value, card => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: card.id,\n          class: \"card\"\n        }, [_createElementVNode(\"div\", _hoisted_3, [card.location !== '' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, _toDisplayString(card.location), 1)) : _createCommentVNode(\"\", true), card.type === 'force' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, \" فوری \")) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_6, _toDisplayString(card.category), 1)]), card.medias.length > 0 ? (_openBlock(), _createBlock(MediaSlider, {\n          key: 0,\n          medias: card.medias\n        }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true), card.description !== '' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, _toDisplayString(card.description), 1)) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_8, _toDisplayString(_unref(moment)(card.created_at).format('jYYYY/jMM/jDD')), 1), hasRule.value ? (_openBlock(), _createElementBlock(\"a\", {\n          key: 2,\n          class: \"choose\",\n          onClick: $event => openCalendarModal(card.id)\n        }, \" بررسی \", 8, _hoisted_9)) : _createCommentVNode(\"\", true)]);\n      }), 128))])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \" خبری در محدوده شما وجود ندارد \")), showModal.value ? (_openBlock(), _createBlock(CalendarModal, {\n        key: 3,\n        onClose: _cache[0] || (_cache[0] = $event => showModal.value = false),\n        onSubmit: onCalendarSubmit\n      })) : _createCommentVNode(\"\", true)], 64);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","moment","sendApi","MediaSlider","CalendarModal","showModal","selectedNewsId","isLoaded","hasRule","cards","news","action","control","status","data","length","value","map","cat","id","location","category","description","created_at","type","medias","media","url","rule","console","warn","openCalendarModal","onCalendarSubmit","date","jsDate","toDate","response","news_id","run_time","log","alert"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/NewsCards.vue"],"sourcesContent":["<template>\r\n    <div class=\"loading\" v-if=\"!isLoaded\">\r\n        در حال بارگذاری...\r\n    </div>\r\n    <div class=\"card-inner\" v-else-if=\"cards.length>0\">\r\n        <div v-for=\"card in cards\" :key=\"card.id\" class=\"card\">\r\n            <div class=\"card-header\">\r\n                <div class=\"location\" v-if=\"card.location!==''\">\r\n                    {{ card.location }}\r\n                </div>\r\n                <div class=\"type\" v-if=\"card.type ==='force'\">\r\n                    فوری\r\n                </div>\r\n                <div class=\"card-category\">\r\n                    {{ card.category }}\r\n                </div>\r\n            </div>\r\n            <MediaSlider v-if=\"card.medias.length>0\" :medias=\"card.medias\" />\r\n            <div class=\"description\" v-if=\"card.description!==''\">\r\n                {{ card.description }}\r\n            </div>\r\n            <div class=\"time\">\r\n                {{ moment(card.created_at).format('jYYYY/jMM/jDD') }}\r\n            </div>\r\n            <a class=\"choose\" v-if=\"hasRule\" @click=\"openCalendarModal(card.id)\">\r\n                بررسی\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div class=\"none-cart-error\" v-else>\r\n        خبری در محدوده شما وجود ندارد\r\n    </div>\r\n    <CalendarModal v-if=\"showModal\" @close=\"showModal = false\" @submit=\"onCalendarSubmit\"/>\r\n</template>\r\n<script setup>\r\n    import { ref,onMounted } from 'vue'\r\n    import moment from 'moment-jalaali'\r\n    import { sendApi } from '@/utils/api'\r\n    import MediaSlider from '@/components/tooles/media/MediaSlider.vue';\r\n    import CalendarModal from '@/components/tooles/news/CalendarModal.vue';\r\n    // import { useNotification } from '@kyvg/vue3-notification';\r\n    // const notif=useNotification() \r\n    // const showNotification = () => {\r\n    //     notif.notify({\r\n    //         title: 'خبر جدید',\r\n    //         text: 'اخبار روز محدوده ی خود را با ما دنبال کنید',\r\n    //         type: 'info'\r\n    //     });\r\n    // };\r\n    // showNotification();\r\n    // const props = defineProps({\r\n    //     filters: Object,\r\n    // })\r\n    const showModal = ref(false)\r\n    const selectedNewsId = ref(null)\r\n    const isLoaded = ref(false)\r\n    const hasRule = ref(false)\r\n    const cards = ref([])\r\n    onMounted(async () => {\r\n        const news = await sendApi({action: 'get_news',control:'news'});\r\n        if(news.status===\"success\") {\r\n            if(news.data.length>0){\r\n                cards.value = news.data.map(cat => ({\r\n                    id: cat.id,\r\n                    location: cat.location,\r\n                    category: cat.category??'کلی',\r\n                    description: cat.description,\r\n                    created_at: cat.created_at,\r\n                    type: cat.type,\r\n                    medias: cat.media.map(media=>({\r\n                        type:media.type,\r\n                        url:media.url\r\n                    })),\r\n                }))\r\n            }\r\n            isLoaded.value=true\r\n            if(news.rule) hasRule.value=true\r\n        } else {\r\n            console.warn('دریافت دسته‌بندی‌ها ناموفق بود:', news)\r\n        }\r\n    })\r\n    function openCalendarModal(id) {\r\n        selectedNewsId.value = id\r\n        showModal.value = true\r\n    }\r\n    async function onCalendarSubmit({ type, date }) {\r\n        const jsDate = date? moment(date, 'jYYYY/jMM/jDD').toDate(): null;\r\n        const response = await sendApi({\r\n            action: 'add_news_to_list',\r\n            control: 'news',\r\n            data: {\r\n                news_id: selectedNewsId.value,\r\n                type: type,\r\n                run_time: jsDate ?? null,\r\n            }\r\n        });\r\n        if (response.status === 'success') {\r\n            showModal.value = false;\r\n            console.log('ثبت با موفقیت انجام شد');\r\n        } else {\r\n            alert('خطا در ثبت تاریخ اجرا');\r\n        }\r\n    }\r\n</script>\r\n<style scoped>\r\n    .card-inner{\r\n        width: 100%;\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: row-reverse;\r\n        flex-wrap: wrap;\r\n        align-content: flex-start;\r\n        justify-content: center;\r\n        align-items: stretch;\r\n    }\r\n    .card{\r\n        width: 49%;\r\n        min-height: 300px;\r\n        margin: 0 0.5% 10px 0.5%;\r\n        border-radius: 10px;\r\n        box-shadow: 0 0 5px grey;\r\n    }\r\n    .media{\r\n        height: 150px;\r\n        width: auto;\r\n        margin: auto;\r\n    }\r\n    .media img,.media video{\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .card-header{\r\n        display: flex;\r\n        flex-direction: row-reverse;\r\n        flex-wrap: nowrap;\r\n        justify-content: space-between;\r\n        align-items: stretch;\r\n        padding: 6px;\r\n    }\r\n    .description {\r\n        height: 50px;\r\n        padding: 5px;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        width: 95%;\r\n        text-align: center;\r\n        white-space: nowrap;\r\n    }\r\n    .time{\r\n        font-size: 10px;\r\n        padding-left: 10px;\r\n    }\r\n    .choose{\r\n        width: 95%;\r\n        height: 30px;\r\n        background: blue;\r\n        margin: 5px auto;\r\n        text-align: center;\r\n        border-radius: 10px;\r\n        color: white;\r\n        display: block;\r\n        padding-top: 10px;\r\n    }\r\n    /* .media video{ */\r\n        /* max-width: 400px; max-height: 300px; margin: 0.5rem; */\r\n    /* } */\r\n    @media screen and (max-width:600px){\r\n        .card{\r\n            width: 99%;\r\n        }\r\n    }\r\n</style>"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCI,SAASA,GAAG,EAACC,SAAS,QAAQ,KAAK;AACnC,OAAOC,MAAM,MAAM,gBAAgB;AACnC,SAASC,OAAO,QAAQ,aAAa;AACrC,OAAOC,WAAW,MAAM,2CAA2C;AACnE,OAAOC,aAAa,MAAM,4CAA4C;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;IACA,MAAMC,SAAS,GAAGN,GAAG,CAAC,KAAK,CAAC;IAC5B,MAAMO,cAAc,GAAGP,GAAG,CAAC,IAAI,CAAC;IAChC,MAAMQ,QAAQ,GAAGR,GAAG,CAAC,KAAK,CAAC;IAC3B,MAAMS,OAAO,GAAGT,GAAG,CAAC,KAAK,CAAC;IAC1B,MAAMU,KAAK,GAAGV,GAAG,CAAC,EAAE,CAAC;IACrBC,SAAS,CAAC,YAAY;MAClB,MAAMU,IAAI,GAAG,MAAMR,OAAO,CAAC;QAACS,MAAM,EAAE,UAAU;QAACC,OAAO,EAAC;MAAM,CAAC,CAAC;MAC/D,IAAGF,IAAI,CAACG,MAAM,KAAG,SAAS,EAAE;QACxB,IAAGH,IAAI,CAACI,IAAI,CAACC,MAAM,GAAC,CAAC,EAAC;UAClBN,KAAK,CAACO,KAAK,GAAGN,IAAI,CAACI,IAAI,CAACG,GAAG,CAACC,GAAG,KAAK;YAChCC,EAAE,EAAED,GAAG,CAACC,EAAE;YACVC,QAAQ,EAAEF,GAAG,CAACE,QAAQ;YACtBC,QAAQ,EAAEH,GAAG,CAACG,QAAQ,IAAE,KAAK;YAC7BC,WAAW,EAAEJ,GAAG,CAACI,WAAW;YAC5BC,UAAU,EAAEL,GAAG,CAACK,UAAU;YAC1BC,IAAI,EAAEN,GAAG,CAACM,IAAI;YACdC,MAAM,EAAEP,GAAG,CAACQ,KAAK,CAACT,GAAG,CAACS,KAAK,KAAG;cAC1BF,IAAI,EAACE,KAAK,CAACF,IAAI;cACfG,GAAG,EAACD,KAAK,CAACC;YACd,CAAC,CAAC;UACN,CAAC,CAAC,CAAC;QACP;QACApB,QAAQ,CAACS,KAAK,GAAC,IAAI;QACnB,IAAGN,IAAI,CAACkB,IAAI,EAAEpB,OAAO,CAACQ,KAAK,GAAC,IAAI;MACpC,CAAC,MAAM;QACHa,OAAO,CAACC,IAAI,CAAC,iCAAiC,EAAEpB,IAAI,CAAC;MACzD;IACJ,CAAC,CAAC;IACF,SAASqB,iBAAiBA,CAACZ,EAAE,EAAE;MAC3Bb,cAAc,CAACU,KAAK,GAAGG,EAAE;MACzBd,SAAS,CAACW,KAAK,GAAG,IAAI;IAC1B;IACA,eAAegB,gBAAgBA,CAAC;MAAER,IAAI;MAAES;IAAK,CAAC,EAAE;MAC5C,MAAMC,MAAM,GAAGD,IAAI,GAAEhC,MAAM,CAACgC,IAAI,EAAE,eAAe,CAAC,CAACE,MAAM,CAAC,CAAC,GAAE,IAAI;MACjE,MAAMC,QAAQ,GAAG,MAAMlC,OAAO,CAAC;QAC3BS,MAAM,EAAE,kBAAkB;QAC1BC,OAAO,EAAE,MAAM;QACfE,IAAI,EAAE;UACFuB,OAAO,EAAE/B,cAAc,CAACU,KAAK;UAC7BQ,IAAI,EAAEA,IAAI;UACVc,QAAQ,EAAEJ,MAAM,IAAI;QACxB;MACJ,CAAC,CAAC;MACF,IAAIE,QAAQ,CAACvB,MAAM,KAAK,SAAS,EAAE;QAC/BR,SAAS,CAACW,KAAK,GAAG,KAAK;QACvBa,OAAO,CAACU,GAAG,CAAC,wBAAwB,CAAC;MACzC,CAAC,MAAM;QACHC,KAAK,CAAC,uBAAuB,CAAC;MAClC;IACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}