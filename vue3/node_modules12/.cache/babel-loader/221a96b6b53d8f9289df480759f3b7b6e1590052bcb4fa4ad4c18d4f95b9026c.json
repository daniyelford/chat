{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const usePlaceStore = defineStore('place', () => {\n  const allPlaces = ref([]);\n  const categories = ref([]);\n  const userCoordinate = ref([]);\n  const userAccountId = ref(null);\n  const categoryLoading = ref(false);\n  const placeOffset = ref(0);\n  const categoryOffset = ref(0);\n  const hasMorePlaces = ref(true);\n  const hasMoreCategories = ref(true);\n  const fetchCategoriesPaginated = async (offset = 0, limit = 20) => {\n    const res = await sendApi({\n      control: 'place',\n      action: 'get_places_category',\n      data: {\n        offset: offset,\n        limit: limit\n      }\n    });\n    if (res.status === 'success') {\n      if (Array.isArray(res.data)) {\n        if (offset === 0) categories.value = res.data;else categories.value.push(...res.data);\n        hasMoreCategories.value = res.data.has_more;\n        categoryOffset.value += res.data.length;\n      }\n    }\n  };\n  const fetchPlacesPaginated = async ({\n    offset = 0,\n    category_id = null,\n    limit = 10\n  }) => {\n    const res = await sendApi({\n      control: 'place',\n      action: 'get_places',\n      data: {\n        offset: offset,\n        category_id: category_id,\n        limit: limit\n      }\n    });\n    if (res.status === 'success') {\n      if (Array.isArray(res.data)) {\n        if (offset === 0) allPlaces.value = res.data;else allPlaces.value.push(...res.data);\n        hasMorePlaces.value = res.data.has_more;\n        placeOffset.value += res.data.length;\n      }\n    }\n  };\n  const fetchPlacebyId = async id => {\n    const res = await sendApi({\n      control: 'place',\n      action: 'get_places',\n      data: {\n        id: id\n      }\n    });\n    if (res.status === 'success' && Array.isArray(res.data)) {\n      return res.data;\n    }\n    return [];\n  };\n  const fetchCategories = async query => {\n    categoryLoading.value = true;\n    try {\n      const res = await sendApi({\n        control: 'place',\n        action: 'get_places_category',\n        data: {\n          search: query\n        }\n      });\n      if (res.status === 'success' && Array.isArray(res.data)) {\n        categories.value = res.data;\n      } else {\n        console.error('خطا در دریافت داده‌ها:', res.message);\n      }\n    } catch (e) {\n      console.error('خطا در ارتباط:', e);\n    } finally {\n      categoryLoading.value = false;\n    }\n  };\n  const submitPlace = async (placeData, edit = null) => {\n    try {\n      const res = await sendApi({\n        control: 'place',\n        action: 'add_place',\n        data: placeData\n      });\n      if (res.status === 'success' && res.data?.id) {\n        const id = res.data.id;\n        const [newPlace] = await fetchPlacebyId(id);\n        if (!edit) {\n          allPlaces.value.unshift(newPlace);\n        } else {\n          const index = allPlaces.value.findIndex(p => Number(p.id) === Number(edit));\n          if (index !== -1) {\n            allPlaces.value[index] = newPlace;\n          } else {\n            allPlaces.value.unshift(newPlace);\n          }\n        }\n      }\n      return res;\n    } catch (error) {\n      console.error('submitPlace error:', error);\n      return {\n        status: 'error',\n        message: 'خطا در ارسال درخواست'\n      };\n    }\n  };\n  return {\n    allPlaces,\n    categories,\n    userCoordinate,\n    userAccountId,\n    categoryLoading,\n    placeOffset,\n    categoryOffset,\n    hasMorePlaces,\n    hasMoreCategories,\n    fetchCategoriesPaginated,\n    fetchPlacesPaginated,\n    fetchCategories,\n    submitPlace\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","usePlaceStore","allPlaces","categories","userCoordinate","userAccountId","categoryLoading","placeOffset","categoryOffset","hasMorePlaces","hasMoreCategories","fetchCategoriesPaginated","offset","limit","res","control","action","data","status","Array","isArray","value","push","has_more","length","fetchPlacesPaginated","category_id","fetchPlacebyId","id","fetchCategories","query","search","console","error","message","e","submitPlace","placeData","edit","newPlace","unshift","index","findIndex","p","Number"],"sources":["D:/GitHub/chat/vue3/src/stores/place.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\nexport const usePlaceStore = defineStore('place', () => {\r\n  const allPlaces = ref([])\r\n  const categories = ref([])\r\n  const userCoordinate = ref([])\r\n  const userAccountId = ref(null)\r\n  const categoryLoading = ref(false)\r\n  const placeOffset = ref(0)\r\n  const categoryOffset = ref(0)\r\n  const hasMorePlaces = ref(true)\r\n  const hasMoreCategories = ref(true)\r\n  const fetchCategoriesPaginated = async (offset = 0, limit = 20) => {\r\n    const res = await sendApi({\r\n      control: 'place',\r\n      action: 'get_places_category',\r\n      data: { offset:offset, limit:limit }\r\n    })\r\n    if (res.status === 'success') {\r\n      if (Array.isArray(res.data)) {\r\n        if (offset === 0) categories.value = res.data\r\n        else categories.value.push(...res.data)\r\n        hasMoreCategories.value = res.data.has_more\r\n        categoryOffset.value += res.data.length\r\n      }\r\n    }\r\n  }\r\n  const fetchPlacesPaginated = async ({ offset = 0, category_id = null, limit = 10 }) => {\r\n    const res = await sendApi({\r\n      control: 'place',\r\n      action: 'get_places',\r\n      data: { offset:offset, category_id:category_id, limit:limit }\r\n    })\r\n    if (res.status === 'success') {\r\n      if (Array.isArray(res.data)) {\r\n        if (offset === 0) allPlaces.value = res.data\r\n        else allPlaces.value.push(...res.data)\r\n        hasMorePlaces.value = res.data.has_more\r\n        placeOffset.value += res.data.length\r\n      }\r\n    }\r\n  }\r\n  const fetchPlacebyId = async (id) => {\r\n    const res = await sendApi({\r\n      control: 'place',\r\n      action: 'get_places',\r\n      data: { id:id }\r\n    })\r\n    if (res.status === 'success' && Array.isArray(res.data)) {\r\n      return res.data\r\n    }\r\n    return []\r\n  }\r\n  const fetchCategories = async (query) => {\r\n    categoryLoading.value = true\r\n    try {\r\n      const res = await sendApi({ control: 'place', action: 'get_places_category' , data: { search: query } })\r\n      if (res.status === 'success' && Array.isArray(res.data)) {\r\n        categories.value=res.data\r\n      } else {\r\n        console.error('خطا در دریافت داده‌ها:', res.message)\r\n      }\r\n    } catch (e) {\r\n      console.error('خطا در ارتباط:', e)\r\n    }finally {\r\n      categoryLoading.value = false\r\n    }\r\n  }\r\n  const submitPlace = async (placeData, edit = null) => {\r\n    try {\r\n      const res = await sendApi({\r\n        control: 'place',\r\n        action: 'add_place',\r\n        data: placeData\r\n      })\r\n      if (res.status === 'success' && res.data?.id) {\r\n        const id = res.data.id\r\n        const [newPlace] = await fetchPlacebyId(id)\r\n        if (!edit) {\r\n          allPlaces.value.unshift(newPlace)\r\n        } else {\r\n          const index = allPlaces.value.findIndex(p => Number(p.id) === Number(edit))\r\n          if (index !== -1) {\r\n            allPlaces.value[index] = newPlace\r\n          } else {\r\n            allPlaces.value.unshift(newPlace)\r\n          }\r\n        }\r\n      }\r\n      return res\r\n    } catch (error) {\r\n      console.error('submitPlace error:', error)\r\n      return { status: 'error', message: 'خطا در ارسال درخواست' }\r\n    }\r\n  }\r\n  return {\r\n    allPlaces,\r\n    categories,\r\n    userCoordinate,\r\n    userAccountId,\r\n    categoryLoading,\r\n    placeOffset,\r\n    categoryOffset,\r\n    hasMorePlaces,\r\n    hasMoreCategories,\r\n    fetchCategoriesPaginated,\r\n    fetchPlacesPaginated,\r\n    fetchCategories,\r\n    submitPlace\r\n  }\r\n})"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}