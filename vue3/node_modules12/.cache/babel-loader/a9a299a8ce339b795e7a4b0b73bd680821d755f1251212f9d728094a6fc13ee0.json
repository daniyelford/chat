{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const useCartableStore = defineStore('cartable', () => {\n  const allItems = ref([]);\n  const rule = ref(true);\n  const loading = ref(true);\n  const normalizeCartableEntry = ({\n    report,\n    news\n  }) => {\n    const reportInfo = report?.report_info || {};\n    return {\n      id: news?.id || null,\n      description: news?.description || '',\n      created_at: news?.created_at || '',\n      updated_at: news?.updated_at || '',\n      status: news?.status || '',\n      privacy: news?.privacy || '',\n      self: news?.self || false,\n      location: {\n        city: news?.city || null,\n        lat: news?.lat || null,\n        lon: news?.lon || null,\n        address: news?.address || null\n      },\n      category: Array.isArray(news?.categories) ? news.categories.map(c => ({\n        id: c.id,\n        title: c.title\n      })) : [],\n      user: {\n        id: news?.user_account_id || null,\n        name: news?.name || '',\n        family: news?.family || '',\n        phone: news?.phone || '',\n        image: news?.user_image_url || null\n      },\n      medias: Array.isArray(news?.media) ? news.media.map(m => ({\n        type: m.type,\n        url: m.url\n      })) : [],\n      reports: [{\n        id: report?.id || null,\n        news_id: reportInfo?.news_id || news?.id || null,\n        description: reportInfo?.description || '',\n        run_time: reportInfo?.run_time || null,\n        created_at: reportInfo?.created_at || '',\n        updated_at: reportInfo?.updated_at || '',\n        status: reportInfo?.status || '',\n        location: {\n          city: report?.location?.city || null,\n          address: report?.location?.address || null,\n          lat: report?.location?.lat || null,\n          lon: report?.location?.lon || null\n        },\n        reporter: {\n          id: report?.reporter?.user_account_id || null,\n          self: report?.reporter?.self || false,\n          name: report?.reporter?.name || '',\n          family: report?.reporter?.family || '',\n          phone: report?.reporter?.phone || '',\n          image: report?.reporter?.user_image_url || null\n        },\n        media: Array.isArray(report?.report_media) ? report.report_media.map(m => ({\n          id: m.id,\n          type: m.type,\n          url: m.url\n        })) : []\n      }]\n    };\n  };\n  const fetchCartables = async ({\n    limit = 10,\n    offset = 0\n  } = {}) => {\n    loading.value = true;\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'get_cartables',\n        data: {\n          limit,\n          offset\n        }\n      });\n      if (res.status === 'success' && Array.isArray(res.data)) {\n        allItems.value = res.data.map(item => normalizeCartableEntry(item));\n        rule.value = !!res.rule;\n        return;\n      } else {\n        alert('خطا در دریافت اطلاعات: ' + res.message);\n      }\n    } catch (e) {\n      alert('خطا در ارتباط با سرور: ' + e.message);\n    } finally {\n      loading.value = false;\n    }\n  };\n  const getCartableById = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'get_cartable_by_id',\n        data: {\n          id: id\n        }\n      });\n      if (res.status === 'success' && res.data) {\n        rule.value = !!res.rule;\n        return normalizeCartableEntry(res.data);\n      } else {\n        alert('خطا در دریافت جزئیات: ' + res.message);\n        return null;\n      }\n    } catch (e) {\n      alert('خطا در ارتباط با سرور: ' + e.message);\n      return null;\n    } finally {\n      loading.value = false;\n    }\n  };\n  const updateReport = async (id, description, mediaIds = []) => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'edit_report',\n        data: {\n          id,\n          description,\n          media_id: mediaIds\n        }\n      });\n      if (res.status === 'success') {\n        await fetchCartables();\n        return true;\n      } else {\n        alert('خطا: ' + res.message);\n        return false;\n      }\n    } catch (e) {\n      alert('خطا در ارسال گزارش: ' + e.message);\n      return false;\n    }\n  };\n  return {\n    allItems,\n    loading,\n    rule,\n    fetchCartables,\n    getCartableById,\n    updateReport\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","useCartableStore","allItems","rule","loading","normalizeCartableEntry","report","news","reportInfo","report_info","id","description","created_at","updated_at","status","privacy","self","location","city","lat","lon","address","category","Array","isArray","categories","map","c","title","user","user_account_id","name","family","phone","image","user_image_url","medias","media","m","type","url","reports","news_id","run_time","reporter","report_media","fetchCartables","limit","offset","value","res","control","action","data","item","alert","message","e","getCartableById","updateReport","mediaIds","media_id"],"sources":["D:/GitHub/chat/vue3/src/stores/cartable.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\nexport const useCartableStore = defineStore('cartable', () => {\r\n  const allItems = ref([])\r\n  const rule = ref(true)\r\n  const loading = ref(true)\r\n  const normalizeCartableEntry = ({ report, news }) => {\r\n    const reportInfo = report?.report_info || {}\r\n    return {\r\n      id: news?.id || null,\r\n      description: news?.description || '',\r\n      created_at: news?.created_at || '',\r\n      updated_at: news?.updated_at || '',\r\n      status: news?.status || '',\r\n      privacy: news?.privacy || '',\r\n      self: news?.self || false,\r\n      location: {\r\n        city: news?.city || null,\r\n        lat: news?.lat || null,\r\n        lon: news?.lon || null,\r\n        address: news?.address || null,\r\n      },\r\n      category: Array.isArray(news?.categories)\r\n        ? news.categories.map(c => ({\r\n            id: c.id,\r\n            title: c.title,\r\n          }))\r\n        : [],\r\n      user: {\r\n        id: news?.user_account_id || null,\r\n        name: news?.name || '',\r\n        family: news?.family || '',\r\n        phone: news?.phone || '',\r\n        image: news?.user_image_url || null,\r\n      },\r\n      medias: Array.isArray(news?.media)\r\n        ? news.media.map(m => ({\r\n            type: m.type,\r\n            url: m.url,\r\n          }))\r\n        : [],\r\n      reports: [\r\n        {\r\n          id: report?.id || null,\r\n          news_id: reportInfo?.news_id || news?.id || null,\r\n          description: reportInfo?.description || '',\r\n          run_time: reportInfo?.run_time || null,\r\n          created_at: reportInfo?.created_at || '',\r\n          updated_at: reportInfo?.updated_at || '',\r\n          status: reportInfo?.status || '',\r\n          location: {\r\n            city: report?.location?.city || null,\r\n            address: report?.location?.address || null,\r\n            lat: report?.location?.lat || null,\r\n            lon: report?.location?.lon || null,\r\n          },\r\n          reporter: {\r\n            id: report?.reporter?.user_account_id || null,\r\n            self: report?.reporter?.self || false,\r\n            name: report?.reporter?.name || '',\r\n            family: report?.reporter?.family || '',\r\n            phone: report?.reporter?.phone || '',\r\n            image: report?.reporter?.user_image_url || null,\r\n          },\r\n          media: Array.isArray(report?.report_media) ? \r\n            report.report_media.map(m => ({\r\n              id: m.id,\r\n              type: m.type,\r\n              url: m.url,\r\n            })) : [],\r\n        },\r\n      ],\r\n    }\r\n  }\r\n  const fetchCartables = async ({ limit = 10, offset = 0 } = {}) => {\r\n    loading.value = true\r\n    try {\r\n      const res = await sendApi({ control: 'news' , action: 'get_cartables' , data: { limit, offset } })\r\n      if (res.status === 'success'&& Array.isArray(res.data)) {\r\n        allItems.value = res.data.map(item => normalizeCartableEntry(item))\r\n        rule.value = !!res.rule\r\n        return\r\n      } else {\r\n        alert('خطا در دریافت اطلاعات: ' + res.message)\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارتباط با سرور: ' + e.message)\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n  const getCartableById = async (id) => {\r\n    try {\r\n      const res = await sendApi({\r\n        control: 'news',\r\n        action: 'get_cartable_by_id',\r\n        data: { id : id }\r\n      })\r\n      if (res.status === 'success' && res.data) {\r\n        rule.value = !!res.rule\r\n        return normalizeCartableEntry(res.data)\r\n      } else {\r\n        alert('خطا در دریافت جزئیات: ' + res.message)\r\n        return null\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارتباط با سرور: ' + e.message)\r\n      return null\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n  const updateReport = async (id, description, mediaIds = []) => {\r\n    try {\r\n      const res = await sendApi({\r\n        control: 'news',\r\n        action: 'edit_report',\r\n        data: {\r\n          id,\r\n          description,\r\n          media_id: mediaIds\r\n        }\r\n      })\r\n\r\n      if (res.status === 'success') {\r\n        await fetchCartables()\r\n        return true\r\n      } else {\r\n        alert('خطا: ' + res.message)\r\n        return false\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارسال گزارش: ' + e.message)\r\n      return false\r\n    }\r\n  }\r\n  return {\r\n    allItems,\r\n    loading,\r\n    rule,\r\n    fetchCartables,\r\n    getCartableById,\r\n    updateReport\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}