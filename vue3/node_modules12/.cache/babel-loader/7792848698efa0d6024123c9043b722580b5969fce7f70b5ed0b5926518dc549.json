{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { unref as _unref, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, withCtx as _withCtx, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"containers\"\n};\nconst _hoisted_2 = {\n  key: 1\n};\nconst _hoisted_3 = {\n  key: 2,\n  class: \"error\"\n};\nimport { onMounted, ref, computed, watch } from 'vue';\nimport { usePlaceStore } from '@/stores/place';\nimport { useInfiniteScroll } from '@/composables/useInfiniteScroll';\nimport BaseModal from '@/components/tooles/modal/BaseModal.vue';\nimport PlaceCategorySlider from '@/components/tooles/category/PlaceCategorySlider.vue';\nimport SinglePlaceMap from '@/components/tooles/places/SinglePlaceMap.vue';\nimport AddPlaceForm from '@/components/dashboard/pagesContent/AddPlaceForm.vue';\nimport placesCard from '@/components/tooles/cards/placesCard.vue';\nexport default {\n  __name: 'PlacesList',\n  setup(__props) {\n    const placeStore = usePlaceStore();\n    const selectedCategoryId = ref(null);\n    const showMapModal = ref(false);\n    const showAddPlace = ref(false);\n    const editingPlace = ref(null);\n    const selectedPlace = ref(null);\n    const userCenter = computed(() => {\n      const cord = placeStore.userCoordinate;\n      return cord?.lat && cord?.lon ? {\n        lat: parseFloat(cord.lat),\n        lon: parseFloat(cord.lon)\n      } : {\n        lat: 35.6892,\n        lon: 51.3890\n      };\n    });\n    const filteredPlaces = computed(() => {\n      if (!selectedCategoryId.value || Number(selectedCategoryId.value) === 0) {\n        return placeStore.allPlaces;\n      }\n      return placeStore.allPlaces.filter(place => (place.categories || []).some(cat => Number(cat.id) === Number(selectedCategoryId.value)));\n    });\n    const openMapModal = place => {\n      const address = place?.addresses?.[0];\n      if (!address?.lat || !address?.lon) return;\n      selectedPlace.value = {\n        ...address,\n        title: place.title || 'موقعیت',\n        description: place.description || '',\n        categories: place.categories || [],\n        medias: place.medias || [],\n        address: address.address || ''\n      };\n      showMapModal.value = true;\n    };\n    const handleCloseAddPlace = async () => {\n      showAddPlace.value = false;\n      editingPlace.value = null;\n      placeStore.resetPlaces();\n      await placeStore.fetchPlacesPaginated({\n        offset: 0,\n        category_id: selectedCategoryId.value\n      });\n    };\n    const editPlace = place => {\n      if (placeStore.userAccountId === 1 || placeStore.userAccountId === 2) {\n        editingPlace.value = place;\n        showAddPlace.value = true;\n      } else {\n        alert(\"شما مجوز ویرایش این مکان را ندارید.\");\n      }\n    };\n    const {\n      loadMoreTrigger: placeLoadTrigger,\n      setupObserver: setupPlaceObserver,\n      reset: resetPlaces\n    } = useInfiniteScroll(async () => {\n      await placeStore.fetchPlacesPaginated({\n        category_id: selectedCategoryId.value\n      });\n      return {\n        items: placeStore.allPlaces,\n        has_more: placeStore.hasMorePlaces\n      };\n    });\n    onMounted(() => {\n      setupPlaceObserver();\n    });\n    watch(showAddPlace, val => {\n      if (!val) editingPlace.value = null;\n    });\n    watch(selectedCategoryId, () => {\n      resetPlaces();\n      setupPlaceObserver();\n    });\n    return (_ctx, _cache) => {\n      return _unref(placeStore)?.allPlaces?.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(PlaceCategorySlider, {\n        selectedCategoryId: selectedCategoryId.value,\n        \"onUpdate:selectedCategoryId\": _cache[0] || (_cache[0] = $event => selectedCategoryId.value = $event)\n      }, null, 8, [\"selectedCategoryId\"]), _createVNode(placesCard, {\n        places: filteredPlaces.value,\n        \"user-id\": _unref(placeStore).userAccountId,\n        \"user-center\": userCenter.value,\n        onOpenMap: openMapModal,\n        onEditPlace: editPlace,\n        onAddPlace: _cache[1] || (_cache[1] = $event => showAddPlace.value = true)\n      }, null, 8, [\"places\", \"user-id\", \"user-center\"]), _createVNode(BaseModal, {\n        show: showMapModal.value,\n        onClose: _cache[2] || (_cache[2] = $event => showMapModal.value = false)\n      }, {\n        default: _withCtx(() => [selectedPlace.value && selectedPlace.value.lat && selectedPlace.value.lon ? (_openBlock(), _createBlock(SinglePlaceMap, {\n          key: 0,\n          \"user-center\": userCenter.value,\n          place: selectedPlace.value\n        }, null, 8, [\"user-center\", \"place\"])) : _createCommentVNode(\"\", true)]),\n        _: 1\n      }, 8, [\"show\"]), _createVNode(BaseModal, {\n        show: showAddPlace.value,\n        onClose: handleCloseAddPlace\n      }, {\n        default: _withCtx(() => [_createVNode(AddPlaceForm, {\n          editPlace: editingPlace.value,\n          onDone: handleCloseAddPlace\n        }, null, 8, [\"editPlace\"])]),\n        _: 1\n      }, 8, [\"show\"])])) : _unref(placeStore).categoryListLoading || _unref(placeStore).placeListLoading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, _cache[3] || (_cache[3] = [_createElementVNode(\"div\", {\n        class: \"tiny-loader\"\n      }, null, -1)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, \" محل نزدیکی برای ارائه به شما وجود ندارد \"));\n    };\n  }\n};","map":{"version":3,"names":["onMounted","ref","computed","watch","usePlaceStore","useInfiniteScroll","BaseModal","PlaceCategorySlider","SinglePlaceMap","AddPlaceForm","placesCard","placeStore","selectedCategoryId","showMapModal","showAddPlace","editingPlace","selectedPlace","userCenter","cord","userCoordinate","lat","lon","parseFloat","filteredPlaces","value","Number","allPlaces","filter","place","categories","some","cat","id","openMapModal","address","addresses","title","description","medias","handleCloseAddPlace","resetPlaces","fetchPlacesPaginated","offset","category_id","editPlace","userAccountId","alert","loadMoreTrigger","placeLoadTrigger","setupObserver","setupPlaceObserver","reset","items","has_more","hasMorePlaces","val"],"sources":["D:/GitHub/chat/vue3/src/components/dashboard/pagesContent/PlacesList.vue"],"sourcesContent":["<template>\r\n  <div class=\"containers\" v-if=\"placeStore?.allPlaces?.length > 0\">\r\n    <PlaceCategorySlider v-model:selectedCategoryId=\"selectedCategoryId\" />\r\n\r\n    <placesCard\r\n      :places=\"filteredPlaces\"\r\n      :user-id=\"placeStore.userAccountId\"\r\n      :user-center=\"userCenter\"\r\n      @open-map=\"openMapModal\"\r\n      @edit-place=\"editPlace\"\r\n      @add-place=\"showAddPlace = true\"\r\n    />\r\n\r\n    <BaseModal :show=\"showMapModal\" @close=\"showMapModal = false\">\r\n      <SinglePlaceMap\r\n        v-if=\"selectedPlace && selectedPlace.lat && selectedPlace.lon\"\r\n        :user-center=\"userCenter\"\r\n        :place=\"selectedPlace\"\r\n      />\r\n    </BaseModal>\r\n\r\n    <BaseModal :show=\"showAddPlace\" @close=\"handleCloseAddPlace\">\r\n      <AddPlaceForm :editPlace=\"editingPlace\" @done=\"handleCloseAddPlace\" />\r\n    </BaseModal>\r\n  </div>\r\n\r\n  <div v-else-if=\"placeStore.categoryListLoading || placeStore.placeListLoading\">\r\n    <div class=\"tiny-loader\"></div>\r\n  </div>\r\n\r\n  <div v-else class=\"error\">\r\n    محل نزدیکی برای ارائه به شما وجود ندارد\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, computed, watch } from 'vue'\r\nimport { usePlaceStore } from '@/stores/place'\r\nimport { useInfiniteScroll } from '@/composables/useInfiniteScroll'\r\nimport BaseModal from '@/components/tooles/modal/BaseModal.vue'\r\nimport PlaceCategorySlider from '@/components/tooles/category/PlaceCategorySlider.vue'\r\nimport SinglePlaceMap from '@/components/tooles/places/SinglePlaceMap.vue'\r\nimport AddPlaceForm from '@/components/dashboard/pagesContent/AddPlaceForm.vue'\r\nimport placesCard from '@/components/tooles/cards/placesCard.vue'\r\n\r\nconst placeStore = usePlaceStore()\r\nconst selectedCategoryId = ref(null)\r\nconst showMapModal = ref(false)\r\nconst showAddPlace = ref(false)\r\nconst editingPlace = ref(null)\r\nconst selectedPlace = ref(null)\r\n\r\nconst userCenter = computed(() => {\r\n  const cord = placeStore.userCoordinate\r\n  return (cord?.lat && cord?.lon)\r\n    ? { lat: parseFloat(cord.lat), lon: parseFloat(cord.lon) }\r\n    : { lat: 35.6892, lon: 51.3890 }\r\n})\r\n\r\nconst filteredPlaces = computed(() => {\r\n  if (!selectedCategoryId.value || Number(selectedCategoryId.value) === 0) {\r\n    return placeStore.allPlaces\r\n  }\r\n  return placeStore.allPlaces.filter(place =>\r\n    (place.categories || []).some(cat => Number(cat.id) === Number(selectedCategoryId.value))\r\n  )\r\n})\r\n\r\nconst openMapModal = (place) => {\r\n  const address = place?.addresses?.[0]\r\n  if (!address?.lat || !address?.lon) return\r\n  selectedPlace.value = {\r\n    ...address,\r\n    title: place.title || 'موقعیت',\r\n    description: place.description || '',\r\n    categories: place.categories || [],\r\n    medias: place.medias || [],\r\n    address: address.address || ''\r\n  }\r\n  showMapModal.value = true\r\n}\r\n\r\nconst handleCloseAddPlace = async () => {\r\n  showAddPlace.value = false\r\n  editingPlace.value = null\r\n  placeStore.resetPlaces()\r\n  await placeStore.fetchPlacesPaginated({ offset: 0, category_id: selectedCategoryId.value })\r\n}\r\n\r\nconst editPlace = (place) => {\r\n  if (placeStore.userAccountId === 1 || placeStore.userAccountId === 2) {\r\n    editingPlace.value = place\r\n    showAddPlace.value = true\r\n  } else {\r\n    alert(\"شما مجوز ویرایش این مکان را ندارید.\")\r\n  }\r\n}\r\n\r\nconst {\r\n  loadMoreTrigger: placeLoadTrigger,\r\n  setupObserver: setupPlaceObserver,\r\n  reset: resetPlaces\r\n} = useInfiniteScroll(async () => {\r\n  await placeStore.fetchPlacesPaginated({ category_id: selectedCategoryId.value })\r\n  return {\r\n    items: placeStore.allPlaces,\r\n    has_more: placeStore.hasMorePlaces,\r\n  }\r\n})\r\n\r\nonMounted(() => {\r\n  setupPlaceObserver()\r\n})\r\n\r\nwatch(showAddPlace, (val) => {\r\n  if (!val) editingPlace.value = null\r\n})\r\n\r\nwatch(selectedCategoryId, () => {\r\n  resetPlaces()\r\n  setupPlaceObserver()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.containers {\r\n  padding-bottom: .9%;\r\n  overflow: hidden;\r\n  height: 98%;\r\n  display: flex;\r\n  gap: 2%;\r\n  flex-direction: row-reverse;\r\n  align-items: stretch;\r\n  justify-content: center;\r\n  flex-wrap: nowrap;\r\n}\r\n.error {\r\n  width: 100%;\r\n  padding: 20px;\r\n  border-radius: 10px;\r\n  text-align: center;\r\n  background-color: red;\r\n  color: white;\r\n  font-size: large;\r\n  font-weight: bolder;\r\n  box-sizing: border-box;\r\n}\r\n.tiny-loader {\r\n  width: 20px;\r\n  height: 20px;\r\n  border: 2px solid #ccc;\r\n  border-top-color: #333;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin: 10px auto;\r\n}\r\n@keyframes spin {\r\n  to { transform: rotate(360deg); }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}