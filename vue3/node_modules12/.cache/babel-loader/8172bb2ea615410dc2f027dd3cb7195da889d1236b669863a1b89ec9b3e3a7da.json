{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { sendApi } from '@/utils/api';\nexport const useNewsStore = defineStore('news', {\n  state: () => ({\n    cards: [],\n    total: 0,\n    lastUpdate: null,\n    isLoaded: false,\n    hasRule: false\n  }),\n  actions: {\n    async fetchNews({\n      limit = 10,\n      offset = 0,\n      append = false\n    } = {}) {\n      const res = await sendApi({\n        action: 'get_news',\n        control: 'news',\n        data: {\n          limit,\n          offset\n        }\n      });\n      if (res.status === 'success') {\n        const newsObj = res.data || {};\n        const items = Object.values(newsObj);\n        const newCards = items.map(item => ({\n          id: item.id,\n          description: item.description,\n          created_at: item.created_at,\n          status: item.status,\n          privacy: item.privacy,\n          location: {\n            city: item.city || null,\n            lat: item.lat || item.address_lat || null,\n            lon: item.lon || item.address_lon || null,\n            address: item.address || null\n          },\n          category: Array.isArray(item.categories) ? item.categories.map(c => ({\n            id: c.id,\n            title: c.title\n          })) : [],\n          user: {\n            id: item.user_account_id || null,\n            name: item.name || '',\n            family: item.family || '',\n            phone: item.phone || '',\n            image: item.user_image_url || null\n          },\n          medias: Array.isArray(item.media) ? item.media.map(m => ({\n            type: m.type,\n            url: m.url\n          })) : []\n        }));\n        const filteredCards = newCards.filter(card => card.user.id);\n        this.cards = append ? [...this.cards, ...filteredCards] : [...filteredCards];\n        this.more = res.has_more;\n        this.lastUpdate = new Date().toISOString();\n        this.isLoaded = true;\n        this.hasRule = res.rule ?? false;\n        return filteredCards;\n      }\n      return [];\n    },\n    async fetchNewsById(id) {\n      const res = await sendApi({\n        action: 'get_news_by_id',\n        control: 'news',\n        data: {\n          id\n        }\n      });\n      if (res.status === 'success') {\n        const item = res.data;\n        return {\n          id: item.id,\n          description: item.description,\n          created_at: item.created_at,\n          status: item.status,\n          privacy: item.privacy,\n          location: {\n            city: item.city,\n            lat: item.lat,\n            lon: item.lon,\n            address: item.address\n          },\n          category: Array.isArray(item.categories) ? item.categories.map(category => ({\n            id: category.id,\n            title: category.title\n          })) : [],\n          user: {\n            id: item.user_account_id,\n            name: item.name,\n            family: item.family,\n            phone: item.phone,\n            image: item.user_image_url\n          },\n          medias: Array.isArray(item.media) ? item.media.map(media => ({\n            type: media.type,\n            url: media.url\n          })) : []\n        };\n      }\n      return null;\n    },\n    async fetchLatestNewsRaw(limit = 5, offset = 0) {\n      const res = await sendApi({\n        action: 'get_news',\n        control: 'news',\n        data: {\n          limit,\n          offset\n        }\n      });\n      return res.status === 'success' ? res.data : [];\n    },\n    async scheduleNewsRunTime(news_id, run_time) {\n      const res = await sendApi({\n        action: 'add_news_to_list',\n        control: 'news',\n        data: {\n          news_id,\n          run_time: run_time ?? null\n        }\n      });\n      return res;\n    },\n    async addNews(newsData) {\n      const res = await sendApi({\n        control: 'news',\n        action: 'add_news',\n        data: {\n          ...newsData,\n          category_id: newsData.category_id.map(c => c.id)\n        }\n      });\n      if (res.status === 'success') {\n        const newCard = await this.fetchNewsById(res.id);\n        if (newCard) {\n          this.cards.unshift(newCard);\n        }\n      }\n      return res;\n    }\n  }\n});","map":{"version":3,"names":["defineStore","sendApi","useNewsStore","state","cards","total","lastUpdate","isLoaded","hasRule","actions","fetchNews","limit","offset","append","res","action","control","data","status","newsObj","items","Object","values","newCards","map","item","id","description","created_at","privacy","location","city","lat","address_lat","lon","address_lon","address","category","Array","isArray","categories","c","title","user","user_account_id","name","family","phone","image","user_image_url","medias","media","m","type","url","filteredCards","filter","card","more","has_more","Date","toISOString","rule","fetchNewsById","fetchLatestNewsRaw","scheduleNewsRunTime","news_id","run_time","addNews","newsData","category_id","newCard","unshift"],"sources":["D:/GitHub/chat/vue3/src/stores/news.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { sendApi } from '@/utils/api'\r\nexport const useNewsStore = defineStore('news', {\r\n  state: () => ({\r\n    cards: [],\r\n    total:0,\r\n    lastUpdate: null,\r\n    isLoaded: false,\r\n    hasRule: false\r\n  }),\r\n  actions: {\r\n    async fetchNews({ limit = 10, offset = 0, append = false } = {}) {\r\n      const res = await sendApi({\r\n        action: 'get_news',\r\n        control: 'news',\r\n        data: { limit, offset }\r\n      })\r\n      if (res.status === 'success') {\r\n        const newsObj = res.data || {}\r\n        const items = Object.values(newsObj)\r\n        const newCards = items.map(item => ({\r\n          id: item.id,\r\n          description: item.description,\r\n          created_at: item.created_at,\r\n          status: item.status,\r\n          privacy: item.privacy,\r\n          location: {\r\n            city: item.city || null,\r\n            lat: item.lat || item.address_lat || null,\r\n            lon: item.lon || item.address_lon || null,\r\n            address: item.address || null,\r\n          },\r\n          category: Array.isArray(item.categories)\r\n            ? item.categories.map(c => ({\r\n                id: c.id,\r\n                title: c.title\r\n              }))\r\n            : [],\r\n          user: {\r\n            id: item.user_account_id || null,\r\n            name: item.name || '',\r\n            family: item.family || '',\r\n            phone: item.phone || '',\r\n            image: item.user_image_url || null,\r\n          },\r\n          medias: Array.isArray(item.media)\r\n            ? item.media.map(m => ({\r\n                type: m.type,\r\n                url: m.url\r\n              }))\r\n            : []\r\n        }))\r\n        const filteredCards = newCards.filter(card => card.user.id)\r\n        this.cards = append ? [...this.cards, ...filteredCards] : [...filteredCards]\r\n        this.more = res.has_more\r\n        this.lastUpdate = new Date().toISOString()\r\n        this.isLoaded = true\r\n        this.hasRule = res.rule ?? false\r\n        return filteredCards\r\n      }\r\n      return []\r\n    },\r\n    async fetchNewsById(id) {\r\n      const res = await sendApi({\r\n        action: 'get_news_by_id',\r\n        control: 'news',\r\n        data: { id }\r\n      })\r\n      if (res.status === 'success') {\r\n        const item = res.data\r\n        return {\r\n          id: item.id,\r\n          description: item.description,\r\n          created_at: item.created_at,\r\n          status:item.status,\r\n          privacy:item.privacy,\r\n          location: {\r\n            city: item.city,\r\n            lat: item.lat,\r\n            lon: item.lon,\r\n            address: item.address,\r\n          },\r\n          category: Array.isArray(item.categories) ? item.categories.map(category => ({\r\n            id: category.id,\r\n            title: category.title\r\n          })) : [],\r\n          user: {\r\n            id: item.user_account_id,\r\n            name: item.name,\r\n            family: item.family,\r\n            phone: item.phone,\r\n            image: item.user_image_url,\r\n          },\r\n          medias: Array.isArray(item.media) ? item.media.map(media => ({\r\n            type: media.type,\r\n            url: media.url\r\n          })) : []\r\n        }\r\n      }\r\n      return null\r\n    },\r\n    async fetchLatestNewsRaw(limit = 5, offset = 0) {\r\n      const res = await sendApi({\r\n        action: 'get_news',\r\n        control: 'news',\r\n        data: { limit, offset }\r\n      })\r\n      return res.status === 'success' ? res.data : []\r\n    },\r\n    async scheduleNewsRunTime(news_id, run_time) {\r\n      const res = await sendApi({\r\n        action: 'add_news_to_list',\r\n        control: 'news',\r\n        data: {\r\n          news_id,\r\n          run_time: run_time ?? null,\r\n        }\r\n      })\r\n      return res\r\n    },\r\n    async addNews(newsData) {\r\n      const res = await sendApi({\r\n        control: 'news',\r\n        action: 'add_news',\r\n        data: {\r\n          ...newsData,\r\n          category_id: newsData.category_id.map(c => c.id),\r\n        }\r\n      })\r\n      if (res.status === 'success') {\r\n        const newCard = await this.fetchNewsById(res.id)\r\n        if (newCard) {\r\n          this.cards.unshift(newCard)\r\n        }\r\n      }\r\n      return res\r\n    }\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}