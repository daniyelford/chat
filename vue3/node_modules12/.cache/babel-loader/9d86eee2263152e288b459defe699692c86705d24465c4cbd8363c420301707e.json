{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createElementVNode as _createElementVNode, createVNode as _createVNode, vModelText as _vModelText, withDirectives as _withDirectives, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"form-container\"\n};\nconst _hoisted_2 = {\n  class: \"form-group image-inner\"\n};\nconst _hoisted_3 = {\n  class: \"form-group\"\n};\nconst _hoisted_4 = {\n  class: \"form-group\"\n};\nconst _hoisted_5 = {\n  class: \"form-group\"\n};\nconst _hoisted_6 = {\n  class: \"form-group tx-c\"\n};\nimport { ref, onMounted } from 'vue';\nimport { useUserStore } from '@/stores/user';\nimport { sendApi } from '@/utils/api';\nimport UploadSingleImageUser from '@/components/tooles/upload/UploadSingleImageUser.vue';\nimport FingerPrintRegister from '@/components/tooles/nav/FingerPrintRegister.vue';\nimport router from '@/router';\nexport default {\n  __name: 'UserSetting',\n  setup(__props) {\n    const userStore = useUserStore();\n    const form = ref({\n      name: '',\n      family: '',\n      mobile: '',\n      image_id: null,\n      image_preview: ''\n    });\n    onMounted(() => {\n      if (!userStore.isLoaded) {\n        userStore.fetchUserInfo().then(() => {\n          fillForm();\n        });\n      } else {\n        fillForm();\n      }\n    });\n    const fillForm = () => {\n      form.value.name = userStore.name || '';\n      form.value.family = userStore.family || '';\n      form.value.mobile = userStore.mobile || '';\n      form.value.image_preview = userStore.image || '';\n    };\n    const submitForm = async () => {\n      if (!form.value.name || !form.value.family) {\n        alert('لطفاً تمام فیلدها را وارد کنید.');\n        return;\n      }\n      try {\n        const data = await sendApi({\n          control: 'user',\n          action: 'edit_user',\n          data: {\n            name: form.value.name,\n            family: form.value.family,\n            image_id: form.value.image_id\n          }\n        });\n        if (data.status === 'success') {\n          await userStore.fetchUserInfo();\n          router.push({\n            path: '/dashboard'\n          });\n        }\n      } catch (e) {\n        alert('خطا: ');\n      }\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[9] || (_cache[9] = _createElementVNode(\"h2\", {\n        class: \"form-title\"\n      }, \"ویرایش اطلاعات\", -1)), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"])\n      }, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(UploadSingleImageUser, {\n        url: \"register/\",\n        toAction: \"user-mobile\",\n        image: form.value.image_preview,\n        onUploaded: _cache[0] || (_cache[0] = ({\n          id,\n          url\n        }) => {\n          form.value.image_preview = url;\n          form.value.image_id = id;\n        })\n      }, null, 8, [\"image\"])]), _createElementVNode(\"div\", _hoisted_3, [_cache[4] || (_cache[4] = _createElementVNode(\"label\", {\n        class: \"form-label\"\n      }, \"نام\", -1)), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => form.value.name = $event),\n        type: \"text\",\n        class: \"form-input\"\n      }, null, 512), [[_vModelText, form.value.name]])]), _createElementVNode(\"div\", _hoisted_4, [_cache[5] || (_cache[5] = _createElementVNode(\"label\", {\n        class: \"form-label\"\n      }, \"نام خانوادگی\", -1)), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => form.value.family = $event),\n        type: \"text\",\n        class: \"form-input\"\n      }, null, 512), [[_vModelText, form.value.family]])]), _createElementVNode(\"div\", _hoisted_5, [_cache[6] || (_cache[6] = _createElementVNode(\"label\", {\n        class: \"form-label\"\n      }, \"شماره تماس\", -1)), _withDirectives(_createElementVNode(\"input\", {\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => form.value.mobile = $event),\n        disabled: \"\",\n        type: \"text\",\n        class: \"form-input\"\n      }, null, 512), [[_vModelText, form.value.mobile]])]), _createElementVNode(\"div\", _hoisted_6, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", {\n        class: \"form-label\"\n      }, \"تغییر اثر انگشت\", -1)), _createVNode(FingerPrintRegister, {\n        hasFinger: false\n      })]), _cache[8] || (_cache[8] = _createElementVNode(\"button\", {\n        class: \"form-button\",\n        type: \"submit\"\n      }, \"ویرایش\", -1))], 32)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","useUserStore","sendApi","UploadSingleImageUser","FingerPrintRegister","router","userStore","form","name","family","mobile","image_id","image_preview","isLoaded","fetchUserInfo","then","fillForm","value","image","submitForm","alert","data","control","action","status","push","path","e"],"sources":["D:/GitHub/chat/vue3/src/components/dashboard/pagesContent/UserSetting.vue"],"sourcesContent":["<template>\r\n    <div class=\"form-container\">\r\n        <h2 class=\"form-title\">ویرایش اطلاعات</h2>\r\n        <form @submit.prevent=\"submitForm\">\r\n            <div class=\"form-group image-inner\">\r\n                <UploadSingleImageUser url=\"register/\" toAction=\"user-mobile\" :image=\"form.image_preview\" \r\n                @uploaded=\"({ id, url }) => {\r\n                    form.image_preview = url\r\n                    form.image_id = id\r\n                }\"/>\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <label class=\"form-label\">نام</label>\r\n                <input v-model=\"form.name\" type=\"text\" class=\"form-input\" />\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <label class=\"form-label\">نام خانوادگی</label>\r\n                <input v-model=\"form.family\" type=\"text\" class=\"form-input\" />\r\n            </div>\r\n            <div class=\"form-group\">\r\n                <label class=\"form-label\">شماره تماس</label>\r\n                <input v-model=\"form.mobile\" disabled type=\"text\" class=\"form-input\" />\r\n            </div>\r\n            <div class=\"form-group tx-c\">\r\n                <label class=\"form-label\">تغییر اثر انگشت</label>\r\n                <FingerPrintRegister :hasFinger=\"false\"/>\r\n            </div>\r\n            <button class=\"form-button\" type=\"submit\">ویرایش</button>\r\n        </form>\r\n    </div>\r\n</template>\r\n<script setup>\r\n    import { ref, onMounted } from 'vue'\r\n    import { useUserStore } from '@/stores/user'\r\n    import { sendApi } from '@/utils/api'\r\n    import UploadSingleImageUser from '@/components/tooles/upload/UploadSingleImageUser.vue'\r\n    import FingerPrintRegister from '@/components/tooles/nav/FingerPrintRegister.vue'\r\n    import router from '@/router'\r\n    const userStore = useUserStore()\r\n    const form = ref({\r\n        name: '',\r\n        family: '',\r\n        mobile: '',\r\n        image_id: null,\r\n        image_preview: '' \r\n    })\r\n    onMounted(() => {\r\n        if (!userStore.isLoaded) {\r\n            userStore.fetchUserInfo().then(() => {\r\n                fillForm()\r\n            })\r\n        } else {\r\n            fillForm()\r\n        }\r\n    })\r\n    const fillForm = () => {\r\n        form.value.name = userStore.name || ''\r\n        form.value.family = userStore.family || ''\r\n        form.value.mobile = userStore.mobile || ''\r\n        form.value.image_preview = userStore.image || ''\r\n    }\r\n    const submitForm = async () => {\r\n        if (!form.value.name || !form.value.family) {\r\n            alert('لطفاً تمام فیلدها را وارد کنید.')\r\n            return\r\n        }\r\n        try {\r\n            const data = await sendApi({\r\n                control: 'user',\r\n                action: 'edit_user',\r\n                data: {\r\n                    name: form.value.name,\r\n                    family: form.value.family,\r\n                    image_id: form.value.image_id,\r\n                },\r\n            })\r\n            if(data.status==='success'){\r\n                await userStore.fetchUserInfo()\r\n                router.push({ path:'/dashboard' })\r\n            }\r\n        } catch (e) {\r\n            alert('خطا: ')\r\n        }\r\n    }\r\n</script>\r\n<style scoped>\r\n    .image-inner{\r\n        width: 50%;\r\n        margin: auto;\r\n    }\r\n    .tx-c{\r\n        text-align: center;\r\n    }\r\n    .form-container {\r\n        padding: 20px;\r\n        max-width: 500px;\r\n        margin: 0 auto;\r\n        background-color: #fefefe;\r\n        border: 1px solid #ddd;\r\n        border-radius: 10px;\r\n    }\r\n    .form-title {\r\n        text-align: center;\r\n        font-size: 22px;\r\n        font-weight: bold;\r\n        /* margin-bottom: 20px; */\r\n        margin:0;\r\n    }\r\n    .form-group {\r\n        /* margin-bottom: 16px; */\r\n    }\r\n    .form-label {\r\n        display: block;\r\n        direction: rtl;\r\n        font-weight: bold;\r\n        margin-bottom: 6px;\r\n        color: #333;\r\n    }\r\n    .form-input {\r\n        width: 100%;\r\n        padding: 10px 12px;\r\n        font-size: 14px;\r\n        box-sizing: border-box;\r\n        border: 1px solid #ccc;\r\n        border-radius: 6px;\r\n        background-color: #f9f9f9;\r\n        transition: 0.3s border-color ease;\r\n    }\r\n    .form-input:focus {\r\n        outline: none;\r\n        border-color: #007bff;\r\n        background-color: #fff;\r\n    }\r\n    .form-file {\r\n        width: 100%;\r\n        padding: 6px 0;\r\n        font-size: 14px;\r\n    }\r\n    .image-preview {\r\n        margin-top: 10px;\r\n    }\r\n    .image-preview img {\r\n        width: 100%;\r\n        max-height: 200px;\r\n        border-radius: 8px;\r\n        border: 1px solid #ccc;\r\n    }\r\n    .form-button {\r\n        background-color: #007bff;\r\n        color: white;\r\n        border: none;\r\n        padding: 10px 16px;\r\n        font-size: 15px;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        width: 100%;\r\n        transition: 0.2s background-color ease;\r\n    }\r\n    .form-button:hover {\r\n        background-color: #0056b3;\r\n    }\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAgCI,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,OAAO,QAAQ,aAAa;AACrC,OAAOC,qBAAqB,MAAM,sDAAsD;AACxF,OAAOC,mBAAmB,MAAM,iDAAiD;AACjF,OAAOC,MAAM,MAAM,UAAU;;;;IAC7B,MAAMC,SAAS,GAAGL,YAAY,CAAC,CAAC;IAChC,MAAMM,IAAI,GAAGR,GAAG,CAAC;MACbS,IAAI,EAAE,EAAE;MACRC,MAAM,EAAE,EAAE;MACVC,MAAM,EAAE,EAAE;MACVC,QAAQ,EAAE,IAAI;MACdC,aAAa,EAAE;IACnB,CAAC,CAAC;IACFZ,SAAS,CAAC,MAAM;MACZ,IAAI,CAACM,SAAS,CAACO,QAAQ,EAAE;QACrBP,SAAS,CAACQ,aAAa,CAAC,CAAC,CAACC,IAAI,CAAC,MAAM;UACjCC,QAAQ,CAAC,CAAC;QACd,CAAC,CAAC;MACN,CAAC,MAAM;QACHA,QAAQ,CAAC,CAAC;MACd;IACJ,CAAC,CAAC;IACF,MAAMA,QAAQ,GAAGA,CAAA,KAAM;MACnBT,IAAI,CAACU,KAAK,CAACT,IAAI,GAAGF,SAAS,CAACE,IAAI,IAAI,EAAE;MACtCD,IAAI,CAACU,KAAK,CAACR,MAAM,GAAGH,SAAS,CAACG,MAAM,IAAI,EAAE;MAC1CF,IAAI,CAACU,KAAK,CAACP,MAAM,GAAGJ,SAAS,CAACI,MAAM,IAAI,EAAE;MAC1CH,IAAI,CAACU,KAAK,CAACL,aAAa,GAAGN,SAAS,CAACY,KAAK,IAAI,EAAE;IACpD,CAAC;IACD,MAAMC,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC3B,IAAI,CAACZ,IAAI,CAACU,KAAK,CAACT,IAAI,IAAI,CAACD,IAAI,CAACU,KAAK,CAACR,MAAM,EAAE;QACxCW,KAAK,CAAC,iCAAiC,CAAC;QACxC;MACJ;MACA,IAAI;QACA,MAAMC,IAAI,GAAG,MAAMnB,OAAO,CAAC;UACvBoB,OAAO,EAAE,MAAM;UACfC,MAAM,EAAE,WAAW;UACnBF,IAAI,EAAE;YACFb,IAAI,EAAED,IAAI,CAACU,KAAK,CAACT,IAAI;YACrBC,MAAM,EAAEF,IAAI,CAACU,KAAK,CAACR,MAAM;YACzBE,QAAQ,EAAEJ,IAAI,CAACU,KAAK,CAACN;UACzB;QACJ,CAAC,CAAC;QACF,IAAGU,IAAI,CAACG,MAAM,KAAG,SAAS,EAAC;UACvB,MAAMlB,SAAS,CAACQ,aAAa,CAAC,CAAC;UAC/BT,MAAM,CAACoB,IAAI,CAAC;YAAEC,IAAI,EAAC;UAAa,CAAC,CAAC;QACtC;MACJ,CAAC,CAAC,OAAOC,CAAC,EAAE;QACRP,KAAK,CAAC,OAAO,CAAC;MAClB;IACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}