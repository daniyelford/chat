{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"map-wrapper\"\n};\nimport { onMounted, ref } from 'vue';\nimport { BASE_URL } from '@/config';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nexport default {\n  __name: 'MapPicker',\n  props: {\n    center: Object,\n    editMarker: Object\n  },\n  emits: ['pick'],\n  setup(__props, {\n    emit: __emit\n  }) {\n    const emit = __emit;\n    const map = ref(null);\n    const markerIcon = BASE_URL + '/assets/images/marker.svg';\n    const marker = ref(null);\n    const props = __props;\n    onMounted(() => {\n      map.value = L.map('map').setView([35.6892, 51.3890], 13);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; OpenStreetMap contributors'\n      }).addTo(map.value);\n      setTimeout(() => {\n        map.value.invalidateSize();\n      }, 300);\n      if (navigator.geolocation) {\n        navigator.geolocation.watchPosition(pos => {\n          const lat = pos.coords.latitude;\n          const lng = pos.coords.longitude;\n\n          // اگر مارکر قبلی وجود داشت پاک کن\n          // if (marker.value && map.value.hasLayer(marker.value)) {\n          //     map.value.removeLayer(marker.value)\n          // }\n\n          // مارکر جدید بزن\n          marker.value = L.marker([lat, lng], {\n            icon: L.icon({\n              iconUrl: BASE_URL + \"/assets/images/user-marker.svg\",\n              iconSize: [32, 32],\n              iconAnchor: [16, 32]\n            })\n          }).addTo(map.value);\n\n          // نقشه رو حرکت بده به موقعیت جدید\n          map.value.setView([lat, lng], 15);\n        }, err => {\n          console.error(\"خطا در دریافت موقعیت:\", err);\n        }, {\n          enableHighAccuracy: true,\n          maximumAge: 0\n        });\n      }\n      if (props.center?.lat && props.center?.lon) {\n        map.value.flyTo([props.center.lat, props.center.lon], 13, {\n          animate: true,\n          duration: 1.2\n        });\n      }\n      if (marker.value && map.value.hasLayer(marker.value)) {\n        map.value.removeLayer(marker.value);\n      }\n      if (props.editMarker?.lat && (props.editMarker.lng || props.editMarker.lon)) {\n        const lon = props.editMarker.lon ?? props.editMarker.lng;\n        marker.value = L.marker([props.editMarker?.lat, lon], {\n          icon: L.icon({\n            iconUrl: markerIcon,\n            iconSize: [32, 32],\n            iconAnchor: [16, 32]\n          })\n        }).addTo(map.value);\n      }\n      map.value.on('click', e => {\n        const {\n          lat,\n          lng\n        } = e.latlng;\n        if (marker.value && map.value.hasLayer(marker.value)) {\n          map.value.removeLayer(marker.value);\n        }\n        marker.value = L.marker([lat, lng], {\n          icon: L.icon({\n            iconUrl: markerIcon,\n            iconSize: [32, 32],\n            iconAnchor: [16, 32]\n          })\n        }).addTo(map.value);\n        emit('pick', {\n          lat,\n          lng\n        });\n      });\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, _cache[0] || (_cache[0] = [_createElementVNode(\"div\", {\n        id: \"map\",\n        class: \"map\"\n      }, null, -1)]));\n    };\n  }\n};","map":{"version":3,"names":["onMounted","ref","BASE_URL","L","emit","__emit","map","markerIcon","marker","props","__props","value","setView","tileLayer","attribution","addTo","setTimeout","invalidateSize","navigator","geolocation","watchPosition","pos","lat","coords","latitude","lng","longitude","icon","iconUrl","iconSize","iconAnchor","err","console","error","enableHighAccuracy","maximumAge","center","lon","flyTo","animate","duration","hasLayer","removeLayer","editMarker","on","e","latlng"],"sources":["D:/GitHub/chat/vue3/src/components/tooles/news/address/MapPicker.vue"],"sourcesContent":["<template>\r\n    <div class=\"map-wrapper\">\r\n        <div id=\"map\" class=\"map\"></div>\r\n    </div>\r\n</template>\r\n<script setup>\r\n    import { onMounted , ref , defineEmits , defineProps } from 'vue'\r\n    import { BASE_URL } from '@/config'\r\n    import L from 'leaflet'\r\n    import 'leaflet/dist/leaflet.css'\r\n    const emit = defineEmits(['pick'])\r\n    const map = ref(null)\r\n    const markerIcon= BASE_URL+'/assets/images/marker.svg'\r\n    const marker = ref(null)\r\n    const props = defineProps({\r\n        center: Object,\r\n        editMarker: Object,\r\n    })\r\n    onMounted(() => {\r\n        map.value = L.map('map').setView([35.6892, 51.3890], 13)\r\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n            attribution: '&copy; OpenStreetMap contributors',\r\n        }).addTo(map.value)\r\n         setTimeout(() => {\r\n            map.value.invalidateSize()\r\n        }, 300)\r\n        if (navigator.geolocation) {\r\n            navigator.geolocation.watchPosition((pos) => {\r\n                const lat = pos.coords.latitude\r\n                const lng = pos.coords.longitude\r\n\r\n                // اگر مارکر قبلی وجود داشت پاک کن\r\n                // if (marker.value && map.value.hasLayer(marker.value)) {\r\n                //     map.value.removeLayer(marker.value)\r\n                // }\r\n\r\n                // مارکر جدید بزن\r\n                marker.value = L.marker([lat, lng], {\r\n                    icon: L.icon({\r\n                        iconUrl: BASE_URL + \"/assets/images/user-marker.svg\",\r\n                        iconSize: [32, 32],\r\n                        iconAnchor: [16, 32],\r\n                    })\r\n                }).addTo(map.value)\r\n\r\n                // نقشه رو حرکت بده به موقعیت جدید\r\n                map.value.setView([lat, lng], 15)\r\n            }, (err) => {\r\n                console.error(\"خطا در دریافت موقعیت:\", err)\r\n            }, {\r\n                enableHighAccuracy: true,\r\n                maximumAge: 0\r\n            })\r\n        }\r\n        if (props.center?.lat && props.center?.lon) {\r\n            map.value.flyTo([props.center.lat, props.center.lon], 13, {\r\n                animate: true,\r\n                duration: 1.2,\r\n            })\r\n        }\r\n        if (marker.value && map.value.hasLayer(marker.value)){\r\n            map.value.removeLayer(marker.value)\r\n        }\r\n        if(props.editMarker?.lat && (props.editMarker.lng || props.editMarker.lon)){\r\n            const lon= props.editMarker.lon ?? props.editMarker.lng\r\n            marker.value = L.marker([props.editMarker?.lat, lon], {\r\n                icon: L.icon({\r\n                    iconUrl: markerIcon,\r\n                    iconSize: [32, 32],\r\n                    iconAnchor: [16, 32],\r\n                }),\r\n            }).addTo(map.value)\r\n        }\r\n        map.value.on('click', (e) => {\r\n            const { lat, lng } = e.latlng\r\n            if (marker.value && map.value.hasLayer(marker.value)){\r\n                map.value.removeLayer(marker.value)\r\n            }\r\n            marker.value = L.marker([lat, lng], {\r\n                icon: L.icon({\r\n                    iconUrl: markerIcon,\r\n                    iconSize: [32, 32],\r\n                    iconAnchor: [16, 32],\r\n                })\r\n            }).addTo(map.value)\r\n            emit('pick', { lat, lng })\r\n        })\r\n    })\r\n</script>\r\n<style scoped>\r\n    .map-wrapper {\r\n        width: 65%;\r\n        height: 300px;\r\n        display: inline-block;\r\n        margin-top: 1rem;\r\n    }\r\n    .map {\r\n        width: 100%;\r\n        height: 100%;\r\n        border-radius: 8px;\r\n        z-index: 9;\r\n    }\r\n    @media screen and (max-width: 600px) {\r\n        .map-wrapper {\r\n            width: 100%;\r\n            height: 200px;\r\n        }\r\n    }\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}