{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const useManageNewsStore = defineStore('manageNews', () => {\n  const newsList = ref([]);\n  const loading = ref(false);\n  function deepEqual(a, b) {\n    return JSON.stringify(a) === JSON.stringify(b);\n  }\n  const loadNews = async () => {\n    loading.value = true;\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'user_news'\n      });\n      if (res.status === 'success') {\n        const currentIds = this.cards.map(c => c.id).sort((a, b) => a - b);\n        const newIds = newCards.map(c => c.id).sort((a, b) => a - b);\n        const isDifferent = JSON.stringify(currentIds) !== JSON.stringify(newIds);\n        if (isDifferent) {\n          this.newsList = newCards;\n        }\n        const newList = res.data || [];\n        if (!deepEqual(newsList.value, newList)) {\n          newsList.value = newList;\n        }\n      } else {\n        alert('خطا در بارگذاری اخبار: ' + res.message);\n      }\n    } catch (error) {\n      alert('خطا در ارتباط با سرور: ' + error.message);\n    }\n    loading.value = false;\n  };\n  const restoreNews = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'restore_news',\n        data: {\n          id: id\n        }\n      });\n      if (res.status === 'success') {\n        await loadNews();\n        return true;\n      } else {\n        alert('خطا در پخش مجدد خبر: ' + res.message);\n        return false;\n      }\n    } catch (error) {\n      alert('خطا در ارتباط با سرور: ' + error.message);\n      return false;\n    }\n  };\n  const deleteNews = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'delete_news',\n        data: {\n          id: id\n        }\n      });\n      if (res.status === 'success') {\n        newsList.value = newsList.value.filter(news => news.id !== id);\n        return true;\n      } else {\n        alert('خطا در حذف خبر: ' + res.message);\n        return false;\n      }\n    } catch (error) {\n      alert('خطا در ارتباط با سرور: ' + error.message);\n      return false;\n    }\n  };\n  let pollingInterval = null;\n  const startPolling = () => {\n    if (pollingInterval) return;\n    loadNews();\n    pollingInterval = setInterval(() => {\n      loadNews();\n    }, 10000);\n  };\n  const stopPolling = () => {\n    if (pollingInterval) {\n      clearInterval(pollingInterval);\n      pollingInterval = null;\n    }\n  };\n  return {\n    newsList,\n    loading,\n    loadNews,\n    deleteNews,\n    restoreNews,\n    startPolling,\n    stopPolling\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","useManageNewsStore","newsList","loading","deepEqual","a","b","JSON","stringify","loadNews","value","res","control","action","status","currentIds","cards","map","c","id","sort","newIds","newCards","isDifferent","newList","data","alert","message","error","restoreNews","deleteNews","filter","news","pollingInterval","startPolling","setInterval","stopPolling","clearInterval"],"sources":["D:/GitHub/ci3-vue3/vue3/src/stores/manageNews.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\nexport const useManageNewsStore = defineStore('manageNews', () => {\r\n  const newsList = ref([])\r\n  const loading = ref(false)\r\n  function deepEqual(a, b) {\r\n    return JSON.stringify(a) === JSON.stringify(b)\r\n  }\r\n  const loadNews = async () => {\r\n    loading.value = true\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'user_news' })\r\n      if (res.status === 'success') {\r\n        const currentIds = this.cards.map(c => c.id).sort((a, b) => a - b)\r\n        const newIds = newCards.map(c => c.id).sort((a, b) => a - b)\r\n        const isDifferent = JSON.stringify(currentIds) !== JSON.stringify(newIds)\r\n        if (isDifferent) {\r\n          this.newsList = newCards\r\n\r\n        }\r\n        const newList = res.data || []\r\n        if (!deepEqual(newsList.value, newList)) {\r\n          newsList.value = newList\r\n        }\r\n      } else {\r\n        alert('خطا در بارگذاری اخبار: ' + res.message)\r\n      }\r\n    } catch (error) {\r\n      alert('خطا در ارتباط با سرور: ' + error.message)\r\n    }\r\n    loading.value = false\r\n  }\r\n  const restoreNews = async (id) => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'restore_news', data: { id: id } })\r\n      if (res.status === 'success') {\r\n        await loadNews()\r\n        return true\r\n      } else {\r\n        alert('خطا در پخش مجدد خبر: ' + res.message)\r\n        return false\r\n      }\r\n    } catch (error) {\r\n      alert('خطا در ارتباط با سرور: ' + error.message)\r\n      return false\r\n    }\r\n  }\r\n  const deleteNews = async (id) => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'delete_news', data: { id: id } })\r\n      if (res.status === 'success') {\r\n        newsList.value = newsList.value.filter(news => news.id !== id)\r\n        return true\r\n      } else {\r\n        alert('خطا در حذف خبر: ' + res.message)\r\n        return false\r\n      }\r\n    } catch (error) {\r\n      alert('خطا در ارتباط با سرور: ' + error.message)\r\n      return false\r\n    }\r\n  }\r\n  let pollingInterval = null\r\n  const startPolling = () => {\r\n    if (pollingInterval) return\r\n    loadNews()\r\n    pollingInterval = setInterval(() => {\r\n      loadNews()\r\n    }, 10000)\r\n  }\r\n  const stopPolling = () => {\r\n    if (pollingInterval) {\r\n      clearInterval(pollingInterval)\r\n      pollingInterval = null\r\n    }\r\n  }\r\n  return {\r\n    newsList,\r\n    loading,\r\n    loadNews,\r\n    deleteNews,\r\n    restoreNews,\r\n    startPolling,\r\n    stopPolling,\r\n  }\r\n})\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}