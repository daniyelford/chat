{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createBlock as _createBlock, unref as _unref, createVNode as _createVNode, vModelText as _vModelText, withDirectives as _withDirectives, withModifiers as _withModifiers, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"cartable-details\"\n};\nconst _hoisted_3 = {\n  class: \"news-section\"\n};\nconst _hoisted_4 = {\n  class: \"news-header\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"user-info over-news\"\n};\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = {\n  key: 1,\n  class: \"avatar\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  fill: \"#000000\",\n  \"enable-background\": \"new 0 0 24 24\",\n  viewBox: \"0 0 24 24\"\n};\nconst _hoisted_8 = {\n  class: \"user\"\n};\nconst _hoisted_9 = [\"href\"];\nconst _hoisted_10 = {\n  style: {\n    \"margin\": \"10px\"\n  }\n};\nconst _hoisted_11 = {\n  key: 1,\n  class: \"address\"\n};\nconst _hoisted_12 = {\n  class: \"report-section\"\n};\nconst _hoisted_13 = {\n  class: \"report-header\"\n};\nconst _hoisted_14 = {\n  key: 0,\n  class: \"user-info\"\n};\nconst _hoisted_15 = [\"src\"];\nconst _hoisted_16 = {\n  key: 1,\n  class: \"avatar\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  fill: \"#000000\",\n  \"enable-background\": \"new 0 0 24 24\",\n  viewBox: \"0 0 24 24\"\n};\nconst _hoisted_17 = {\n  class: \"user\"\n};\nconst _hoisted_18 = [\"href\"];\nconst _hoisted_19 = {\n  class: \"report-content\"\n};\nconst _hoisted_20 = {\n  class: \"times\"\n};\nconst _hoisted_21 = {\n  key: 1,\n  class: \"modal-overlay\"\n};\nconst _hoisted_22 = {\n  class: \"modal\"\n};\nconst _hoisted_23 = {\n  class: \"modal-actions\"\n};\nimport { ref, onMounted, onUnmounted, watch } from 'vue';\nimport { useCartableStore } from '@/stores/cartable';\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue';\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue';\nimport { sendApi } from '@/utils/api';\nimport moment from 'moment-jalaali';\nexport default {\n  __name: 'ShowCartable',\n  props: {\n    id: Number\n  },\n  setup(__props) {\n    const props = __props;\n    const store = useCartableStore();\n    const item = ref(null);\n    const isModalOpen = ref(false);\n    const description = ref('');\n    const mediaIds = ref([]);\n    const loadItem = async () => {\n      item.value = await store.getCartableById(props.id);\n      console.log(item.value);\n    };\n    const openModal = () => {\n      if (item.value) {\n        description.value = item.value.report?.description || '';\n        mediaIds.value = item.value.report?.media?.map(m => m.id) || [];\n        isModalOpen.value = true;\n      }\n    };\n    const handleUploadResult = uploaded => {\n      mediaIds.value = uploaded.map(m => m.id);\n    };\n    const submitForm = async () => {\n      const res = await sendApi({\n        control: 'news',\n        action: 'edit_report',\n        data: {\n          id: props.id,\n          description: description.value,\n          media_id: mediaIds.value\n        }\n      });\n      if (res.status === 'success') {\n        await store.fetchCartables();\n        await loadItem();\n        isModalOpen.value = false;\n      } else {\n        alert('خطا: ' + res.message);\n      }\n    };\n    onMounted(async () => {\n      if (!store.allItems.length) {\n        await store.fetchCartables();\n      }\n      await loadItem();\n      store.startPolling();\n    });\n    onUnmounted(() => store.stopPolling());\n    watch(() => props.id, async () => {\n      await loadItem();\n    });\n    return (_ctx, _cache) => {\n      return !item.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \"در حال بارگذاری یا موردی یافت نشد\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"section\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [item.value.has_rule ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [item.value.news_user_image_url ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: item.value.news_user_image_url,\n        class: \"avatar\",\n        alt: \"User\"\n      }, null, 8, _hoisted_6)) : (_openBlock(), _createElementBlock(\"svg\", _hoisted_7, _cache[3] || (_cache[3] = [_createElementVNode(\"g\", {\n        \"data-v-ab5c279c\": \"\"\n      }, [_createElementVNode(\"rect\", {\n        \"data-v-ab5c279c\": \"\",\n        fill: \"none\",\n        height: \"24\",\n        width: \"24\"\n      })], -1), _createElementVNode(\"g\", {\n        \"data-v-ab5c279c\": \"\"\n      }, [_createElementVNode(\"path\", {\n        \"data-v-ab5c279c\": \"\",\n        d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"\n      })], -1)]))), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"strong\", null, _toDisplayString(item.value.news_user_name) + \" \" + _toDisplayString(item.value.news_user_family), 1), item.value.news_user_phone ? (_openBlock(), _createElementBlock(\"a\", {\n        key: 0,\n        href: `tel:${item.value.news_user_phone}`\n      }, _cache[4] || (_cache[4] = [_createStaticVNode(\"<svg height=\\\"25\\\" width=\\\"25\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" viewBox=\\\"0,0,256,256\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590><g fill=\\\"none\\\" fill-rule=\\\"nonzero\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" stroke-linecap=\\\"butt\\\" stroke-linejoin=\\\"miter\\\" stroke-miterlimit=\\\"10\\\" stroke-dasharray=\\\"\\\" stroke-dashoffset=\\\"0\\\" font-family=\\\"none\\\" font-weight=\\\"none\\\" font-size=\\\"none\\\" text-anchor=\\\"none\\\" style=\\\"mix-blend-mode:normal;\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590><g transform=\\\"scale(4,4)\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590><path d=\\\"M1,32c0,-17.1 13.9,-31 31,-31c17.1,0 31,13.9 31,31c0,17.1 -13.9,31 -31,31c-17.1,0 -31,-13.9 -31,-31z\\\" fill=\\\"#3ec81c\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590></path><path d=\\\"M43.1,51.4c-0.7,0 -1.3,-0.1 -1.9,-0.4c-3.6,-1.6 -10.6,-5.1 -16.8,-11.3c-6.2,-6.2 -9.8,-13.3 -11.4,-16.9c-0.8,-1.8 -0.4,-3.9 1.1,-5.4l3.8,-3.8c0.5,-0.5 1.1,-0.9 1.8,-1c1,-0.2 2,0.2 2.7,0.9l4.9,4.9c1.3,1.3 1.3,3.4 0,4.8l-3.9,3.9c-0.4,0.4 -0.5,1 -0.3,1.5c0.7,1.5 2.3,4.6 5,7.3c2.7,2.7 5.8,4.3 7.3,5c0.5,0.2 1.1,0.1 1.5,-0.3l4,-4c0.5,-0.5 1,-0.8 1.7,-0.9c1,-0.2 2,0.1 2.8,0.9l5.1,5.1c1.2,1.2 1.2,3.2 0,4.4l-3.9,3.9c-0.9,0.9 -2.2,1.4 -3.5,1.4z\\\" fill=\\\"#54e6eb\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590></path></g></g></svg>\", 1)]), 8, _hoisted_9)) : _createCommentVNode(\"\", true)])])) : _createCommentVNode(\"\", true)]), item.value.news?.media?.length ? (_openBlock(), _createBlock(MediaSlider, {\n        key: 0,\n        medias: item.value.news.media\n      }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true), _createElementVNode(\"h3\", _hoisted_10, _toDisplayString(item.value.news.description), 1), item.value.news.address?.address ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, _toDisplayString(item.value.news.address.address), 1)) : _createCommentVNode(\"\", true)]), item.value.has_rule ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 0,\n        class: \"add\",\n        onClick: openModal\n      }, \"✏️\")) : _createCommentVNode(\"\", true), _cache[9] || (_cache[9] = _createElementVNode(\"h2\", null, \"پیوست\", -1)), _createElementVNode(\"section\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [!item.value.has_rule ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [item.value.user?.image ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: item.value.user.image,\n        class: \"avatar\"\n      }, null, 8, _hoisted_15)) : (_openBlock(), _createElementBlock(\"svg\", _hoisted_16, _cache[5] || (_cache[5] = [_createElementVNode(\"g\", {\n        \"data-v-ab5c279c\": \"\"\n      }, [_createElementVNode(\"rect\", {\n        \"data-v-ab5c279c\": \"\",\n        fill: \"none\",\n        height: \"24\",\n        width: \"24\"\n      })], -1), _createElementVNode(\"g\", {\n        \"data-v-ab5c279c\": \"\"\n      }, [_createElementVNode(\"path\", {\n        \"data-v-ab5c279c\": \"\",\n        d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"\n      })], -1)]))), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"strong\", null, _toDisplayString(item.value.user.name) + \" \" + _toDisplayString(item.value.user.family), 1), item.value.user?.phone ? (_openBlock(), _createElementBlock(\"a\", {\n        key: 0,\n        href: `tel:${item.value.user.phone}`\n      }, _cache[6] || (_cache[6] = [_createStaticVNode(\"<svg height=\\\"25\\\" width=\\\"25\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" viewBox=\\\"0,0,256,256\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590><g fill=\\\"none\\\" fill-rule=\\\"nonzero\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" stroke-linecap=\\\"butt\\\" stroke-linejoin=\\\"miter\\\" stroke-miterlimit=\\\"10\\\" stroke-dasharray=\\\"\\\" stroke-dashoffset=\\\"0\\\" font-family=\\\"none\\\" font-weight=\\\"none\\\" font-size=\\\"none\\\" text-anchor=\\\"none\\\" style=\\\"mix-blend-mode:normal;\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590><g transform=\\\"scale(4,4)\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590><path d=\\\"M1,32c0,-17.1 13.9,-31 31,-31c17.1,0 31,13.9 31,31c0,17.1 -13.9,31 -31,31c-17.1,0 -31,-13.9 -31,-31z\\\" fill=\\\"#3ec81c\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590></path><path d=\\\"M43.1,51.4c-0.7,0 -1.3,-0.1 -1.9,-0.4c-3.6,-1.6 -10.6,-5.1 -16.8,-11.3c-6.2,-6.2 -9.8,-13.3 -11.4,-16.9c-0.8,-1.8 -0.4,-3.9 1.1,-5.4l3.8,-3.8c0.5,-0.5 1.1,-0.9 1.8,-1c1,-0.2 2,0.2 2.7,0.9l4.9,4.9c1.3,1.3 1.3,3.4 0,4.8l-3.9,3.9c-0.4,0.4 -0.5,1 -0.3,1.5c0.7,1.5 2.3,4.6 5,7.3c2.7,2.7 5.8,4.3 7.3,5c0.5,0.2 1.1,0.1 1.5,-0.3l4,-4c0.5,-0.5 1,-0.8 1.7,-0.9c1,-0.2 2,0.1 2.8,0.9l5.1,5.1c1.2,1.2 1.2,3.2 0,4.4l-3.9,3.9c-0.9,0.9 -2.2,1.4 -3.5,1.4z\\\" fill=\\\"#54e6eb\\\" data-v-ac41ac96=\\\"\\\" data-v-4fea2590></path></g></g></svg>\", 1)]), 8, _hoisted_18)) : _createCommentVNode(\"\", true)])])) : _createCommentVNode(\"\", true)]), _createElementVNode(\"div\", _hoisted_19, [item.value.report?.media?.length ? (_openBlock(), _createBlock(MediaSlider, {\n        key: 0,\n        medias: item.value.report.media\n      }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true), _createElementVNode(\"h3\", null, _toDisplayString(item.value.report?.description || 'بدون پیوست'), 1), _createElementVNode(\"div\", _hoisted_20, [_createElementVNode(\"small\", null, \"ثبت: \" + _toDisplayString(_unref(moment)(item.value.report?.created_at).format('jYYYY/jMM/jDD')), 1), _createElementVNode(\"small\", null, \"اجرا: \" + _toDisplayString(_unref(moment)(item.value.report?.run_time).format('jYYYY/jMM/jDD')), 1)])])]), isModalOpen.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [_createElementVNode(\"div\", _hoisted_22, [_cache[8] || (_cache[8] = _createElementVNode(\"h3\", null, \"پیوست گزارش\", -1)), _createVNode(UploaderManyMedia, {\n        url: 'report_media/',\n        toAction: 'report',\n        modelValue: item.value.report.media,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => item.value.report.media = $event),\n        onDone: handleUploadResult\n      }, null, 8, [\"modelValue\"]), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"])\n      }, [_withDirectives(_createElementVNode(\"textarea\", {\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => description.value = $event),\n        rows: \"4\",\n        placeholder: \"توضیحات...\"\n      }, null, 512), [[_vModelText, description.value]]), _createElementVNode(\"div\", _hoisted_23, [_cache[7] || (_cache[7] = _createElementVNode(\"button\", {\n        type: \"submit\"\n      }, \"ثبت\", -1)), _createElementVNode(\"button\", {\n        onClick: _cache[2] || (_cache[2] = _withModifiers($event => isModalOpen.value = false, [\"prevent\"]))\n      }, \"بستن\")])], 32)])])) : _createCommentVNode(\"\", true)]));\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","useCartableStore","MediaSlider","UploaderManyMedia","sendApi","moment","props","__props","store","item","isModalOpen","description","mediaIds","loadItem","value","getCartableById","id","console","log","openModal","report","media","map","m","handleUploadResult","uploaded","submitForm","res","control","action","data","media_id","status","fetchCartables","alert","message","allItems","length","startPolling","stopPolling"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/ShowCartable.vue"],"sourcesContent":["<template>\r\n    <div v-if=\"!item\">در حال بارگذاری یا موردی یافت نشد</div>\r\n    <div v-else class=\"cartable-details\">\r\n        <section class=\"news-section\">\r\n            <div class=\"news-header\">\r\n                <div v-if=\"item.has_rule\" class=\"user-info over-news\">\r\n                    <img v-if=\"item.news_user_image_url\" :src=\"item.news_user_image_url\" class=\"avatar\" alt=\"User\" />\r\n                    <svg v-else class=\"avatar\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#000000\" enable-background=\"new 0 0 24 24\" viewBox=\"0 0 24 24\"><g data-v-ab5c279c=\"\"><rect data-v-ab5c279c=\"\" fill=\"none\" height=\"24\" width=\"24\"></rect></g><g data-v-ab5c279c=\"\"><path data-v-ab5c279c=\"\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"></path></g></svg>\r\n                    <div class=\"user\">\r\n                        <strong>{{ item.news_user_name }} {{ item.news_user_family }}</strong>\r\n                        <a v-if=\"item.news_user_phone\" :href=\"`tel:${item.news_user_phone}`\">\r\n                            <svg height=\"25\" width=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0,0,256,256\" data-v-ac41ac96=\"\"><g fill=\"none\" fill-rule=\"nonzero\" stroke=\"none\" stroke-width=\"1\" stroke-linecap=\"butt\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" stroke-dasharray=\"\" stroke-dashoffset=\"0\" font-family=\"none\" font-weight=\"none\" font-size=\"none\" text-anchor=\"none\" style=\"mix-blend-mode:normal;\" data-v-ac41ac96=\"\"><g transform=\"scale(4,4)\" data-v-ac41ac96=\"\"><path d=\"M1,32c0,-17.1 13.9,-31 31,-31c17.1,0 31,13.9 31,31c0,17.1 -13.9,31 -31,31c-17.1,0 -31,-13.9 -31,-31z\" fill=\"#3ec81c\" data-v-ac41ac96=\"\"></path><path d=\"M43.1,51.4c-0.7,0 -1.3,-0.1 -1.9,-0.4c-3.6,-1.6 -10.6,-5.1 -16.8,-11.3c-6.2,-6.2 -9.8,-13.3 -11.4,-16.9c-0.8,-1.8 -0.4,-3.9 1.1,-5.4l3.8,-3.8c0.5,-0.5 1.1,-0.9 1.8,-1c1,-0.2 2,0.2 2.7,0.9l4.9,4.9c1.3,1.3 1.3,3.4 0,4.8l-3.9,3.9c-0.4,0.4 -0.5,1 -0.3,1.5c0.7,1.5 2.3,4.6 5,7.3c2.7,2.7 5.8,4.3 7.3,5c0.5,0.2 1.1,0.1 1.5,-0.3l4,-4c0.5,-0.5 1,-0.8 1.7,-0.9c1,-0.2 2,0.1 2.8,0.9l5.1,5.1c1.2,1.2 1.2,3.2 0,4.4l-3.9,3.9c-0.9,0.9 -2.2,1.4 -3.5,1.4z\" fill=\"#54e6eb\" data-v-ac41ac96=\"\"></path></g></g></svg>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <MediaSlider v-if=\"item.news?.media?.length\" :medias=\"item.news.media\" />\r\n            <h3 style=\"margin: 10px;\">{{ item.news.description }}</h3>\r\n            <div class=\"address\" v-if=\"item.news.address?.address\">\r\n                {{ item.news.address.address }}\r\n            </div>\r\n        </section>\r\n        <button class=\"add\" v-if=\"item.has_rule\" @click=\"openModal\">✏️</button>\r\n        <h2>پیوست</h2>\r\n        <section class=\"report-section\">\r\n            <div class=\"report-header\">\r\n                <div v-if=\"!item.has_rule\" class=\"user-info\">\r\n                    <img v-if=\"item.user?.image\" :src=\"item.user.image\" class=\"avatar\" />\r\n                    <svg v-else class=\"avatar\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#000000\" enable-background=\"new 0 0 24 24\" viewBox=\"0 0 24 24\"><g data-v-ab5c279c=\"\"><rect data-v-ab5c279c=\"\" fill=\"none\" height=\"24\" width=\"24\"></rect></g><g data-v-ab5c279c=\"\"><path data-v-ab5c279c=\"\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z\"></path></g></svg>\r\n                    <div class=\"user\">\r\n                        <strong>{{ item.user.name }} {{ item.user.family }}</strong>\r\n                        <a v-if=\"item.user?.phone\" :href=\"`tel:${item.user.phone}`\">\r\n                            <svg height=\"25\" width=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0,0,256,256\" data-v-ac41ac96=\"\"><g fill=\"none\" fill-rule=\"nonzero\" stroke=\"none\" stroke-width=\"1\" stroke-linecap=\"butt\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" stroke-dasharray=\"\" stroke-dashoffset=\"0\" font-family=\"none\" font-weight=\"none\" font-size=\"none\" text-anchor=\"none\" style=\"mix-blend-mode:normal;\" data-v-ac41ac96=\"\"><g transform=\"scale(4,4)\" data-v-ac41ac96=\"\"><path d=\"M1,32c0,-17.1 13.9,-31 31,-31c17.1,0 31,13.9 31,31c0,17.1 -13.9,31 -31,31c-17.1,0 -31,-13.9 -31,-31z\" fill=\"#3ec81c\" data-v-ac41ac96=\"\"></path><path d=\"M43.1,51.4c-0.7,0 -1.3,-0.1 -1.9,-0.4c-3.6,-1.6 -10.6,-5.1 -16.8,-11.3c-6.2,-6.2 -9.8,-13.3 -11.4,-16.9c-0.8,-1.8 -0.4,-3.9 1.1,-5.4l3.8,-3.8c0.5,-0.5 1.1,-0.9 1.8,-1c1,-0.2 2,0.2 2.7,0.9l4.9,4.9c1.3,1.3 1.3,3.4 0,4.8l-3.9,3.9c-0.4,0.4 -0.5,1 -0.3,1.5c0.7,1.5 2.3,4.6 5,7.3c2.7,2.7 5.8,4.3 7.3,5c0.5,0.2 1.1,0.1 1.5,-0.3l4,-4c0.5,-0.5 1,-0.8 1.7,-0.9c1,-0.2 2,0.1 2.8,0.9l5.1,5.1c1.2,1.2 1.2,3.2 0,4.4l-3.9,3.9c-0.9,0.9 -2.2,1.4 -3.5,1.4z\" fill=\"#54e6eb\" data-v-ac41ac96=\"\"></path></g></g></svg>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"report-content\">\r\n                <MediaSlider v-if=\"item.report?.media?.length\" :medias=\"item.report.media\" />\r\n                <h3>{{ item.report?.description || 'بدون پیوست' }}</h3>\r\n                <div class=\"times\">\r\n                    <small>ثبت: {{ moment(item.report?.created_at).format('jYYYY/jMM/jDD') }}</small>\r\n                    <small>اجرا: {{ moment(item.report?.run_time).format('jYYYY/jMM/jDD') }}</small>\r\n                </div>\r\n            </div>\r\n        </section>\r\n        <div v-if=\"isModalOpen\" class=\"modal-overlay\">\r\n            <div class=\"modal\">\r\n                <h3>پیوست گزارش</h3>\r\n                <UploaderManyMedia \r\n                :url=\"'report_media/'\"\r\n                :toAction=\"'report'\"\r\n                v-model=\"item.report.media\"\r\n                @done=\"handleUploadResult\" \r\n                />\r\n                <form @submit.prevent=\"submitForm\">\r\n                    <textarea v-model=\"description\" rows=\"4\" placeholder=\"توضیحات...\" />\r\n                    <div class=\"modal-actions\">\r\n                        <button type=\"submit\">ثبت</button>\r\n                        <button @click.prevent=\"isModalOpen = false\">بستن</button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted, defineProps, watch } from 'vue'\r\nimport { useCartableStore } from '@/stores/cartable'\r\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue'\r\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue'\r\nimport { sendApi } from '@/utils/api'\r\nimport moment from 'moment-jalaali'\r\n\r\nconst props = defineProps({ id: Number })\r\nconst store = useCartableStore()\r\n\r\nconst item = ref(null)\r\nconst isModalOpen = ref(false)\r\nconst description = ref('')\r\nconst mediaIds = ref([])\r\n\r\nconst loadItem = async () => {\r\n  item.value = await store.getCartableById(props.id)\r\n  console.log(item.value);\r\n  \r\n}\r\n\r\nconst openModal = () => {\r\n  if (item.value) {\r\n    description.value = item.value.report?.description || ''\r\n    mediaIds.value = item.value.report?.media?.map(m => m.id) || []\r\n    isModalOpen.value = true\r\n  }\r\n}\r\n\r\nconst handleUploadResult = (uploaded) => {\r\n  mediaIds.value = uploaded.map(m => m.id)\r\n}\r\n\r\nconst submitForm = async () => {\r\n  const res = await sendApi({\r\n    control: 'news',\r\n    action: 'edit_report',\r\n    data: {\r\n      id: props.id,\r\n      description: description.value,\r\n      media_id: mediaIds.value,\r\n    }\r\n  })\r\n  if (res.status === 'success') {\r\n    await store.fetchCartables()\r\n    await loadItem()\r\n    isModalOpen.value = false\r\n  } else {\r\n    alert('خطا: ' + res.message)\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  if (!store.allItems.length) {\r\n    await store.fetchCartables()\r\n  }\r\n  await loadItem()\r\n  store.startPolling()\r\n})\r\n\r\nonUnmounted(() => store.stopPolling())\r\n\r\nwatch(() => props.id, async () => {\r\n  await loadItem()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n    .add{\r\n        float: left;\r\n        border: none;\r\n        outline: none;\r\n        padding: 10px;\r\n        background: #9cf0a4;\r\n        border-radius: 5px;\r\n    }\r\n    .address{\r\n        margin: 0 10px 20px 10px;\r\n        word-break: break-all;\r\n    }\r\n    .user,.times{\r\n        display: flex;\r\n        flex-wrap: nowrap;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n    }\r\n    .times{\r\n        flex-direction: row;\r\n    }\r\n    .user{\r\n        width: 100%;\r\n    }\r\n    .cartable-details {\r\n        padding: 1rem;\r\n        direction: rtl;\r\n    }\r\n    .news-section, .report-section {\r\n        margin-bottom: 2rem;\r\n        border: 1px solid #eee;\r\n        border-radius: 10px;\r\n        overflow: hidden;\r\n    }\r\n    .news-header,.report-header {\r\n        background: rgb(255, 242, 218);\r\n        padding: 10px;\r\n        margin-bottom: 0.7rem;\r\n    }\r\n    .report-content {\r\n        padding: 0 10px 15px;\r\n    }\r\n    .user-info {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n    }\r\n    .avatar {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 50%;\r\n    }\r\n    .modal-overlay {\r\n        position: fixed;\r\n        top: 0; left: 0; right: 0; bottom: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n    }\r\n    .modal {\r\n        background: white;\r\n        padding: 1.5rem;\r\n        border-radius: 10px;\r\n        width: 90%;\r\n        max-width: 500px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n    }\r\n    .modal-actions {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        margin-top: 1rem;\r\n    }\r\n    .modal-actions button {\r\n        width: 100%;\r\n        font-size: 16px;\r\n        padding: 7px;\r\n        margin: 0 5px;\r\n        border-radius: 5px;\r\n        outline: none;\r\n        border: none;\r\n        color: white;\r\n        background-color: rgb(117, 4, 4);\r\n    }\r\n    .modal-actions button:first-child{\r\n        background-color: rgb(4, 88, 4);\r\n    }\r\n    textarea {\r\n        width: 100%;\r\n        margin-top: 1rem;\r\n        outline: none;\r\n        padding: 10px;\r\n        border-radius: 10px;\r\n        box-sizing: border-box;\r\n    }\r\n</style>"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAwB,EAAEC,KAAK,QAAQ,KAAK;AACrE,SAASC,gBAAgB,QAAQ,mBAAmB;AACpD,OAAOC,WAAW,MAAM,2CAA2C;AACnE,OAAOC,iBAAiB,MAAM,kDAAkD;AAChF,SAASC,OAAO,QAAQ,aAAa;AACrC,OAAOC,MAAM,MAAM,gBAAgB;;;;;;;IAEnC,MAAMC,KAAK,GAAGC,OAA2B;IACzC,MAAMC,KAAK,GAAGP,gBAAgB,CAAC,CAAC;IAEhC,MAAMQ,IAAI,GAAGZ,GAAG,CAAC,IAAI,CAAC;IACtB,MAAMa,WAAW,GAAGb,GAAG,CAAC,KAAK,CAAC;IAC9B,MAAMc,WAAW,GAAGd,GAAG,CAAC,EAAE,CAAC;IAC3B,MAAMe,QAAQ,GAAGf,GAAG,CAAC,EAAE,CAAC;IAExB,MAAMgB,QAAQ,GAAG,MAAAA,CAAA,KAAY;MAC3BJ,IAAI,CAACK,KAAK,GAAG,MAAMN,KAAK,CAACO,eAAe,CAACT,KAAK,CAACU,EAAE,CAAC;MAClDC,OAAO,CAACC,GAAG,CAACT,IAAI,CAACK,KAAK,CAAC;IAEzB,CAAC;IAED,MAAMK,SAAS,GAAGA,CAAA,KAAM;MACtB,IAAIV,IAAI,CAACK,KAAK,EAAE;QACdH,WAAW,CAACG,KAAK,GAAGL,IAAI,CAACK,KAAK,CAACM,MAAM,EAAET,WAAW,IAAI,EAAE;QACxDC,QAAQ,CAACE,KAAK,GAAGL,IAAI,CAACK,KAAK,CAACM,MAAM,EAAEC,KAAK,EAAEC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACP,EAAE,CAAC,IAAI,EAAE;QAC/DN,WAAW,CAACI,KAAK,GAAG,IAAI;MAC1B;IACF,CAAC;IAED,MAAMU,kBAAkB,GAAIC,QAAQ,IAAK;MACvCb,QAAQ,CAACE,KAAK,GAAGW,QAAQ,CAACH,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACP,EAAE,CAAC;IAC1C,CAAC;IAED,MAAMU,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC7B,MAAMC,GAAG,GAAG,MAAMvB,OAAO,CAAC;QACxBwB,OAAO,EAAE,MAAM;QACfC,MAAM,EAAE,aAAa;QACrBC,IAAI,EAAE;UACJd,EAAE,EAAEV,KAAK,CAACU,EAAE;UACZL,WAAW,EAAEA,WAAW,CAACG,KAAK;UAC9BiB,QAAQ,EAAEnB,QAAQ,CAACE;QACrB;MACF,CAAC,CAAC;MACF,IAAIa,GAAG,CAACK,MAAM,KAAK,SAAS,EAAE;QAC5B,MAAMxB,KAAK,CAACyB,cAAc,CAAC,CAAC;QAC5B,MAAMpB,QAAQ,CAAC,CAAC;QAChBH,WAAW,CAACI,KAAK,GAAG,KAAK;MAC3B,CAAC,MAAM;QACLoB,KAAK,CAAC,OAAO,GAAGP,GAAG,CAACQ,OAAO,CAAC;MAC9B;IACF,CAAC;IAEDrC,SAAS,CAAC,YAAY;MACpB,IAAI,CAACU,KAAK,CAAC4B,QAAQ,CAACC,MAAM,EAAE;QAC1B,MAAM7B,KAAK,CAACyB,cAAc,CAAC,CAAC;MAC9B;MACA,MAAMpB,QAAQ,CAAC,CAAC;MAChBL,KAAK,CAAC8B,YAAY,CAAC,CAAC;IACtB,CAAC,CAAC;IAEFvC,WAAW,CAAC,MAAMS,KAAK,CAAC+B,WAAW,CAAC,CAAC,CAAC;IAEtCvC,KAAK,CAAC,MAAMM,KAAK,CAACU,EAAE,EAAE,YAAY;MAChC,MAAMH,QAAQ,CAAC,CAAC;IAClB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}