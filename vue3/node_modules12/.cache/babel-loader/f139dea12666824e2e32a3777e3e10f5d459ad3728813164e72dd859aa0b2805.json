{"ast":null,"code":"import { createElementVNode as _createElementVNode, unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"loading\"\n};\nimport { ref, computed } from 'vue';\nimport { useWalletStore } from '@/stores/wallet';\nconst perPage = 10;\nexport default {\n  __name: 'TransactionsSection',\n  setup(__props) {\n    const store = useWalletStore();\n    const listRef = ref(null);\n    const currentPage = ref(1);\n    const loadingMore = ref(false);\n    const endReached = ref(false);\n    const paginatedTransactions = computed(() => store.transactions.slice(0, currentPage.value * perPage));\n    const fetchMore = async () => {\n      if (loadingMore.value || endReached.value) return;\n      loadingMore.value = true;\n      const previousLength = store.transactions.length;\n      await store.fetchTransactions({\n        limit: (currentPage.value + 1) * perPage\n      });\n      if (store.transactions.length === previousLength) {\n        endReached.value = true;\n      } else {\n        currentPage.value++;\n      }\n      loadingMore.value = false;\n    };\n    const handleScroll = () => {\n      const el = listRef.value;\n      if (!el) return;\n      const scrollBottom = el.scrollTop + el.clientHeight;\n      const threshold = el.scrollHeight - 100;\n      if (scrollBottom >= threshold) {\n        fetchMore();\n      }\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        class: \"transaction-list\",\n        ref_key: \"listRef\",\n        ref: listRef,\n        onScrollPassive: handleScroll\n      }, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"لیست تراکنش‌ها\", -1)), _unref(store).transactions.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \"تراکنشی وجود ندارد.\")) : _createCommentVNode(\"\", true), _createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(paginatedTransactions.value, tx => {\n        return _openBlock(), _createElementBlock(\"li\", {\n          key: tx.id,\n          class: \"transaction-item\"\n        }, [_createElementVNode(\"p\", null, [_cache[0] || (_cache[0] = _createElementVNode(\"strong\", null, \"مبلغ:\", -1)), _createTextVNode(\" \" + _toDisplayString(_ctx.formatAmount(tx.amount)), 1)]), _createElementVNode(\"p\", null, [_cache[1] || (_cache[1] = _createElementVNode(\"strong\", null, \"پرداخت‌کننده:\", -1)), _createTextVNode(\" \" + _toDisplayString(tx.pay_user.name) + \" \" + _toDisplayString(tx.pay_user.family), 1)]), _createElementVNode(\"p\", null, [_cache[2] || (_cache[2] = _createElementVNode(\"strong\", null, \"گیرنده:\", -1)), _createTextVNode(\" \" + _toDisplayString(tx.give_user.name) + \" \" + _toDisplayString(tx.give_user.family), 1)]), _createElementVNode(\"p\", null, [_cache[3] || (_cache[3] = _createElementVNode(\"strong\", null, \"تاریخ:\", -1)), _createTextVNode(\" \" + _toDisplayString(_ctx.formatDate(tx.created_at)), 1)])]);\n      }), 128))]), loadingMore.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"در حال دریافت بیشتر...\")) : _createCommentVNode(\"\", true)], 544);\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","useWalletStore","perPage","store","listRef","currentPage","loadingMore","endReached","paginatedTransactions","transactions","slice","value","fetchMore","previousLength","length","fetchTransactions","limit","handleScroll","el","scrollBottom","scrollTop","clientHeight","threshold","scrollHeight"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/wallet/TransactionsSection.vue"],"sourcesContent":["<template>\r\n  <div class=\"transaction-list\" ref=\"listRef\" @scroll.passive=\"handleScroll\">\r\n    <h3>لیست تراکنش‌ها</h3>\r\n\r\n    <div v-if=\"store.transactions.length === 0\">تراکنشی وجود ندارد.</div>\r\n\r\n    <ul>\r\n      <li v-for=\"tx in paginatedTransactions\" :key=\"tx.id\" class=\"transaction-item\">\r\n        <p><strong>مبلغ:</strong> {{ formatAmount(tx.amount) }}</p>\r\n        <p><strong>پرداخت‌کننده:</strong> {{ tx.pay_user.name }} {{ tx.pay_user.family }}</p>\r\n        <p><strong>گیرنده:</strong> {{ tx.give_user.name }} {{ tx.give_user.family }}</p>\r\n        <p><strong>تاریخ:</strong> {{ formatDate(tx.created_at) }}</p>\r\n      </li>\r\n    </ul>\r\n\r\n    <div v-if=\"loadingMore\" class=\"loading\">در حال دریافت بیشتر...</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { ref, computed } from 'vue'\r\n  import { useWalletStore } from '@/stores/wallet'\r\n  const store = useWalletStore()\r\n  const listRef = ref(null)\r\n  const currentPage = ref(1)\r\n  const perPage = 10\r\n  const loadingMore = ref(false)\r\n  const endReached = ref(false)\r\n  const paginatedTransactions = computed(() =>\r\n    store.transactions.slice(0, currentPage.value * perPage)\r\n  )\r\n  const fetchMore = async () => {\r\n    if (loadingMore.value || endReached.value) return\r\n    loadingMore.value = true\r\n    const previousLength = store.transactions.length\r\n    await store.fetchTransactions({ limit: (currentPage.value + 1) * perPage })\r\n    if (store.transactions.length === previousLength) {\r\n      endReached.value = true\r\n    } else {\r\n      currentPage.value++\r\n    }\r\n\r\n    loadingMore.value = false\r\n  }\r\n  const handleScroll = () => {\r\n    const el = listRef.value\r\n    if (!el) return\r\n    const scrollBottom = el.scrollTop + el.clientHeight\r\n    const threshold = el.scrollHeight - 100\r\n    if (scrollBottom >= threshold) {\r\n      fetchMore()\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n.transaction-list {\r\n  padding: 1rem;\r\n}\r\n.transaction-item {\r\n  border: 1px solid #ddd;\r\n  padding: 0.75rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n</style>\r\n"],"mappings":";;;;;;;;AAoBE,SAASA,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AACnC,SAASC,cAAc,QAAQ,iBAAiB;AAIhD,MAAMC,OAAO,GAAG,EAAE;;;;IAHlB,MAAMC,KAAK,GAAGF,cAAc,CAAC,CAAC;IAC9B,MAAMG,OAAO,GAAGL,GAAG,CAAC,IAAI,CAAC;IACzB,MAAMM,WAAW,GAAGN,GAAG,CAAC,CAAC,CAAC;IAE1B,MAAMO,WAAW,GAAGP,GAAG,CAAC,KAAK,CAAC;IAC9B,MAAMQ,UAAU,GAAGR,GAAG,CAAC,KAAK,CAAC;IAC7B,MAAMS,qBAAqB,GAAGR,QAAQ,CAAC,MACrCG,KAAK,CAACM,YAAY,CAACC,KAAK,CAAC,CAAC,EAAEL,WAAW,CAACM,KAAK,GAAGT,OAAO,CACzD,CAAC;IACD,MAAMU,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,IAAIN,WAAW,CAACK,KAAK,IAAIJ,UAAU,CAACI,KAAK,EAAE;MAC3CL,WAAW,CAACK,KAAK,GAAG,IAAI;MACxB,MAAME,cAAc,GAAGV,KAAK,CAACM,YAAY,CAACK,MAAM;MAChD,MAAMX,KAAK,CAACY,iBAAiB,CAAC;QAAEC,KAAK,EAAE,CAACX,WAAW,CAACM,KAAK,GAAG,CAAC,IAAIT;MAAQ,CAAC,CAAC;MAC3E,IAAIC,KAAK,CAACM,YAAY,CAACK,MAAM,KAAKD,cAAc,EAAE;QAChDN,UAAU,CAACI,KAAK,GAAG,IAAI;MACzB,CAAC,MAAM;QACLN,WAAW,CAACM,KAAK,EAAE;MACrB;MAEAL,WAAW,CAACK,KAAK,GAAG,KAAK;IAC3B,CAAC;IACD,MAAMM,YAAY,GAAGA,CAAA,KAAM;MACzB,MAAMC,EAAE,GAAGd,OAAO,CAACO,KAAK;MACxB,IAAI,CAACO,EAAE,EAAE;MACT,MAAMC,YAAY,GAAGD,EAAE,CAACE,SAAS,GAAGF,EAAE,CAACG,YAAY;MACnD,MAAMC,SAAS,GAAGJ,EAAE,CAACK,YAAY,GAAG,GAAG;MACvC,IAAIJ,YAAY,IAAIG,SAAS,EAAE;QAC7BV,SAAS,CAAC,CAAC;MACb;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}