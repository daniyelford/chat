{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createElementVNode as _createElementVNode, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"section\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nimport { ref, watch, computed } from 'vue';\nimport RadioGroup from '@/components/tooles/news/address/RadioGroup.vue';\nimport MapPicker from '@/components/tooles/news/address/MapPicker.vue';\nimport { fullAddress } from '@/utils/geo';\nexport default {\n  __name: 'AddressSelector ',\n  props: {\n    loginCity: String,\n    modelValue: Object,\n    userCoordinate: {\n      type: Object,\n      default: () => ({\n        lat: '',\n        lon: ''\n      })\n    }\n  },\n  emits: ['update', 'loading'],\n  setup(__props, {\n    emit: __emit\n  }) {\n    const emit = __emit;\n    const userLocation = ref(null);\n    const props = __props;\n    watch(() => props.userCoordinate, val => {\n      if (val && val.lat && val.lon) {\n        userLocation.value.lat = val.lat;\n        userLocation.value.lon = val.lon;\n      }\n    }, {\n      immediate: true\n    });\n    const addressModes = computed(() => {\n      const modes = [];\n      if (props.loginCity) {\n        modes.push({\n          id: 'city',\n          label: `شهر فعلی ${props.loginCity}`\n        });\n      }\n      modes.push({\n        id: 'location',\n        label: 'انتخاب از نقشه'\n      });\n      return modes;\n    });\n    const selectedMode = ref(props.loginCity ? props.modelValue?.type || 'city' : 'location');\n    const location = ref(props.modelValue?.value || {\n      lat: '',\n      lng: '',\n      address: ''\n    });\n    const loading = ref(false);\n    const handleMapSelect = async ({\n      lat,\n      lng\n    }) => {\n      location.value.lat = lat;\n      location.value.lng = lng;\n      loading.value = true;\n      try {\n        const result = await fullAddress(lat, lng);\n        location.value.total = result || '';\n        location.value.address = result.display_name || '';\n        emit('update', {\n          type: 'location',\n          value: location.value\n        });\n      } catch (e) {\n        location.value.address = 'خطا در دریافت آدرس';\n      } finally {\n        loading.value = false;\n      }\n    };\n    watch([selectedMode, location], () => {\n      let value = null;\n      if (selectedMode.value === 'city') {\n        value = {\n          type: 'city',\n          value: props.loginCity\n        };\n      } else if (selectedMode.value === 'location') {\n        value = {\n          type: 'location',\n          value: location.value\n        };\n      }\n      emit('update', value);\n    });\n    watch(loading, () => {\n      emit('loading', loading.value);\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", null, [_cache[3] || (_cache[3] = _createElementVNode(\"label\", {\n        class: \"address-label\"\n      }, \"انتخاب آدرس\", -1)), _createVNode(RadioGroup, {\n        modelValue: selectedMode.value,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => selectedMode.value = $event),\n        options: addressModes.value,\n        name: \"address-mode\"\n      }, null, 8, [\"modelValue\", \"options\"]), selectedMode.value === 'location' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[2] || (_cache[2] = _createElementVNode(\"label\", {\n        class: \"text\"\n      }, \"موقعیت مکانی\", -1)), _createVNode(MapPicker, {\n        center: userLocation.value,\n        onPick: handleMapSelect\n      }, null, 8, [\"center\"]), loading.value ? (_openBlock(), _createElementBlock(\"span\", _hoisted_2, \"در حال دریافت آدرس از نقشه...\")) : _createCommentVNode(\"\", true), !loading.value ? _withDirectives((_openBlock(), _createElementBlock(\"textarea\", {\n        key: 1,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => location.value.address = $event),\n        rows: \"3\",\n        class: \"textarea\",\n        placeholder: \"آدرس انتخاب ‌شده را کامل کنید...\"\n      }, \"      \", 512)), [[_vModelText, location.value.address]]) : _createCommentVNode(\"\", true)])) : _createCommentVNode(\"\", true)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","watch","computed","RadioGroup","MapPicker","fullAddress","emit","__emit","userLocation","props","__props","userCoordinate","val","lat","lon","value","immediate","addressModes","modes","loginCity","push","id","label","selectedMode","modelValue","type","location","lng","address","loading","handleMapSelect","result","total","display_name","e"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/tooles/news/AddressSelector .vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <label class=\"address-label\">انتخاب آدرس</label>\r\n    <RadioGroup\r\n      v-model=\"selectedMode\"\r\n      :options=\"addressModes\"\r\n      name=\"address-mode\"\r\n    />\r\n    <div class=\"section\" v-if=\"selectedMode === 'location'\">\r\n      <label class=\"text\">موقعیت مکانی</label>\r\n      <MapPicker :center=\"userLocation\" @pick=\"handleMapSelect\" />\r\n      <span class=\"loading\" v-if=\"loading\">در حال دریافت آدرس از نقشه...</span>\r\n      <textarea\r\n        v-if=\"!loading\"\r\n        v-model=\"location.address\"\r\n        rows=\"3\"\r\n        class=\"textarea\"\r\n        placeholder=\"آدرس انتخاب ‌شده را کامل کنید...\">\r\n      </textarea>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\n  import { ref, watch, defineEmits, defineProps, computed } from 'vue'\r\n  import RadioGroup from '@/components/tooles/news/address/RadioGroup.vue'\r\n  import MapPicker from '@/components/tooles/news/address/MapPicker.vue'\r\n  import { fullAddress } from '@/utils/geo'\r\n  const emit = defineEmits(['update','loading'])\r\n  const userLocation=ref(null)\r\n  const props = defineProps({\r\n    loginCity: String,\r\n    modelValue: Object,\r\n    userCoordinate: {\r\n      type: Object,\r\n      default: () => ({ lat: '', lon: '' })\r\n    }\r\n  })\r\n  watch(() => props.userCoordinate, (val) => {\r\n    if (val && val.lat && val.lon) {\r\n      userLocation.value.lat=val.lat\r\n      userLocation.value.lon=val.lon\r\n    }\r\n  }, { immediate: true })\r\n  const addressModes = computed(() => {\r\n    const modes = []\r\n    if (props.loginCity) {\r\n      modes.push({ id: 'city', label: `شهر فعلی ${props.loginCity}` })\r\n    }\r\n    modes.push({ id: 'location', label: 'انتخاب از نقشه' })\r\n    return modes\r\n  })\r\n  const selectedMode = ref(\r\n    props.loginCity\r\n      ? props.modelValue?.type || 'city'\r\n      : 'location'\r\n  )\r\n  const location = ref(props.modelValue?.value || { lat: '', lng: '', address: '' })\r\n  const loading = ref(false)\r\n  const handleMapSelect = async ({ lat, lng }) => {\r\n    location.value.lat = lat\r\n    location.value.lng = lng\r\n    loading.value = true\r\n    try {\r\n      const result = await fullAddress(lat, lng)\r\n      location.value.total = result || ''\r\n      location.value.address = result.display_name || ''\r\n      emit('update', { type: 'location', value: location.value })\r\n    } catch (e) {\r\n      location.value.address = 'خطا در دریافت آدرس'\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n  watch([selectedMode, location], () => {\r\n    let value = null\r\n    if (selectedMode.value === 'city') {\r\n      value = { type: 'city', value: props.loginCity }\r\n    } else if (selectedMode.value === 'location') {\r\n      value = { type: 'location', value: location.value }\r\n    }\r\n    emit('update', value)\r\n  })\r\n  watch(loading, () => {\r\n    emit('loading', loading.value)\r\n  })\r\n</script>\r\n\r\n<style scoped>\r\n  .loading{\r\n    position: relative;\r\n    top: -275px;\r\n    right: 10px;\r\n    color: #ff005c;\r\n  }\r\n  .address-label {\r\n    font-weight: bold;\r\n    margin-bottom: 0.75rem;\r\n    display: block;\r\n  }\r\n  .section {\r\n    margin-top: 1rem;\r\n  }\r\n  .text {\r\n    font-size: 0.875rem;\r\n    margin-bottom: 0.25rem;\r\n    display: block;\r\n  }\r\n  .textarea {\r\n    border: 1px solid #ccc;\r\n    border-radius: 5px;\r\n    padding: 0.5rem;\r\n    width: 34%;\r\n    height: 300px;\r\n    resize: vertical;\r\n    display: inline-block;\r\n    margin-top: 0.75rem;\r\n    margin-right: 1%;\r\n    box-sizing: border-box;\r\n  }\r\n  @media screen and (max-width: 600px) {\r\n    .loading{\r\n      position: unset;\r\n      padding: 10px;\r\n    }\r\n    .textarea {\r\n      width: 100%;\r\n      height: 80px;\r\n      margin-right: 0;\r\n    }\r\n  }\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}