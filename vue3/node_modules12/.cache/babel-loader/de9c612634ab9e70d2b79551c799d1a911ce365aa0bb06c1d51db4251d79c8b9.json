{"ast":null,"code":"import { BASE_URL, API_SECRET_KEY } from '@/config';\nlet tokenCache = null;\nlet tokenExpireAt = 0;\nlet tokenPromise = null;\nexport async function getToken() {\n  const now = Date.now();\n  if (tokenCache && now < tokenExpireAt) {\n    return tokenCache;\n  }\n  if (tokenPromise) {\n    return tokenPromise;\n  }\n  tokenPromise = fetch(`${BASE_URL}/create_token`, {\n    method: 'GET',\n    credentials: 'include',\n    headers: {\n      'X-API-KEY': API_SECRET_KEY\n    }\n  }).then(res => res.json()).then(tokenJson => {\n    if (tokenJson.status === 'error') {\n      throw new Error('Unauthorized');\n    }\n    tokenCache = tokenJson;\n    tokenExpireAt = Date.now() + 110 * 1000;\n    return tokenJson;\n  }).catch(err => {\n    tokenCache = null;\n    tokenExpireAt = 0;\n    throw err;\n  }).finally(() => {\n    tokenPromise = null;\n  });\n  return tokenPromise;\n}","map":{"version":3,"names":["BASE_URL","API_SECRET_KEY","tokenCache","tokenExpireAt","tokenPromise","getToken","now","Date","fetch","method","credentials","headers","then","res","json","tokenJson","status","Error","catch","err","finally"],"sources":["D:/GitHub/ci3-vue3/vue3/src/utils/token.js"],"sourcesContent":["import { BASE_URL, API_SECRET_KEY } from '@/config'\r\nlet tokenCache = null\r\nlet tokenExpireAt = 0\r\nlet tokenPromise = null\r\nexport async function getToken() {\r\n  const now = Date.now()\r\n  if (tokenCache && now < tokenExpireAt) {\r\n    return tokenCache\r\n  }\r\n  if (tokenPromise) {\r\n    return tokenPromise\r\n  }\r\n  tokenPromise = fetch(`${BASE_URL}/create_token`, {\r\n    method: 'GET',\r\n    credentials: 'include',\r\n    headers: {\r\n      'X-API-KEY': API_SECRET_KEY\r\n    }\r\n  })\r\n    .then(res => res.json())\r\n    .then(tokenJson => {\r\n      if (tokenJson.status === 'error') {\r\n        throw new Error('Unauthorized')\r\n      }\r\n      tokenCache = tokenJson\r\n      tokenExpireAt = Date.now() + 110 * 1000\r\n      return tokenJson\r\n    })\r\n    .catch(err => {\r\n      tokenCache = null\r\n      tokenExpireAt = 0\r\n      throw err\r\n    })\r\n    .finally(() => {\r\n      tokenPromise = null\r\n    })\r\n  return tokenPromise\r\n}"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,cAAc,QAAQ,UAAU;AACnD,IAAIC,UAAU,GAAG,IAAI;AACrB,IAAIC,aAAa,GAAG,CAAC;AACrB,IAAIC,YAAY,GAAG,IAAI;AACvB,OAAO,eAAeC,QAAQA,CAAA,EAAG;EAC/B,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;EACtB,IAAIJ,UAAU,IAAII,GAAG,GAAGH,aAAa,EAAE;IACrC,OAAOD,UAAU;EACnB;EACA,IAAIE,YAAY,EAAE;IAChB,OAAOA,YAAY;EACrB;EACAA,YAAY,GAAGI,KAAK,CAAC,GAAGR,QAAQ,eAAe,EAAE;IAC/CS,MAAM,EAAE,KAAK;IACbC,WAAW,EAAE,SAAS;IACtBC,OAAO,EAAE;MACP,WAAW,EAAEV;IACf;EACF,CAAC,CAAC,CACCW,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CACvBF,IAAI,CAACG,SAAS,IAAI;IACjB,IAAIA,SAAS,CAACC,MAAM,KAAK,OAAO,EAAE;MAChC,MAAM,IAAIC,KAAK,CAAC,cAAc,CAAC;IACjC;IACAf,UAAU,GAAGa,SAAS;IACtBZ,aAAa,GAAGI,IAAI,CAACD,GAAG,CAAC,CAAC,GAAG,GAAG,GAAG,IAAI;IACvC,OAAOS,SAAS;EAClB,CAAC,CAAC,CACDG,KAAK,CAACC,GAAG,IAAI;IACZjB,UAAU,GAAG,IAAI;IACjBC,aAAa,GAAG,CAAC;IACjB,MAAMgB,GAAG;EACX,CAAC,CAAC,CACDC,OAAO,CAAC,MAAM;IACbhB,YAAY,GAAG,IAAI;EACrB,CAAC,CAAC;EACJ,OAAOA,YAAY;AACrB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}