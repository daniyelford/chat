{"ast":null,"code":"import { unref as _unref, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"card-inner\"\n};\nconst _hoisted_3 = {\n  class: \"user-info\"\n};\nconst _hoisted_4 = [\"src\"];\nconst _hoisted_5 = {\n  key: 1,\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\"\n};\nconst _hoisted_6 = {\n  class: \"media-inner\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"card-category\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"description\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"location\"\n};\nconst _hoisted_10 = {\n  class: \"time\"\n};\nconst _hoisted_11 = [\"disabled\"];\nconst _hoisted_12 = {\n  key: 2,\n  class: \"none-cart-error\"\n};\nconst _hoisted_13 = {\n  key: 3,\n  class: \"toast\"\n};\nimport { ref, onMounted, onBeforeUnmount, computed } from 'vue';\nimport moment from 'moment-jalaali';\nimport { useNewsStore } from '@/stores/news';\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue';\nexport default {\n  __name: 'NewsCards',\n  setup(__props) {\n    const newsStore = useNewsStore();\n    const visibleCount = ref(10);\n    const loadingMore = ref(false);\n    const toastMsg = ref('');\n    const visibleNews = computed(() => newsStore.cards.slice(0, visibleCount.value));\n    function loadMore() {\n      loadingMore.value = true;\n      setTimeout(() => {\n        visibleCount.value += 10;\n        loadingMore.value = false;\n      }, 300);\n    }\n    function showToast(msg) {\n      toastMsg.value = msg;\n      setTimeout(() => toastMsg.value = '', 3000);\n    }\n    let intervalId = null;\n    async function pollNews() {\n      const prevTopId = newsStore.cards.length ? newsStore.cards[0].id : 0;\n      await newsStore.fetchNews();\n      const newTopId = newsStore.cards.length ? newsStore.cards[0].id : 0;\n      if (newTopId > prevTopId) {\n        showToast('خبر جدید رسید!');\n      }\n    }\n    function handleVisibilityChange() {\n      if (document.visibilityState === 'visible') {\n        pollNews();\n        startPolling();\n      } else {\n        stopPolling();\n      }\n    }\n    function startPolling() {\n      stopPolling();\n      intervalId = setInterval(() => {\n        pollNews();\n      }, 6000);\n    }\n    function stopPolling() {\n      if (intervalId) clearInterval(intervalId);\n      intervalId = null;\n    }\n    onMounted(() => {\n      newsStore.fetchNews();\n      startPolling();\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n    });\n    onBeforeUnmount(() => {\n      stopPolling();\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", null, [!_unref(newsStore).isLoaded ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \" در حال بارگذاری... \")) : visibleNews.value.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(visibleNews.value, card => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: card.id,\n          class: \"card\"\n        }, [_createElementVNode(\"div\", _hoisted_3, [card.user.image ? (_openBlock(), _createElementBlock(\"img\", {\n          key: 0,\n          src: card.user.image,\n          alt: \"user\"\n        }, null, 8, _hoisted_4)) : (_openBlock(), _createElementBlock(\"svg\", _hoisted_5, _cache[0] || (_cache[0] = [_createElementVNode(\"path\", {\n          d: \"M12 2C6.48 2 ... 12 20z\"\n        }, null, -1)]))), _createElementVNode(\"p\", null, _toDisplayString(card.user.name + ' ' + card.user.family), 1)]), _createElementVNode(\"div\", _hoisted_6, [card.medias.length > 0 ? (_openBlock(), _createBlock(MediaSlider, {\n          key: 0,\n          medias: card.medias\n        }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true)]), !_unref(newsStore).hasRule ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, _toDisplayString(card.category), 1)) : _createCommentVNode(\"\", true), card.description ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, _toDisplayString(card.description), 1)) : _createCommentVNode(\"\", true), card.location ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \" 📍 \" + _toDisplayString(card.location), 1)) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_10, _toDisplayString(_unref(moment)(card.created_at).format('jYYYY/jMM/jDD')), 1)]);\n      }), 128)), visibleCount.value < _unref(newsStore).cards.length ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 0,\n        onClick: loadMore,\n        disabled: loadingMore.value\n      }, _toDisplayString(loadingMore.value ? 'در حال بارگذاری...' : 'نمایش بیشتر'), 9, _hoisted_11)) : _createCommentVNode(\"\", true)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_12, \" خبری در محدوده شما وجود ندارد \")), toastMsg.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, _toDisplayString(toastMsg.value), 1)) : _createCommentVNode(\"\", true)]);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","computed","moment","useNewsStore","MediaSlider","newsStore","visibleCount","loadingMore","toastMsg","visibleNews","cards","slice","value","loadMore","setTimeout","showToast","msg","intervalId","pollNews","prevTopId","length","id","fetchNews","newTopId","handleVisibilityChange","document","visibilityState","startPolling","stopPolling","setInterval","clearInterval","addEventListener","removeEventListener"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/NewsCards.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"loading\" v-if=\"!newsStore.isLoaded\">\r\n      در حال بارگذاری...\r\n    </div>\r\n\r\n    <div class=\"card-inner\" v-else-if=\"visibleNews.length > 0\">\r\n      <div v-for=\"card in visibleNews\" :key=\"card.id\" class=\"card\">\r\n        <div class=\"user-info\">\r\n          <img v-if=\"card.user.image\" :src=\"card.user.image\" alt=\"user\" />\r\n          <svg v-else xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\r\n            <path d=\"M12 2C6.48 2 ... 12 20z\" />\r\n          </svg>\r\n          <p>{{ card.user.name + ' ' + card.user.family }}</p>\r\n        </div>\r\n\r\n        <div class=\"media-inner\">\r\n          <MediaSlider v-if=\"card.medias.length > 0\" :medias=\"card.medias\" />\r\n        </div>\r\n\r\n        <div class=\"card-category\" v-if=\"!newsStore.hasRule\">\r\n          {{ card.category }}\r\n        </div>\r\n\r\n        <div class=\"description\" v-if=\"card.description\">\r\n          {{ card.description }}\r\n        </div>\r\n\r\n        <div class=\"location\" v-if=\"card.location\">\r\n          📍 {{ card.location }}\r\n        </div>\r\n\r\n        <div class=\"time\">\r\n          {{ moment(card.created_at).format('jYYYY/jMM/jDD') }}\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        v-if=\"visibleCount < newsStore.cards.length\"\r\n        @click=\"loadMore\"\r\n        :disabled=\"loadingMore\"\r\n      >\r\n        {{ loadingMore ? 'در حال بارگذاری...' : 'نمایش بیشتر' }}\r\n      </button>\r\n    </div>\r\n\r\n    <div v-else class=\"none-cart-error\">\r\n      خبری در محدوده شما وجود ندارد\r\n    </div>\r\n\r\n    <!-- ساده‌ترین toast دستی -->\r\n    <div v-if=\"toastMsg\" class=\"toast\">{{ toastMsg }}</div>\r\n  </div>\r\n</template>\r\n<script setup>\r\n    import { ref, onMounted, onBeforeUnmount, computed } from 'vue'\r\n    import moment from 'moment-jalaali'\r\n    import { useNewsStore } from '@/stores/news'\r\n    import MediaSlider from '@/components/tooles/media/MediaSlider.vue'\r\n    const newsStore = useNewsStore()\r\n    const visibleCount = ref(10)\r\n    const loadingMore = ref(false)\r\n    const toastMsg = ref('')\r\n    const visibleNews = computed(() =>\r\n        newsStore.cards.slice(0, visibleCount.value)\r\n    )\r\n    function loadMore() {\r\n        loadingMore.value = true\r\n        setTimeout(() => {\r\n            visibleCount.value += 10\r\n            loadingMore.value = false\r\n        }, 300)\r\n    }\r\n    function showToast(msg) {\r\n        toastMsg.value = msg\r\n        setTimeout(() => (toastMsg.value = ''), 3000)\r\n    }\r\n    let intervalId = null\r\n    async function pollNews() {\r\n        const prevTopId = newsStore.cards.length ? newsStore.cards[0].id : 0\r\n        await newsStore.fetchNews()\r\n        const newTopId = newsStore.cards.length ? newsStore.cards[0].id : 0\r\n        if (newTopId > prevTopId) {\r\n            showToast('خبر جدید رسید!')\r\n        }\r\n    }\r\n    function handleVisibilityChange() {\r\n        if (document.visibilityState === 'visible') {\r\n            pollNews()\r\n            startPolling()\r\n        } else {\r\n            stopPolling()\r\n        }\r\n    }\r\n    function startPolling() {\r\n        stopPolling()\r\n        intervalId = setInterval(() => {\r\n            pollNews()\r\n        }, 6000)\r\n    }\r\n    function stopPolling() {\r\n        if (intervalId) clearInterval(intervalId)\r\n        intervalId = null\r\n    }\r\n    onMounted(() => {\r\n        newsStore.fetchNews()\r\n        startPolling()\r\n        document.addEventListener('visibilitychange', handleVisibilityChange)\r\n    })\r\n    onBeforeUnmount(() => {\r\n        stopPolling()\r\n        document.removeEventListener('visibilitychange', handleVisibilityChange)\r\n    })\r\n</script>\r\n<style scoped>\r\n    .loading{\r\n        text-align: center;\r\n        padding: 15px;\r\n        background: blue;\r\n        color: white;\r\n        font-size: 20px;\r\n        border-radius: 5px;\r\n        font-weight: bold;\r\n    }\r\n    .none-cart-error {\r\n        text-align: center;\r\n        padding: 15px;\r\n        background: red;\r\n        color: white;\r\n        font-size: 20px;\r\n        border-radius: 5px;\r\n        font-weight: bold;\r\n    }\r\n    .media-inner {\r\n        background: white;\r\n        padding: 5px;\r\n    }\r\n    .location {\r\n        margin: 5px;\r\n        gap: 5px;\r\n        display: flex;\r\n        font-size: 11px;\r\n        align-items: center;\r\n    }\r\n    .location svg{\r\n        height: 20px;\r\n        width: 20px;\r\n    }\r\n    .user-info svg,.user-info img{\r\n        width: 50px;\r\n        height: 50px;\r\n        border-radius: 50px;\r\n        display: inline-block;\r\n    }\r\n    .user-info p{\r\n        display: inline-block;\r\n    }\r\n    .user-info{\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        padding: 10px;\r\n    }\r\n    .card-category {\r\n        text-align: center;\r\n        padding: 10px;\r\n        background: floralwhite;\r\n    }\r\n    .card-inner {\r\n        width: 100%;\r\n        direction: rtl;\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: row-reverse;\r\n        flex-wrap: wrap;\r\n        align-content: flex-start;\r\n        justify-content: center;\r\n        align-items: stretch;\r\n    }\r\n    .card {\r\n        background: #f5f5f5;\r\n        width: 49%;\r\n        min-height: 300px;\r\n        margin: 0 0.5% 10px 0.5%;\r\n        border-radius: 10px;\r\n        box-shadow: 0 0 5px grey;\r\n    }\r\n    .media {\r\n        height: 150px;\r\n        width: auto;\r\n        margin: auto;\r\n    }\r\n    .media img,\r\n    .media video {\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .card-header {\r\n        display: flex;\r\n        flex-direction: row-reverse;\r\n        flex-wrap: nowrap;\r\n        justify-content: space-between;\r\n        align-items: stretch;\r\n        padding: 6px;\r\n    }\r\n    .description {\r\n        min-height: 50px;\r\n        padding: 10px;\r\n        width: 95%;\r\n        text-align: center;\r\n    }\r\n    .time {\r\n        font-size: 10px;\r\n        padding-left: 10px;\r\n        text-align: end;\r\n        margin: 5px;\r\n    }\r\n    .choose {\r\n        width: 95%;\r\n        height: 30px;\r\n        background: blue;\r\n        margin: 5px auto;\r\n        text-align: center;\r\n        border-radius: 10px;\r\n        color: white;\r\n        display: block;\r\n        padding-top: 10px;\r\n    }\r\n    @media screen and (max-width: 600px) {\r\n        .card {\r\n            width: 99%;\r\n        }\r\n    }\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDI,SAASA,GAAG,EAAEC,SAAS,EAAEC,eAAe,EAAEC,QAAQ,QAAQ,KAAK;AAC/D,OAAOC,MAAM,MAAM,gBAAgB;AACnC,SAASC,YAAY,QAAQ,eAAe;AAC5C,OAAOC,WAAW,MAAM,2CAA2C;;;;IACnE,MAAMC,SAAS,GAAGF,YAAY,CAAC,CAAC;IAChC,MAAMG,YAAY,GAAGR,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMS,WAAW,GAAGT,GAAG,CAAC,KAAK,CAAC;IAC9B,MAAMU,QAAQ,GAAGV,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMW,WAAW,GAAGR,QAAQ,CAAC,MACzBI,SAAS,CAACK,KAAK,CAACC,KAAK,CAAC,CAAC,EAAEL,YAAY,CAACM,KAAK,CAC/C,CAAC;IACD,SAASC,QAAQA,CAAA,EAAG;MAChBN,WAAW,CAACK,KAAK,GAAG,IAAI;MACxBE,UAAU,CAAC,MAAM;QACbR,YAAY,CAACM,KAAK,IAAI,EAAE;QACxBL,WAAW,CAACK,KAAK,GAAG,KAAK;MAC7B,CAAC,EAAE,GAAG,CAAC;IACX;IACA,SAASG,SAASA,CAACC,GAAG,EAAE;MACpBR,QAAQ,CAACI,KAAK,GAAGI,GAAG;MACpBF,UAAU,CAAC,MAAON,QAAQ,CAACI,KAAK,GAAG,EAAG,EAAE,IAAI,CAAC;IACjD;IACA,IAAIK,UAAU,GAAG,IAAI;IACrB,eAAeC,QAAQA,CAAA,EAAG;MACtB,MAAMC,SAAS,GAAGd,SAAS,CAACK,KAAK,CAACU,MAAM,GAAGf,SAAS,CAACK,KAAK,CAAC,CAAC,CAAC,CAACW,EAAE,GAAG,CAAC;MACpE,MAAMhB,SAAS,CAACiB,SAAS,CAAC,CAAC;MAC3B,MAAMC,QAAQ,GAAGlB,SAAS,CAACK,KAAK,CAACU,MAAM,GAAGf,SAAS,CAACK,KAAK,CAAC,CAAC,CAAC,CAACW,EAAE,GAAG,CAAC;MACnE,IAAIE,QAAQ,GAAGJ,SAAS,EAAE;QACtBJ,SAAS,CAAC,gBAAgB,CAAC;MAC/B;IACJ;IACA,SAASS,sBAAsBA,CAAA,EAAG;MAC9B,IAAIC,QAAQ,CAACC,eAAe,KAAK,SAAS,EAAE;QACxCR,QAAQ,CAAC,CAAC;QACVS,YAAY,CAAC,CAAC;MAClB,CAAC,MAAM;QACHC,WAAW,CAAC,CAAC;MACjB;IACJ;IACA,SAASD,YAAYA,CAAA,EAAG;MACpBC,WAAW,CAAC,CAAC;MACbX,UAAU,GAAGY,WAAW,CAAC,MAAM;QAC3BX,QAAQ,CAAC,CAAC;MACd,CAAC,EAAE,IAAI,CAAC;IACZ;IACA,SAASU,WAAWA,CAAA,EAAG;MACnB,IAAIX,UAAU,EAAEa,aAAa,CAACb,UAAU,CAAC;MACzCA,UAAU,GAAG,IAAI;IACrB;IACAlB,SAAS,CAAC,MAAM;MACZM,SAAS,CAACiB,SAAS,CAAC,CAAC;MACrBK,YAAY,CAAC,CAAC;MACdF,QAAQ,CAACM,gBAAgB,CAAC,kBAAkB,EAAEP,sBAAsB,CAAC;IACzE,CAAC,CAAC;IACFxB,eAAe,CAAC,MAAM;MAClB4B,WAAW,CAAC,CAAC;MACbH,QAAQ,CAACO,mBAAmB,CAAC,kBAAkB,EAAER,sBAAsB,CAAC;IAC5E,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}