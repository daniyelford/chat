{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport const useCartableStore = defineStore('cartable', () => {\n  const allItems = ref([]);\n  const rule = ref(true);\n  const loading = ref(true);\n  let pollingInterval = null;\n  const simplifyNews = items => items.map(item => ({\n    id: item.id,\n    status: item.status,\n    updated_at: item.updated_at\n  }));\n  const fetchCartables = async () => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'get_cartables'\n      });\n      if (res.status === 'success') {\n        const rawData = res.data || [];\n        const formattedData = rawData.map(item => {\n          return {\n            ...item,\n            user: {\n              name: item.reporter_name,\n              family: item.reporter_family,\n              phone: item.reporter_phone,\n              image: item.reporter_user_image_url\n            },\n            news: {\n              description: item.description || '',\n              media: (item.news_media || []).map(m => ({\n                id: m.id,\n                url: m.url,\n                type: m.type\n              })),\n              address: {\n                address: item.address,\n                lat: item.address_lat,\n                long: item.address_lon\n              }\n            }\n          };\n        });\n        const isSame = JSON.stringify(simplifyNews(allItems.value)) === JSON.stringify(simplifyNews(formattedData));\n        if (!isSame) {\n          allItems.value = formattedData;\n        }\n        rule.value = !!res.rule;\n      } else {\n        alert('خطا در دریافت اطلاعات: ' + res.message);\n      }\n    } catch (e) {\n      alert('خطا در ارتباط با سرور: ' + e.message);\n    }\n    loading.value = false;\n  };\n  const startPolling = () => {\n    if (pollingInterval) return;\n    fetchCartables();\n    pollingInterval = setInterval(fetchCartables, 10000);\n  };\n  const stopPolling = () => {\n    if (pollingInterval) {\n      clearInterval(pollingInterval);\n      pollingInterval = null;\n    }\n  };\n  const getCartableById = async id => {\n    try {\n      const res = await sendApi({\n        control: 'news',\n        action: 'get_cartable_by_id',\n        data: {\n          id\n        }\n      });\n      if (res.status === 'success' && res.data) {\n        const item = res.data;\n        return {\n          id: item.id,\n          has_rule: res.rule ?? false,\n          user: {\n            name: item.reporter_name,\n            family: item.reporter_family,\n            phone: item.reporter_phone,\n            image: item.reporter_user_image_url\n          },\n          news: {\n            description: item.news?.description || '',\n            media: item.news?.news_media || [],\n            address: {\n              address: item.address,\n              lat: item.address_lat,\n              long: item.address_lon\n            }\n          },\n          report: {\n            description: item.report_description || '',\n            media: item.report_media || [],\n            created_at: item.created_at,\n            run_time: item.run_time\n          }\n        };\n      } else {\n        alert('خطا در دریافت جزئیات: ' + res.message);\n        return null;\n      }\n    } catch (e) {\n      alert('خطا در ارتباط با سرور: ' + e.message);\n      return null;\n    }\n  };\n  return {\n    allItems,\n    loading,\n    rule,\n    fetchCartables,\n    startPolling,\n    stopPolling,\n    getCartableById\n  };\n});","map":{"version":3,"names":["defineStore","ref","sendApi","useCartableStore","allItems","rule","loading","pollingInterval","simplifyNews","items","map","item","id","status","updated_at","fetchCartables","res","control","action","rawData","data","formattedData","user","name","reporter_name","family","reporter_family","phone","reporter_phone","image","reporter_user_image_url","news","description","media","news_media","m","url","type","address","lat","address_lat","long","address_lon","isSame","JSON","stringify","value","alert","message","e","startPolling","setInterval","stopPolling","clearInterval","getCartableById","has_rule","report","report_description","report_media","created_at","run_time"],"sources":["D:/GitHub/ci3-vue3/vue3/src/stores/cartable.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { sendApi } from '@/utils/api'\r\n\r\nexport const useCartableStore = defineStore('cartable', () => {\r\n  const allItems = ref([])\r\n  const rule = ref(true)\r\n  const loading = ref(true)\r\n  let pollingInterval = null\r\n  const simplifyNews = (items) =>\r\n    items.map(item => ({\r\n      id: item.id,\r\n      status: item.status,\r\n      updated_at: item.updated_at\r\n    }))\r\n  const fetchCartables = async () => {\r\n    try {\r\n      const res = await sendApi({ control: 'news', action: 'get_cartables' })\r\n      if (res.status === 'success') {\r\n        const rawData = res.data || []\r\n        const formattedData = rawData.map(item => {\r\n          return {\r\n            ...item,\r\n            user: {\r\n              name: item.reporter_name,\r\n              family: item.reporter_family,\r\n              phone: item.reporter_phone,\r\n              image: item.reporter_user_image_url\r\n            },\r\n            news: {\r\n              description: item.description || '',\r\n              media: (item.news_media || []).map(m => ({\r\n                id: m.id,\r\n                url: m.url,\r\n                type: m.type\r\n              })),\r\n              address: {\r\n                address: item.address,\r\n                lat: item.address_lat,\r\n                long: item.address_lon\r\n              }\r\n            }\r\n          }\r\n        })\r\n\r\n        const isSame = JSON.stringify(simplifyNews(allItems.value)) === JSON.stringify(simplifyNews(formattedData))\r\n        if (!isSame) {\r\n          allItems.value = formattedData\r\n        }\r\n        rule.value = !!res.rule\r\n      } else {\r\n        alert('خطا در دریافت اطلاعات: ' + res.message)\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارتباط با سرور: ' + e.message)\r\n    }\r\n    loading.value = false\r\n  }\r\n  const startPolling = () => {\r\n    if (pollingInterval) return\r\n    fetchCartables()\r\n    pollingInterval = setInterval(fetchCartables, 10000)\r\n  }\r\n  const stopPolling = () => {\r\n    if (pollingInterval) {\r\n      clearInterval(pollingInterval)\r\n      pollingInterval = null\r\n    }\r\n  }\r\n  const getCartableById = async (id) => {\r\n    try {\r\n      const res = await sendApi({\r\n        control: 'news',\r\n        action: 'get_cartable_by_id',\r\n        data: { id }\r\n      })\r\n\r\n      if (res.status === 'success' && res.data) {\r\n        const item = res.data\r\n\r\n        return {\r\n          id: item.id,\r\n          has_rule: res.rule ?? false,\r\n          user: {\r\n            name: item.reporter_name,\r\n            family: item.reporter_family,\r\n            phone: item.reporter_phone,\r\n            image: item.reporter_user_image_url\r\n          },\r\n          news: {\r\n            description: item.news?.description || '',\r\n            media: item.news?.news_media || [],\r\n            address: {\r\n              address: item.address,\r\n              lat: item.address_lat,\r\n              long: item.address_lon\r\n            }\r\n          },\r\n          report: {\r\n            description: item.report_description || '',\r\n            media: item.report_media || [],\r\n            created_at: item.created_at,\r\n            run_time: item.run_time\r\n          }\r\n        }\r\n      } else {\r\n        alert('خطا در دریافت جزئیات: ' + res.message)\r\n        return null\r\n      }\r\n    } catch (e) {\r\n      alert('خطا در ارتباط با سرور: ' + e.message)\r\n      return null\r\n    }\r\n  }\r\n  return {\r\n    allItems,\r\n    loading,\r\n    rule,\r\n    fetchCartables,\r\n    startPolling,\r\n    stopPolling,\r\n    getCartableById\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}