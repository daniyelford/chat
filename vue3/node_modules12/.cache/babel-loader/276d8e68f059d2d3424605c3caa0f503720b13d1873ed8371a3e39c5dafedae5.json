{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { defineStore } from 'pinia';\nimport { sendApi } from '@/utils/api';\nimport { useUserStore } from '@/stores/user';\nexport const useNotificationStore = defineStore('notification', {\n  state: () => ({\n    notifications: [],\n    unreadCount: 0,\n    lastId: 0\n  }),\n  actions: {\n    async fetchNotifications({\n      limit = 10,\n      offset = 0,\n      append = false\n    } = {}) {\n      const userStore = useUserStore();\n      if (!userStore.isLoggedIn) return;\n      const res = await sendApi({\n        action: 'get_notifications',\n        control: 'user',\n        data: {\n          limit,\n          offset\n        }\n      });\n      if (res.status === 'success' && Array.isArray(res.data)) {\n        const newNotifs = res.data.filter(n => n.id > this.lastId);\n        if (newNotifs.length > 0) {\n          this.notifications = [...newNotifs, ...this.notifications];\n          this.lastId = Math.max(...this.notifications.map(n => n.id));\n          this.unreadCount = this.notifications.filter(n => n.is_read === 'dont').length;\n        }\n      }\n    },\n    markAsRead(id) {\n      const notif = this.notifications.find(n => n.id === id);\n      if (notif && notif.is_read === 'dont') {\n        notif.is_read = 'seen';\n        this.unreadCount = this.notifications.filter(n => n.is_read === 'dont').length;\n      }\n    },\n    pushNotification(notif) {\n      const exists = this.notifications.some(n => n.id === notif.id);\n      if (!exists) {\n        this.notifications.unshift(notif);\n        if (notif.is_read === 'dont') this.unreadCount++;\n        this.lastId = Math.max(this.lastId, notif.id);\n      }\n    }\n  },\n  persist: true\n});","map":{"version":3,"names":["defineStore","sendApi","useUserStore","useNotificationStore","state","notifications","unreadCount","lastId","actions","fetchNotifications","limit","offset","append","userStore","isLoggedIn","res","action","control","data","status","Array","isArray","newNotifs","filter","n","id","length","Math","max","map","is_read","markAsRead","notif","find","pushNotification","exists","some","unshift","persist"],"sources":["D:/GitHub/ci3-vue3/vue3/src/stores/notification.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { sendApi } from '@/utils/api'\r\nimport { useUserStore } from '@/stores/user'\r\nexport const useNotificationStore = defineStore('notification', {\r\n  state: () => ({\r\n    notifications: [],\r\n    unreadCount: 0,\r\n    lastId: 0,\r\n  }),\r\n  actions: {\r\n    async fetchNotifications({ limit = 10, offset = 0, append = false } = {}) {\r\n      const userStore = useUserStore()\r\n      if (!userStore.isLoggedIn) return\r\n      const res = await sendApi({ action: 'get_notifications', control: 'user' ,data: { limit, offset }})\r\n      if (res.status === 'success' && Array.isArray(res.data)) {\r\n        const newNotifs = res.data.filter(n => n.id > this.lastId)\r\n        if (newNotifs.length > 0) {\r\n          this.notifications = [...newNotifs, ...this.notifications]\r\n          this.lastId = Math.max(...this.notifications.map(n => n.id))\r\n          this.unreadCount = this.notifications.filter(n => n.is_read === 'dont').length\r\n        }\r\n      }\r\n    },\r\n    markAsRead(id) {\r\n      const notif = this.notifications.find(n => n.id === id)\r\n      if (notif && notif.is_read === 'dont') {\r\n        notif.is_read = 'seen'\r\n        this.unreadCount = this.notifications.filter(n => n.is_read === 'dont').length\r\n      }\r\n    },\r\n    pushNotification(notif) {\r\n      const exists = this.notifications.some(n => n.id === notif.id)\r\n      if (!exists) {\r\n        this.notifications.unshift(notif)\r\n        if (notif.is_read === 'dont') this.unreadCount++\r\n        this.lastId = Math.max(this.lastId, notif.id)\r\n      }\r\n    }\r\n  },\r\n  persist: true\r\n})"],"mappings":";;;;;AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,OAAO,QAAQ,aAAa;AACrC,SAASC,YAAY,QAAQ,eAAe;AAC5C,OAAO,MAAMC,oBAAoB,GAAGH,WAAW,CAAC,cAAc,EAAE;EAC9DI,KAAK,EAAEA,CAAA,MAAO;IACZC,aAAa,EAAE,EAAE;IACjBC,WAAW,EAAE,CAAC;IACdC,MAAM,EAAE;EACV,CAAC,CAAC;EACFC,OAAO,EAAE;IACP,MAAMC,kBAAkBA,CAAC;MAAEC,KAAK,GAAG,EAAE;MAAEC,MAAM,GAAG,CAAC;MAAEC,MAAM,GAAG;IAAM,CAAC,GAAG,CAAC,CAAC,EAAE;MACxE,MAAMC,SAAS,GAAGX,YAAY,CAAC,CAAC;MAChC,IAAI,CAACW,SAAS,CAACC,UAAU,EAAE;MAC3B,MAAMC,GAAG,GAAG,MAAMd,OAAO,CAAC;QAAEe,MAAM,EAAE,mBAAmB;QAAEC,OAAO,EAAE,MAAM;QAAEC,IAAI,EAAE;UAAER,KAAK;UAAEC;QAAO;MAAC,CAAC,CAAC;MACnG,IAAII,GAAG,CAACI,MAAM,KAAK,SAAS,IAAIC,KAAK,CAACC,OAAO,CAACN,GAAG,CAACG,IAAI,CAAC,EAAE;QACvD,MAAMI,SAAS,GAAGP,GAAG,CAACG,IAAI,CAACK,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,EAAE,GAAG,IAAI,CAAClB,MAAM,CAAC;QAC1D,IAAIe,SAAS,CAACI,MAAM,GAAG,CAAC,EAAE;UACxB,IAAI,CAACrB,aAAa,GAAG,CAAC,GAAGiB,SAAS,EAAE,GAAG,IAAI,CAACjB,aAAa,CAAC;UAC1D,IAAI,CAACE,MAAM,GAAGoB,IAAI,CAACC,GAAG,CAAC,GAAG,IAAI,CAACvB,aAAa,CAACwB,GAAG,CAACL,CAAC,IAAIA,CAAC,CAACC,EAAE,CAAC,CAAC;UAC5D,IAAI,CAACnB,WAAW,GAAG,IAAI,CAACD,aAAa,CAACkB,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACM,OAAO,KAAK,MAAM,CAAC,CAACJ,MAAM;QAChF;MACF;IACF,CAAC;IACDK,UAAUA,CAACN,EAAE,EAAE;MACb,MAAMO,KAAK,GAAG,IAAI,CAAC3B,aAAa,CAAC4B,IAAI,CAACT,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKA,EAAE,CAAC;MACvD,IAAIO,KAAK,IAAIA,KAAK,CAACF,OAAO,KAAK,MAAM,EAAE;QACrCE,KAAK,CAACF,OAAO,GAAG,MAAM;QACtB,IAAI,CAACxB,WAAW,GAAG,IAAI,CAACD,aAAa,CAACkB,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACM,OAAO,KAAK,MAAM,CAAC,CAACJ,MAAM;MAChF;IACF,CAAC;IACDQ,gBAAgBA,CAACF,KAAK,EAAE;MACtB,MAAMG,MAAM,GAAG,IAAI,CAAC9B,aAAa,CAAC+B,IAAI,CAACZ,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKO,KAAK,CAACP,EAAE,CAAC;MAC9D,IAAI,CAACU,MAAM,EAAE;QACX,IAAI,CAAC9B,aAAa,CAACgC,OAAO,CAACL,KAAK,CAAC;QACjC,IAAIA,KAAK,CAACF,OAAO,KAAK,MAAM,EAAE,IAAI,CAACxB,WAAW,EAAE;QAChD,IAAI,CAACC,MAAM,GAAGoB,IAAI,CAACC,GAAG,CAAC,IAAI,CAACrB,MAAM,EAAEyB,KAAK,CAACP,EAAE,CAAC;MAC/C;IACF;EACF,CAAC;EACDa,OAAO,EAAE;AACX,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}