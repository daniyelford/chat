{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"uploading-box\"\n};\nconst _hoisted_2 = [\"value\"];\nconst _hoisted_3 = {\n  key: 1,\n  class: \"preview-box\"\n};\nconst _hoisted_4 = {\n  class: \"preview-list\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = [\"src\"];\nconst _hoisted_8 = {\n  key: 2,\n  class: \"file-label\"\n};\nconst _hoisted_9 = {\n  class: \"file-name\"\n};\nimport { ref } from 'vue';\nimport { sendApi } from '@/utils/api';\nexport default {\n  __name: 'UploaderManyMedia',\n  props: {\n    url: String,\n    toAction: String\n  },\n  emits: ['done'],\n  setup(__props, {\n    emit: __emit\n  }) {\n    const fileInput = ref(null);\n    const selectedFilesBase64 = ref([]);\n    const progress = ref(0);\n    const uploading = ref(false);\n    const props = __props;\n    const mediaList = ref([]);\n    const emit = __emit;\n    const handleDrop = e => {\n      const files = e.dataTransfer.files;\n      handleFiles({\n        target: {\n          files\n        }\n      });\n    };\n    const handleFiles = async e => {\n      const files = Array.from(e.target.files);\n      if (!files.length) return;\n      selectedFilesBase64.value = [];\n      uploading.value = true;\n      progress.value = 0;\n      let count = 0;\n      for (const file of files) {\n        await new Promise(resolve => {\n          const reader = new FileReader();\n          reader.onload = () => {\n            const base64 = reader.result;\n            selectedFilesBase64.value.push(base64);\n            count++;\n            progress.value = Math.round(count / files.length * 100);\n            resolve();\n          };\n          reader.readAsDataURL(file);\n        });\n      }\n      await uploadFiles();\n      uploading.value = false;\n    };\n    const uploadFiles = async () => {\n      try {\n        const response = await sendApi({\n          control: 'upload',\n          action: 'upload_many_media',\n          data: {\n            url: props.url,\n            data: selectedFilesBase64.value,\n            toAction: props.toAction\n          }\n        });\n        if (response.status === 'success') {\n          console.log(response);\n          const uploaded = response.media || response.data;\n          mediaList.value.push(...uploaded);\n          selectedFilesBase64.value = [];\n          emit('done', mediaList.value);\n        } else {\n          alert('آپلود با خطا مواجه شد: ' + response.message);\n        }\n      } catch (err) {\n        alert('خطا در ارسال: ' + err.message);\n      }\n    };\n    const deleteMedia = async (media, index) => {\n      try {\n        const res = await sendApi({\n          control: 'upload',\n          action: 'delete_media_by_id',\n          data: {\n            id: media.id\n          }\n        });\n        if (res.status === 'success') {\n          mediaList.value.splice(index, 1);\n        } else {\n          alert('حذف فایل با خطا مواجه شد: ' + res.message);\n        }\n      } catch (err) {\n        alert('خطا در حذف: ' + err.message);\n      }\n    };\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        class: \"drop-area\",\n        onDragover: _cache[1] || (_cache[1] = _withModifiers(() => {}, [\"prevent\"])),\n        onDragenter: _cache[2] || (_cache[2] = _withModifiers(() => {}, [\"prevent\"])),\n        onDrop: _withModifiers(handleDrop, [\"prevent\"])\n      }, [_cache[5] || (_cache[5] = _createElementVNode(\"p\", null, \"فایل‌ها را بکشید و رها کنید یا کلیک کنید\", -1)), _createElementVNode(\"input\", {\n        type: \"file\",\n        multiple: \"\",\n        ref_key: \"fileInput\",\n        ref: fileInput,\n        class: \"hidden-input\",\n        onChange: handleFiles\n      }, null, 544), _createElementVNode(\"button\", {\n        type: \"button\",\n        class: \"select-button\",\n        onClick: _cache[0] || (_cache[0] = $event => fileInput.value.click())\n      }, \"انتخاب فایل\"), uploading.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"p\", null, \"در حال آماده‌سازی فایل‌ها برای ارسال...\", -1)), _createElementVNode(\"progress\", {\n        value: progress.value,\n        min: \"0\",\n        max: \"100\",\n        class: \"progress-bar\"\n      }, null, 8, _hoisted_2)])) : _createCommentVNode(\"\", true), mediaList.value.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[4] || (_cache[4] = _createElementVNode(\"p\", null, \"پیش‌نمایش فایل‌ها:\", -1)), _createElementVNode(\"div\", _hoisted_4, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(mediaList.value, (item, i) => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: item.id || i,\n          class: \"preview-item\"\n        }, [_createElementVNode(\"button\", {\n          onClick: $event => deleteMedia(item, i),\n          class: \"delete-button\"\n        }, \"×\", 8, _hoisted_5), item.type === 'image' ? (_openBlock(), _createElementBlock(\"img\", {\n          key: 0,\n          src: item.url,\n          class: \"preview-image\"\n        }, null, 8, _hoisted_6)) : item.type === 'video' ? (_openBlock(), _createElementBlock(\"video\", {\n          key: 1,\n          src: item.url,\n          controls: \"\",\n          class: \"preview-video\"\n        }, null, 8, _hoisted_7)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \"PDF File\")), _createElementVNode(\"span\", _hoisted_9, _toDisplayString(item.name || item.url?.split('/').pop()), 1)]);\n      }), 128))])])) : _createCommentVNode(\"\", true)], 32);\n    };\n  }\n};","map":{"version":3,"names":["ref","sendApi","fileInput","selectedFilesBase64","progress","uploading","props","__props","mediaList","emit","__emit","handleDrop","e","files","dataTransfer","handleFiles","target","Array","from","length","value","count","file","Promise","resolve","reader","FileReader","onload","base64","result","push","Math","round","readAsDataURL","uploadFiles","response","control","action","data","url","toAction","status","console","log","uploaded","media","alert","message","err","deleteMedia","index","res","id","splice"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/tooles/upload/UploaderManyMedia.vue"],"sourcesContent":["<template>\r\n  <div class=\"drop-area\" @dragover.prevent @dragenter.prevent @drop.prevent=\"handleDrop\">\r\n    <p>فایل‌ها را بکشید و رها کنید یا کلیک کنید</p>\r\n    <input type=\"file\" multiple ref=\"fileInput\" class=\"hidden-input\" @change=\"handleFiles\" />\r\n    <button type=\"button\" class=\"select-button\" @click=\"fileInput.click()\">انتخاب فایل</button>\r\n    <div v-if=\"uploading\" class=\"uploading-box\">\r\n      <p>در حال آماده‌سازی فایل‌ها برای ارسال...</p>\r\n      <progress :value=\"progress\" min=\"0\" max=\"100\" class=\"progress-bar\"></progress>\r\n    </div>\r\n    <div v-if=\"mediaList.length > 0\" class=\"preview-box\">\r\n      <p>پیش‌نمایش فایل‌ها:</p>\r\n      <div class=\"preview-list\">\r\n        <div v-for=\"(item, i) in mediaList\" :key=\"item.id || i\" class=\"preview-item\">\r\n          <button @click=\"deleteMedia(item, i)\" class=\"delete-button\">×</button>\r\n          <img v-if=\"item.type === 'image'\" :src=\"item.url\" class=\"preview-image\" />\r\n          <video v-else-if=\"item.type === 'video'\" :src=\"item.url\" controls class=\"preview-video\" />\r\n          <span v-else class=\"file-label\">PDF File</span>\r\n          <span class=\"file-name\">{{ item.name || (item.url?.split('/').pop()) }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\n  import { ref, defineProps, defineEmits } from 'vue'\r\n  import { sendApi } from '@/utils/api'\r\n  const fileInput = ref(null)\r\n  const selectedFilesBase64 = ref([])\r\n  const progress = ref(0)\r\n  const uploading = ref(false)\r\n  const props = defineProps({\r\n    url: String,\r\n    toAction: String,\r\n  })\r\n  const mediaList = ref([])\r\n  const emit = defineEmits(['done'])\r\n  const handleDrop = (e) => {\r\n    const files = e.dataTransfer.files\r\n    handleFiles({ target: { files } })\r\n  }\r\n  const handleFiles = async (e) => {\r\n    const files = Array.from(e.target.files)\r\n    if (!files.length) return\r\n    selectedFilesBase64.value = []\r\n    uploading.value = true\r\n    progress.value = 0\r\n    let count = 0\r\n    for (const file of files) {\r\n      await new Promise((resolve) => {\r\n        const reader = new FileReader()\r\n        reader.onload = () => {\r\n          const base64 = reader.result\r\n          selectedFilesBase64.value.push(base64)\r\n          count++\r\n          progress.value = Math.round((count / files.length) * 100)\r\n          resolve()\r\n        }\r\n        reader.readAsDataURL(file)\r\n      })\r\n    }\r\n    await uploadFiles()\r\n    uploading.value = false\r\n  }\r\n  const uploadFiles = async () => {\r\n    try {\r\n      const response = await sendApi({\r\n        control: 'upload',\r\n        action: 'upload_many_media',\r\n        data: {\r\n          url: props.url,\r\n          data: selectedFilesBase64.value,\r\n          toAction: props.toAction,\r\n        },\r\n      })\r\n      if (response.status === 'success') {\r\n        console.log(response)\r\n        const uploaded = response.media || response.data\r\n        mediaList.value.push(...uploaded)\r\n        selectedFilesBase64.value = []\r\n        emit('done', mediaList.value)\r\n      } else {\r\n        alert('آپلود با خطا مواجه شد: ' + response.message)\r\n      }\r\n    } catch (err) {\r\n      alert('خطا در ارسال: ' + err.message)\r\n    }\r\n  }\r\n  const deleteMedia = async (media, index) => {\r\n    try {\r\n      const res = await sendApi({\r\n        control: 'upload',\r\n        action: 'delete_media_by_id',\r\n        data: { id: media.id },\r\n      })\r\n      if (res.status === 'success') {\r\n        mediaList.value.splice(index, 1)\r\n      } else {\r\n        alert('حذف فایل با خطا مواجه شد: ' + res.message)\r\n      }\r\n    } catch (err) {\r\n      alert('خطا در حذف: ' + err.message)\r\n    }\r\n  }\r\n</script>\r\n<style scoped>\r\n    .drop-area {\r\n        border: 2px dashed #d1d5db;\r\n        padding: 1rem;\r\n        border-radius: 0.5rem;\r\n        text-align: center;\r\n        cursor: pointer;\r\n    }\r\n    .hidden-input {\r\n        display: none;\r\n    }\r\n    .select-button {\r\n        margin-top: 0.5rem;\r\n        padding: 0.4rem 0.8rem;\r\n        cursor: pointer;\r\n    }\r\n    .uploading-box {\r\n        margin-top: 1rem;\r\n    }\r\n    .progress-bar {\r\n        width: 100%;\r\n    }\r\n    .preview-box {\r\n        margin-top: 1rem;\r\n    }\r\n    .preview-list {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 1rem;\r\n        justify-content: center;\r\n    }\r\n    .preview-item {\r\n        display: flex;\r\n        position: relative;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        gap: 0.5rem;\r\n        border: 1px solid #d1d5db;\r\n        border-radius: 0.5rem;\r\n        padding: 0.5rem;\r\n        background-color: #f9fafb;\r\n    }\r\n    .preview-image {\r\n        max-width: 100px;\r\n        max-height: 100px;\r\n        object-fit: contain;\r\n        border: 1px solid #ccc;\r\n    }\r\n    .preview-video {\r\n        max-width: 150px;\r\n        max-height: 100px;\r\n    }\r\n    .file-label {\r\n        font-size: 0.875rem;\r\n        color: #4b5563;\r\n    }\r\n    .file-name {\r\n        font-size: 0.75rem;\r\n        color: #9ca3af;\r\n        max-width: 100px;\r\n        text-align: center;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n    }\r\n    .delete-button {\r\n      position: absolute;\r\n      top: 4px;\r\n      z-index: 9;\r\n      right: 4px;\r\n      background-color: #ef4444;\r\n      color: white;\r\n      border: none;\r\n      border-radius: 9999px;\r\n      width: 20px;\r\n      height: 20px;\r\n      font-size: 12px;\r\n      line-height: 20px;\r\n      text-align: center;\r\n      cursor: pointer;\r\n    }\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}