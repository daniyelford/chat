{"ast":null,"code":"import { BASE_URL, API_SECRET_KEY } from '@/config';\nlet isLoggingOut = false;\nexport async function sendApi(data = {}) {\n  try {\n    const tokenRes = await fetch(`${BASE_URL}/create_token`, {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'X-API-KEY': API_SECRET_KEY\n      }\n    });\n    const tokenJson = await tokenRes.json();\n    if (!tokenJson.token || tokenJson.error || tokenJson.status === 'error') {\n      if (!isLoggingOut) {\n        isLoggingOut = true;\n        console.warn('نشست منقضی شده. هدایت به صفحه ورود...');\n        localStorage.clear();\n        window.location.href = `${BASE_URL}`;\n      }\n      throw new Error('Unauthorized');\n    }\n    const token = tokenJson.token;\n    const response = await fetch(`${BASE_URL}/api`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`,\n        'X-API-KEY': API_SECRET_KEY\n      },\n      body: JSON.stringify(data)\n    });\n    const result = await response.json();\n    if (result.code === 401 || result.message === 'توکن نامعتبر است') {\n      if (!isLoggingOut) {\n        isLoggingOut = true;\n        console.warn('نشست منقضی شده. هدایت به صفحه ورود...');\n        localStorage.clear();\n        window.location.href = `${BASE_URL}`;\n      }\n      throw new Error('Unauthorized');\n    }\n    return result;\n  } catch (err) {\n    console.error('API Error:', err);\n    throw err;\n  }\n}","map":{"version":3,"names":["BASE_URL","API_SECRET_KEY","isLoggingOut","sendApi","data","tokenRes","fetch","method","credentials","headers","tokenJson","json","token","error","status","console","warn","localStorage","clear","window","location","href","Error","response","body","JSON","stringify","result","code","message","err"],"sources":["D:/GitHub/ci3-vue3/vue3/src/utils/api.js"],"sourcesContent":["import { BASE_URL, API_SECRET_KEY } from '@/config';\r\nlet isLoggingOut = false;\r\nexport async function sendApi(data = {}) {\r\n  try {\r\n    const tokenRes = await fetch(`${BASE_URL}/create_token`, {\r\n      method: 'GET',\r\n      credentials: 'include',\r\n      headers: {\r\n        'X-API-KEY': API_SECRET_KEY\r\n      }\r\n    });\r\n    const tokenJson = await tokenRes.json();\r\n    if (!tokenJson.token || tokenJson.error || tokenJson.status==='error') {\r\n      if (!isLoggingOut) {\r\n        isLoggingOut = true;\r\n        console.warn('نشست منقضی شده. هدایت به صفحه ورود...');\r\n        localStorage.clear();\r\n        window.location.href = `${BASE_URL}`;\r\n      }\r\n      throw new Error('Unauthorized');\r\n    }\r\n    const token = tokenJson.token;\r\n    const response = await fetch(`${BASE_URL}/api`, {\r\n      method: 'POST',\r\n      credentials: 'include',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${token}`,\r\n        'X-API-KEY': API_SECRET_KEY\r\n      },\r\n      body: JSON.stringify(data)\r\n    });\r\n    const result = await response.json();\r\n    if (result.code === 401 || result.message === 'توکن نامعتبر است') {\r\n      if (!isLoggingOut) {\r\n        isLoggingOut = true;\r\n        console.warn('نشست منقضی شده. هدایت به صفحه ورود...');\r\n        localStorage.clear();\r\n        window.location.href = `${BASE_URL}`;\r\n      }\r\n      throw new Error('Unauthorized');\r\n    }\r\n    return result;\r\n  } catch (err) {\r\n    console.error('API Error:', err);\r\n    throw err;\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,cAAc,QAAQ,UAAU;AACnD,IAAIC,YAAY,GAAG,KAAK;AACxB,OAAO,eAAeC,OAAOA,CAACC,IAAI,GAAG,CAAC,CAAC,EAAE;EACvC,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGN,QAAQ,eAAe,EAAE;MACvDO,MAAM,EAAE,KAAK;MACbC,WAAW,EAAE,SAAS;MACtBC,OAAO,EAAE;QACP,WAAW,EAAER;MACf;IACF,CAAC,CAAC;IACF,MAAMS,SAAS,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;IACvC,IAAI,CAACD,SAAS,CAACE,KAAK,IAAIF,SAAS,CAACG,KAAK,IAAIH,SAAS,CAACI,MAAM,KAAG,OAAO,EAAE;MACrE,IAAI,CAACZ,YAAY,EAAE;QACjBA,YAAY,GAAG,IAAI;QACnBa,OAAO,CAACC,IAAI,CAAC,uCAAuC,CAAC;QACrDC,YAAY,CAACC,KAAK,CAAC,CAAC;QACpBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAGrB,QAAQ,EAAE;MACtC;MACA,MAAM,IAAIsB,KAAK,CAAC,cAAc,CAAC;IACjC;IACA,MAAMV,KAAK,GAAGF,SAAS,CAACE,KAAK;IAC7B,MAAMW,QAAQ,GAAG,MAAMjB,KAAK,CAAC,GAAGN,QAAQ,MAAM,EAAE;MAC9CO,MAAM,EAAE,MAAM;MACdC,WAAW,EAAE,SAAS;MACtBC,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAE,UAAUG,KAAK,EAAE;QAClC,WAAW,EAAEX;MACf,CAAC;MACDuB,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACtB,IAAI;IAC3B,CAAC,CAAC;IACF,MAAMuB,MAAM,GAAG,MAAMJ,QAAQ,CAACZ,IAAI,CAAC,CAAC;IACpC,IAAIgB,MAAM,CAACC,IAAI,KAAK,GAAG,IAAID,MAAM,CAACE,OAAO,KAAK,kBAAkB,EAAE;MAChE,IAAI,CAAC3B,YAAY,EAAE;QACjBA,YAAY,GAAG,IAAI;QACnBa,OAAO,CAACC,IAAI,CAAC,uCAAuC,CAAC;QACrDC,YAAY,CAACC,KAAK,CAAC,CAAC;QACpBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAGrB,QAAQ,EAAE;MACtC;MACA,MAAM,IAAIsB,KAAK,CAAC,cAAc,CAAC;IACjC;IACA,OAAOK,MAAM;EACf,CAAC,CAAC,OAAOG,GAAG,EAAE;IACZf,OAAO,CAACF,KAAK,CAAC,YAAY,EAAEiB,GAAG,CAAC;IAChC,MAAMA,GAAG;EACX;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}