{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createBlock as _createBlock, createVNode as _createVNode, vModelText as _vModelText, withDirectives as _withDirectives, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"cartable-details\"\n};\nconst _hoisted_3 = {\n  class: \"news-section\"\n};\nconst _hoisted_4 = {\n  class: \"news-header\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"user-info over-news\"\n};\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = [\"href\"];\nconst _hoisted_8 = {\n  key: 1\n};\nconst _hoisted_9 = {\n  class: \"report-section\"\n};\nconst _hoisted_10 = {\n  key: 0,\n  class: \"user-info over-report\"\n};\nconst _hoisted_11 = [\"src\"];\nconst _hoisted_12 = {\n  class: \"report-content\"\n};\nconst _hoisted_13 = {\n  key: 0,\n  class: \"modal-overlay\"\n};\nconst _hoisted_14 = {\n  class: \"modal\"\n};\nconst _hoisted_15 = {\n  class: \"modal-actions\"\n};\nimport { ref, onMounted, onUnmounted, watch, computed } from 'vue';\nimport { useCartableStore } from '@/stores/cartable';\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue';\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue';\nimport { sendApi } from '@/utils/api';\nexport default {\n  __name: 'ShowCartable',\n  props: {\n    id: Number\n  },\n  setup(__props) {\n    const props = __props;\n    const store = useCartableStore();\n    const item = computed(() => store.getCartableById(props.id));\n    const isModalOpen = ref(false);\n    const description = ref('');\n    const mediaIds = ref([]);\n    const openModal = () => {\n      if (item.value) {\n        description.value = item.value.report?.description || '';\n        mediaIds.value = item.value.report?.media?.map(m => m.id) || [];\n        isModalOpen.value = true;\n      }\n    };\n    const handleUploadResult = uploaded => {\n      mediaIds.value = uploaded.map(m => m.id);\n    };\n    const submitForm = async () => {\n      const res = await sendApi({\n        control: 'report',\n        action: 'store_report',\n        data: {\n          cartable_id: props.id,\n          description: description.value,\n          media_id: mediaIds.value\n        }\n      });\n      if (res.status === 'success') {\n        alert('گزارش ذخیره شد');\n        await store.fetchCartables();\n        isModalOpen.value = false;\n      } else {\n        alert('خطا: ' + res.message);\n      }\n    };\n    onMounted(async () => {\n      if (!store.allItems.length) {\n        await store.fetchCartables();\n      }\n      store.startPolling();\n    });\n    onUnmounted(() => store.stopPolling());\n    watch(() => props.id, async () => {\n      if (!store.allItems.length) {\n        await store.fetchCartables();\n      }\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", null, [!item.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \"در حال بارگذاری یا موردی یافت نشد\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"section\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [item.value.has_rule ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [item.value.user?.image ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: item.value.user.image,\n        class: \"avatar\",\n        alt: \"User\"\n      }, null, 8, _hoisted_6)) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", null, [_createElementVNode(\"strong\", null, _toDisplayString(item.value.user.name) + \" \" + _toDisplayString(item.value.user.family), 1), item.value.user?.phone ? (_openBlock(), _createElementBlock(\"a\", {\n        key: 0,\n        href: `tel:${item.value.user.phone}`\n      }, \"📞 تماس\", 8, _hoisted_7)) : _createCommentVNode(\"\", true)])])) : _createCommentVNode(\"\", true)]), item.value.news?.media?.length ? (_openBlock(), _createBlock(MediaSlider, {\n        key: 0,\n        medias: item.value.news.media\n      }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true), _createElementVNode(\"h2\", null, _toDisplayString(item.value.news.description), 1), item.value.news.address?.address ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, \" موقعیت: \" + _toDisplayString(item.value.news.address.city) + \" - \" + _toDisplayString(item.value.news.address.address), 1)) : _createCommentVNode(\"\", true)]), _createElementVNode(\"section\", _hoisted_9, [!item.value.has_rule ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [item.value.user?.image ? (_openBlock(), _createElementBlock(\"img\", {\n        key: 0,\n        src: item.value.user.image,\n        class: \"avatar\"\n      }, null, 8, _hoisted_11)) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", null, [_createElementVNode(\"strong\", null, _toDisplayString(item.value.user.name) + \" \" + _toDisplayString(item.value.user.family), 1), _createElementVNode(\"p\", null, _toDisplayString(item.value.user.phone), 1)])])) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_12, [item.value.has_rule ? (_openBlock(), _createElementBlock(\"button\", {\n        key: 0,\n        onClick: openModal\n      }, \"✏️ ویرایش گزارش\")) : _createCommentVNode(\"\", true), item.value.report?.media?.length ? (_openBlock(), _createBlock(MediaSlider, {\n        key: 1,\n        medias: item.value.report.media\n      }, null, 8, [\"medias\"])) : _createCommentVNode(\"\", true), _createElementVNode(\"h3\", null, _toDisplayString(item.value.report?.description || 'بدون پیوست'), 1), _createElementVNode(\"p\", null, \"ثبت: \" + _toDisplayString(item.value.report?.created_at), 1), _createElementVNode(\"p\", null, \"اجرا: \" + _toDisplayString(item.value.report?.run_time), 1)])]), isModalOpen.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [_createElementVNode(\"div\", _hoisted_14, [_cache[3] || (_cache[3] = _createElementVNode(\"h3\", null, \"ویرایش گزارش\", -1)), _createElementVNode(\"form\", {\n        onSubmit: _withModifiers(submitForm, [\"prevent\"])\n      }, [_createVNode(UploaderManyMedia, {\n        url: 'report_media/',\n        toAction: 'report',\n        onDone: handleUploadResult\n      }), _withDirectives(_createElementVNode(\"textarea\", {\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => description.value = $event),\n        rows: \"4\",\n        placeholder: \"توضیحات...\"\n      }, null, 512), [[_vModelText, description.value]]), _createElementVNode(\"div\", _hoisted_15, [_cache[2] || (_cache[2] = _createElementVNode(\"button\", {\n        type: \"submit\"\n      }, \"ثبت\", -1)), _createElementVNode(\"button\", {\n        onClick: _cache[1] || (_cache[1] = _withModifiers($event => isModalOpen.value = false, [\"prevent\"]))\n      }, \"بستن\")])], 32)])])) : _createCommentVNode(\"\", true)]))]);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","computed","useCartableStore","MediaSlider","UploaderManyMedia","sendApi","props","__props","store","item","getCartableById","id","isModalOpen","description","mediaIds","openModal","value","report","media","map","m","handleUploadResult","uploaded","submitForm","res","control","action","data","cartable_id","media_id","status","alert","fetchCartables","message","allItems","length","startPolling","stopPolling"],"sources":["D:/GitHub/ci3-vue3/vue3/src/components/dashboard/pagesContent/ShowCartable.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div v-if=\"!item\">در حال بارگذاری یا موردی یافت نشد</div>\r\n\r\n    <div v-else class=\"cartable-details\">\r\n      <!-- بخش خبر -->\r\n      <section class=\"news-section\">\r\n        <div class=\"news-header\">\r\n          <div v-if=\"item.has_rule\" class=\"user-info over-news\">\r\n            <img v-if=\"item.user?.image\" :src=\"item.user.image\" class=\"avatar\" alt=\"User\" />\r\n            <div>\r\n              <strong>{{ item.user.name }} {{ item.user.family }}</strong>\r\n              <a v-if=\"item.user?.phone\" :href=\"`tel:${item.user.phone}`\">📞 تماس</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <MediaSlider v-if=\"item.news?.media?.length\" :medias=\"item.news.media\" />\r\n        <h2>{{ item.news.description }}</h2>\r\n        <div v-if=\"item.news.address?.address\">\r\n          موقعیت: {{ item.news.address.city }} - {{ item.news.address.address }}\r\n        </div>\r\n      </section>\r\n\r\n      <!-- بخش گزارش -->\r\n      <section class=\"report-section\">\r\n        <div v-if=\"!item.has_rule\" class=\"user-info over-report\">\r\n          <img v-if=\"item.user?.image\" :src=\"item.user.image\" class=\"avatar\" />\r\n          <div>\r\n            <strong>{{ item.user.name }} {{ item.user.family }}</strong>\r\n            <p>{{ item.user.phone }}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"report-content\">\r\n          <button v-if=\"item.has_rule\" @click=\"openModal\">✏️ ویرایش گزارش</button>\r\n\r\n          <MediaSlider v-if=\"item.report?.media?.length\" :medias=\"item.report.media\" />\r\n          <h3>{{ item.report?.description || 'بدون پیوست' }}</h3>\r\n          <p>ثبت: {{ item.report?.created_at }}</p>\r\n          <p>اجرا: {{ item.report?.run_time }}</p>\r\n        </div>\r\n      </section>\r\n\r\n      <!-- Modal ویرایش -->\r\n      <div v-if=\"isModalOpen\" class=\"modal-overlay\">\r\n        <div class=\"modal\">\r\n          <h3>ویرایش گزارش</h3>\r\n          <form @submit.prevent=\"submitForm\">\r\n            <UploaderManyMedia \r\n              :url=\"'report_media/'\"\r\n              :toAction=\"'report'\"\r\n              @done=\"handleUploadResult\" \r\n            />\r\n            <textarea v-model=\"description\" rows=\"4\" placeholder=\"توضیحات...\" />\r\n            <div class=\"modal-actions\">\r\n              <button type=\"submit\">ثبت</button>\r\n              <button @click.prevent=\"isModalOpen = false\">بستن</button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted, defineProps, watch, computed } from 'vue'\r\nimport { useCartableStore } from '@/stores/cartable'\r\nimport MediaSlider from '@/components/tooles/media/MediaSlider.vue'\r\nimport UploaderManyMedia from '@/components/tooles/upload/UploaderManyMedia.vue'\r\nimport { sendApi } from '@/utils/api'\r\n\r\nconst props = defineProps({ id: Number })\r\nconst store = useCartableStore()\r\nconst item = computed(() => store.getCartableById(props.id))\r\n\r\nconst isModalOpen = ref(false)\r\nconst description = ref('')\r\nconst mediaIds = ref([])\r\n\r\nconst openModal = () => {\r\n  if (item.value) {\r\n    description.value = item.value.report?.description || ''\r\n    mediaIds.value = item.value.report?.media?.map(m => m.id) || []\r\n    isModalOpen.value = true\r\n  }\r\n}\r\n\r\nconst handleUploadResult = (uploaded) => {\r\n  mediaIds.value = uploaded.map(m => m.id)\r\n}\r\n\r\nconst submitForm = async () => {\r\n  const res = await sendApi({\r\n    control: 'report',\r\n    action: 'store_report',\r\n    data: {\r\n      cartable_id: props.id,\r\n      description: description.value,\r\n      media_id: mediaIds.value,\r\n    }\r\n  })\r\n\r\n  if (res.status === 'success') {\r\n    alert('گزارش ذخیره شد')\r\n    await store.fetchCartables()\r\n    isModalOpen.value = false\r\n  } else {\r\n    alert('خطا: ' + res.message)\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  if (!store.allItems.length) {\r\n    await store.fetchCartables()\r\n  }\r\n  store.startPolling()\r\n})\r\nonUnmounted(() => store.stopPolling())\r\n\r\nwatch(() => props.id, async () => {\r\n  if (!store.allItems.length) {\r\n    await store.fetchCartables()\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.cartable-details {\r\n  padding: 1rem;\r\n}\r\n.news-section, .report-section {\r\n  margin-bottom: 2rem;\r\n  border: 1px solid #eee;\r\n  padding: 1rem;\r\n  border-radius: 8px;\r\n}\r\n.user-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n.avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n}\r\n.modal-overlay {\r\n  position: fixed;\r\n  top: 0; left: 0; right: 0; bottom: 0;\r\n  background: rgba(0,0,0,0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.modal {\r\n  background: white;\r\n  padding: 1.5rem;\r\n  border-radius: 10px;\r\n  width: 90%;\r\n  max-width: 500px;\r\n}\r\n.modal-actions {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-top: 1rem;\r\n}\r\ntextarea {\r\n  width: 100%;\r\n  margin-top: 1rem;\r\n}\r\n</style>\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAwB,EAAEC,KAAK,EAAEC,QAAQ,QAAQ,KAAK;AAC/E,SAASC,gBAAgB,QAAQ,mBAAmB;AACpD,OAAOC,WAAW,MAAM,2CAA2C;AACnE,OAAOC,iBAAiB,MAAM,kDAAkD;AAChF,SAASC,OAAO,QAAQ,aAAa;;;;;;;IAErC,MAAMC,KAAK,GAAGC,OAA2B;IACzC,MAAMC,KAAK,GAAGN,gBAAgB,CAAC,CAAC;IAChC,MAAMO,IAAI,GAAGR,QAAQ,CAAC,MAAMO,KAAK,CAACE,eAAe,CAACJ,KAAK,CAACK,EAAE,CAAC,CAAC;IAE5D,MAAMC,WAAW,GAAGf,GAAG,CAAC,KAAK,CAAC;IAC9B,MAAMgB,WAAW,GAAGhB,GAAG,CAAC,EAAE,CAAC;IAC3B,MAAMiB,QAAQ,GAAGjB,GAAG,CAAC,EAAE,CAAC;IAExB,MAAMkB,SAAS,GAAGA,CAAA,KAAM;MACtB,IAAIN,IAAI,CAACO,KAAK,EAAE;QACdH,WAAW,CAACG,KAAK,GAAGP,IAAI,CAACO,KAAK,CAACC,MAAM,EAAEJ,WAAW,IAAI,EAAE;QACxDC,QAAQ,CAACE,KAAK,GAAGP,IAAI,CAACO,KAAK,CAACC,MAAM,EAAEC,KAAK,EAAEC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACT,EAAE,CAAC,IAAI,EAAE;QAC/DC,WAAW,CAACI,KAAK,GAAG,IAAI;MAC1B;IACF,CAAC;IAED,MAAMK,kBAAkB,GAAIC,QAAQ,IAAK;MACvCR,QAAQ,CAACE,KAAK,GAAGM,QAAQ,CAACH,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACT,EAAE,CAAC;IAC1C,CAAC;IAED,MAAMY,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC7B,MAAMC,GAAG,GAAG,MAAMnB,OAAO,CAAC;QACxBoB,OAAO,EAAE,QAAQ;QACjBC,MAAM,EAAE,cAAc;QACtBC,IAAI,EAAE;UACJC,WAAW,EAAEtB,KAAK,CAACK,EAAE;UACrBE,WAAW,EAAEA,WAAW,CAACG,KAAK;UAC9Ba,QAAQ,EAAEf,QAAQ,CAACE;QACrB;MACF,CAAC,CAAC;MAEF,IAAIQ,GAAG,CAACM,MAAM,KAAK,SAAS,EAAE;QAC5BC,KAAK,CAAC,gBAAgB,CAAC;QACvB,MAAMvB,KAAK,CAACwB,cAAc,CAAC,CAAC;QAC5BpB,WAAW,CAACI,KAAK,GAAG,KAAK;MAC3B,CAAC,MAAM;QACLe,KAAK,CAAC,OAAO,GAAGP,GAAG,CAACS,OAAO,CAAC;MAC9B;IACF,CAAC;IAEDnC,SAAS,CAAC,YAAY;MACpB,IAAI,CAACU,KAAK,CAAC0B,QAAQ,CAACC,MAAM,EAAE;QAC1B,MAAM3B,KAAK,CAACwB,cAAc,CAAC,CAAC;MAC9B;MACAxB,KAAK,CAAC4B,YAAY,CAAC,CAAC;IACtB,CAAC,CAAC;IACFrC,WAAW,CAAC,MAAMS,KAAK,CAAC6B,WAAW,CAAC,CAAC,CAAC;IAEtCrC,KAAK,CAAC,MAAMM,KAAK,CAACK,EAAE,EAAE,YAAY;MAChC,IAAI,CAACH,KAAK,CAAC0B,QAAQ,CAACC,MAAM,EAAE;QAC1B,MAAM3B,KAAK,CAACwB,cAAc,CAAC,CAAC;MAC9B;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}