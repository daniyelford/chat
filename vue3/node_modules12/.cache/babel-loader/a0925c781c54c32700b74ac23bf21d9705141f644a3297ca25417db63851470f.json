{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineStore } from 'pinia';\nimport { sendApi } from '@/utils/api';\nimport { useUserStore } from '@/stores/user';\nexport const useNotificationStore = defineStore('notification', {\n  state: () => ({\n    notifications: [],\n    unreadCount: 0,\n    lastId: 0\n  }),\n  actions: {\n    async fetchNotifications() {\n      const userStore = useUserStore();\n      if (userStore.isLoggedIn) {\n        const res = await sendApi({\n          action: 'get_notifications',\n          control: 'user'\n        });\n        if (res.status === 'success' && Array.isArray(res.data)) {\n          const newNotifs = res.data;\n          const maxNewId = Math.max(...newNotifs.map(n => n.id), 0);\n          if (maxNewId > this.lastId) {\n            this.notifications = newNotifs;\n            this.unreadCount = newNotifs.filter(n => n.is_read === 'dont').length;\n            this.lastId = maxNewId;\n          }\n        }\n      }\n    },\n    markAsRead(id) {\n      const notif = this.notifications.find(n => n.id === id);\n      if (notif && notif.is_read === 'dont') {\n        notif.is_read = 'seen';\n        this.unreadCount = this.notifications.filter(n => n.is_read === 'dont').length;\n      }\n    },\n    pushNotification(notif) {\n      this.notifications.unshift(notif);\n      if (notif.is_read === 'dont') this.unreadCount++;\n      this.lastId = Math.max(this.lastId, notif.id);\n    }\n  },\n  persist: true\n});","map":{"version":3,"names":["defineStore","sendApi","useUserStore","useNotificationStore","state","notifications","unreadCount","lastId","actions","fetchNotifications","userStore","isLoggedIn","res","action","control","status","Array","isArray","data","newNotifs","maxNewId","Math","max","map","n","id","filter","is_read","length","markAsRead","notif","find","pushNotification","unshift","persist"],"sources":["D:/GitHub/ci3-vue3/vue3/src/stores/notification.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { sendApi } from '@/utils/api'\r\nimport { useUserStore } from '@/stores/user'\r\nexport const useNotificationStore = defineStore('notification', {\r\n  state: () => ({\r\n    notifications: [],\r\n    unreadCount: 0,\r\n    lastId: 0,\r\n  }),\r\n  actions: {\r\n    async fetchNotifications() {\r\n      const userStore = useUserStore()\r\n      if (userStore.isLoggedIn) {\r\n        const res = await sendApi({ action: 'get_notifications', control: 'user' })\r\n        if (res.status === 'success' && Array.isArray(res.data)) {\r\n          const newNotifs = res.data\r\n          const maxNewId = Math.max(...newNotifs.map(n => n.id), 0)\r\n          if (maxNewId > this.lastId) {\r\n            this.notifications = newNotifs\r\n            this.unreadCount = newNotifs.filter(n => n.is_read === 'dont').length\r\n            this.lastId = maxNewId\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    markAsRead(id) {\r\n      const notif = this.notifications.find(n => n.id === id)\r\n      if (notif && notif.is_read === 'dont') {\r\n        notif.is_read = 'seen'\r\n        this.unreadCount = this.notifications.filter(n => n.is_read === 'dont').length\r\n      }\r\n    },\r\n\r\n    pushNotification(notif) {\r\n      this.notifications.unshift(notif)\r\n      if (notif.is_read === 'dont') this.unreadCount++\r\n      this.lastId = Math.max(this.lastId, notif.id)\r\n    }\r\n  },\r\n\r\n  persist: true\r\n})"],"mappings":";;;;AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,OAAO,QAAQ,aAAa;AACrC,SAASC,YAAY,QAAQ,eAAe;AAC5C,OAAO,MAAMC,oBAAoB,GAAGH,WAAW,CAAC,cAAc,EAAE;EAC9DI,KAAK,EAAEA,CAAA,MAAO;IACZC,aAAa,EAAE,EAAE;IACjBC,WAAW,EAAE,CAAC;IACdC,MAAM,EAAE;EACV,CAAC,CAAC;EACFC,OAAO,EAAE;IACP,MAAMC,kBAAkBA,CAAA,EAAG;MACzB,MAAMC,SAAS,GAAGR,YAAY,CAAC,CAAC;MAChC,IAAIQ,SAAS,CAACC,UAAU,EAAE;QACxB,MAAMC,GAAG,GAAG,MAAMX,OAAO,CAAC;UAAEY,MAAM,EAAE,mBAAmB;UAAEC,OAAO,EAAE;QAAO,CAAC,CAAC;QAC3E,IAAIF,GAAG,CAACG,MAAM,KAAK,SAAS,IAAIC,KAAK,CAACC,OAAO,CAACL,GAAG,CAACM,IAAI,CAAC,EAAE;UACvD,MAAMC,SAAS,GAAGP,GAAG,CAACM,IAAI;UAC1B,MAAME,QAAQ,GAAGC,IAAI,CAACC,GAAG,CAAC,GAAGH,SAAS,CAACI,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,EAAE,CAAC,EAAE,CAAC,CAAC;UACzD,IAAIL,QAAQ,GAAG,IAAI,CAACb,MAAM,EAAE;YAC1B,IAAI,CAACF,aAAa,GAAGc,SAAS;YAC9B,IAAI,CAACb,WAAW,GAAGa,SAAS,CAACO,MAAM,CAACF,CAAC,IAAIA,CAAC,CAACG,OAAO,KAAK,MAAM,CAAC,CAACC,MAAM;YACrE,IAAI,CAACrB,MAAM,GAAGa,QAAQ;UACxB;QACF;MACF;IACF,CAAC;IAEDS,UAAUA,CAACJ,EAAE,EAAE;MACb,MAAMK,KAAK,GAAG,IAAI,CAACzB,aAAa,CAAC0B,IAAI,CAACP,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKA,EAAE,CAAC;MACvD,IAAIK,KAAK,IAAIA,KAAK,CAACH,OAAO,KAAK,MAAM,EAAE;QACrCG,KAAK,CAACH,OAAO,GAAG,MAAM;QACtB,IAAI,CAACrB,WAAW,GAAG,IAAI,CAACD,aAAa,CAACqB,MAAM,CAACF,CAAC,IAAIA,CAAC,CAACG,OAAO,KAAK,MAAM,CAAC,CAACC,MAAM;MAChF;IACF,CAAC;IAEDI,gBAAgBA,CAACF,KAAK,EAAE;MACtB,IAAI,CAACzB,aAAa,CAAC4B,OAAO,CAACH,KAAK,CAAC;MACjC,IAAIA,KAAK,CAACH,OAAO,KAAK,MAAM,EAAE,IAAI,CAACrB,WAAW,EAAE;MAChD,IAAI,CAACC,MAAM,GAAGc,IAAI,CAACC,GAAG,CAAC,IAAI,CAACf,MAAM,EAAEuB,KAAK,CAACL,EAAE,CAAC;IAC/C;EACF,CAAC;EAEDS,OAAO,EAAE;AACX,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}