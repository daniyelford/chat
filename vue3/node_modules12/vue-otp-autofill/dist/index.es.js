import { ref as p, watch as v, onMounted as w, createElementBlock as i, openBlock as d, createTextVNode as k, toDisplayString as x, Fragment as b, renderList as _, withDirectives as A, normalizeClass as T, vModelText as D, nextTick as s } from "vue";
const V = { class: "otp-container" }, C = ["onUpdate:modelValue", "placeholder", "onKeydown"], E = `
  .otp-container { direction: ltr;display: flex; gap: 0.5rem; justify-content: space-evenly; }
  .digit-box { width: 1.5rem; height: 2rem; font-size: 1rem; text-align: center; border: 2px solid black; border-radius: 6px; }
  .bounce { animation: pulse 0.3s ease-in-out alternate; } 
    @keyframes pulse { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }
  `, O = {
  __name: "OtpInput",
  props: {
    modelValue: { type: String, default: "" },
    length: { type: Number, default: 6 }
  },
  emits: ["update:modelValue"],
  setup(m, { emit: f }) {
    const u = p(""), c = m, g = f, o = p(Array.from({ length: c.length }, (e, t) => c.modelValue[t] || "")), h = (e, t) => {
      const l = e.currentTarget.parentElement.children, n = /^[0-9]$/.test(e.key);
      if (!n && !["Backspace", "ArrowLeft", "ArrowRight", "Tab"].includes(e.key)) {
        e.preventDefault();
        return;
      }
      if (n) {
        o.value[t] = e.key, e.preventDefault(), t < o.value.length - 1 && s(() => l[t + 1].focus());
        return;
      }
      if (e.key === "Backspace") {
        o.value[t] = "", e.preventDefault(), t > 0 && s(() => l[t - 1].focus());
        return;
      }
      e.key === "ArrowLeft" && t > 0 && s(() => l[t - 1].focus()), e.key === "ArrowRight" && t < o.value.length - 1 && s(() => l[t + 1].focus());
    };
    async function y(e = 6e4) {
      if (!("OTPCredential" in window)) return;
      const t = new AbortController(), l = t.signal;
      setTimeout(() => t.abort(), e);
      try {
        const n = await navigator.credentials.get({
          otp: { transport: ["sms"] },
          signal: l
        });
        n?.code ? (n.code.split("").forEach((a, r) => {
          r < c.length && (o.value[r] = a);
        }), s(() => {
          const a = document.querySelectorAll(".otp-container input"), r = Math.min(n.code.length, c.length) - 1;
          a[r] && a[r].focus();
        })) : u.value = "empty content";
      } catch (n) {
        u.value = n.message, console.warn("OTP AutoFill failed:", n.message);
      }
    }
    return v(o, () => {
      g("update:modelValue", o.value.join(""));
    }, { deep: !0 }), w(() => {
      const e = document.createElement("style");
      e.textContent = E, document.head.appendChild(e), y();
    }), (e, t) => (d(), i("div", V, [
      k(x(u.value ?? "") + " ", 1),
      (d(!0), i(b, null, _(o.value, (l, n) => A((d(), i("input", {
        key: n,
        type: "text",
        class: T(["digit-box", { bounce: l !== "" }]),
        "onUpdate:modelValue": (a) => o.value[n] = a,
        maxlength: "1",
        placeholder: o.value[n] ?? 0,
        onKeydown: (a) => h(a, n)
      }, null, 42, C)), [
        [D, o.value[n]]
      ])), 128))
    ]));
  }
};
export {
  O as default
};
